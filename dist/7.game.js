(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{111:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var o=i(43),n=i(0),r=function(){function t(t,e,i){this.vectors=o.a.BuildArray(8,n.Vector3.Zero),this.center=n.Vector3.Zero(),this.centerWorld=n.Vector3.Zero(),this.extendSize=n.Vector3.Zero(),this.extendSizeWorld=n.Vector3.Zero(),this.directions=o.a.BuildArray(3,n.Vector3.Zero),this.vectorsWorld=o.a.BuildArray(8,n.Vector3.Zero),this.minimumWorld=n.Vector3.Zero(),this.maximumWorld=n.Vector3.Zero(),this.minimum=n.Vector3.Zero(),this.maximum=n.Vector3.Zero(),this.reConstruct(t,e,i)}return t.prototype.reConstruct=function(t,e,i){var o=t.x,r=t.y,a=t.z,s=e.x,c=e.y,h=e.z,l=this.vectors;this.minimum.copyFromFloats(o,r,a),this.maximum.copyFromFloats(s,c,h),l[0].copyFromFloats(o,r,a),l[1].copyFromFloats(s,c,h),l[2].copyFromFloats(s,r,a),l[3].copyFromFloats(o,c,a),l[4].copyFromFloats(o,r,h),l[5].copyFromFloats(s,c,a),l[6].copyFromFloats(o,c,h),l[7].copyFromFloats(s,r,h),e.addToRef(t,this.center).scaleInPlace(.5),e.subtractToRef(t,this.extendSize).scaleInPlace(.5),this._update(i||n.Matrix.IdentityReadOnly)},t.prototype.scale=function(e){var i=t.TmpVector3,o=this.maximum.subtractToRef(this.minimum,i[0]),n=o.length();o.normalizeFromLength(n);var r=n*e,a=o.scaleInPlace(.5*r),s=this.center.subtractToRef(a,i[1]),c=this.center.addToRef(a,i[2]);return this.reConstruct(s,c,this._worldMatrix),this},t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(t){var e=this.minimumWorld,i=this.maximumWorld,o=this.directions,r=this.vectorsWorld,a=this.vectors;if(t.isIdentity()){e.copyFrom(this.minimum),i.copyFrom(this.maximum);for(s=0;s<8;++s)r[s].copyFrom(a[s]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{e.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(var s=0;s<8;++s){var c=r[s];n.Vector3.TransformCoordinatesToRef(a[s],t,c),e.minimizeInPlace(c),i.maximizeInPlace(c)}i.subtractToRef(e,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(e,this.centerWorld).scaleInPlace(.5)}n.Vector3.FromArrayToRef(t.m,0,o[0]),n.Vector3.FromArrayToRef(t.m,4,o[1]),n.Vector3.FromArrayToRef(t.m,8,o[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var e=this.minimumWorld,i=this.maximumWorld,o=e.x,r=e.y,a=e.z,s=i.x,c=i.y,h=i.z,l=t.x,u=t.y,p=t.z,d=-n.Epsilon;return!(s-l<d||d>l-o)&&(!(c-u<d||d>u-r)&&!(h-p<d||d>p-a))},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(t,e){var i=this.minimumWorld,o=this.maximumWorld,n=i.x,r=i.y,a=i.z,s=o.x,c=o.y,h=o.z,l=t.x,u=t.y,p=t.z,d=e.x,_=e.y,m=e.z;return!(s<l||n>d)&&(!(c<u||r>_)&&!(h<p||a>m))},t.Intersects=function(t,e){return t.intersectsMinMax(e.minimumWorld,e.maximumWorld)},t.IntersectsSphere=function(e,i,o,r){var a=t.TmpVector3[0];return n.Vector3.ClampToRef(o,e,i,a),n.Vector3.DistanceSquared(o,a)<=r*r},t.IsCompletelyInFrustum=function(t,e){for(var i=0;i<6;++i)for(var o=e[i],n=0;n<8;++n)if(o.dotCoordinate(t[n])<0)return!1;return!0},t.IsInFrustum=function(t,e){for(var i=0;i<6;++i){for(var o=!0,n=e[i],r=0;r<8;++r)if(n.dotCoordinate(t[r])>=0){o=!1;break}if(o)return!1}return!0},t.TmpVector3=o.a.BuildArray(3,n.Vector3.Zero),t}()},114:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var o=i(43),n=i(0),r=function(){function t(t,e,i){this.center=n.Vector3.Zero(),this.centerWorld=n.Vector3.Zero(),this.minimum=n.Vector3.Zero(),this.maximum=n.Vector3.Zero(),this.reConstruct(t,e,i)}return t.prototype.reConstruct=function(t,e,i){this.minimum.copyFrom(t),this.maximum.copyFrom(e);var o=n.Vector3.Distance(t,e);e.addToRef(t,this.center).scaleInPlace(.5),this.radius=.5*o,this._update(i||n.Matrix.IdentityReadOnly)},t.prototype.scale=function(e){var i=this.radius*e,o=t.TmpVector3,n=o[0].setAll(i),r=this.center.subtractToRef(n,o[1]),a=this.center.addToRef(n,o[2]);return this.reConstruct(r,a,this._worldMatrix),this},t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(e){if(e.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{n.Vector3.TransformCoordinatesToRef(this.center,e,this.centerWorld);var i=t.TmpVector3[0];n.Vector3.TransformNormalFromFloatsToRef(1,1,1,e,i),this.radiusWorld=Math.max(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z))*this.radius}},t.prototype.isInFrustum=function(t){for(var e=this.centerWorld,i=this.radiusWorld,o=0;o<6;o++)if(t[o].dotCoordinate(e)<=-i)return!1;return!0},t.prototype.isCenterInFrustum=function(t){for(var e=this.centerWorld,i=0;i<6;i++)if(t[i].dotCoordinate(e)<0)return!1;return!0},t.prototype.intersectsPoint=function(t){var e=n.Vector3.DistanceSquared(this.centerWorld,t);return!(this.radiusWorld*this.radiusWorld<e)},t.Intersects=function(t,e){var i=n.Vector3.DistanceSquared(t.centerWorld,e.centerWorld),o=t.radiusWorld+e.radiusWorld;return!(o*o<i)},t.TmpVector3=o.a.BuildArray(3,n.Vector3.Zero),t}()},127:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var o=function(){return function(t,e,i){this.bu=t,this.bv=e,this.distance=i,this.faceId=0,this.subMeshId=0}}()},129:function(t,e,i){"use strict";i.d(e,"a",function(){return l});var o=i(1),n=i(34),r=i(180),a=i(181),s=i(178),c=i(182),h=i(183),l=function(t){function e(e){return t.call(this,e)||this}return o.d(e,t),e.prototype.addKeyboard=function(){return this.add(new r.a),this},e.prototype.addMouse=function(t){return void 0===t&&(t=!0),this.add(new a.a(t)),this},e.prototype.addDeviceOrientation=function(){return this.add(new s.a),this},e.prototype.addTouch=function(){return this.add(new c.a),this},e.prototype.addVirtualJoystick=function(){return this.add(new h.a),this},e}(n.b)},130:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var o=i(1),n=i(177),r=i(176),a=i(174),s=i(175),c=function(t){function e(e){return t.call(this,e)||this}return o.d(e,t),e.prototype.addMouseWheel=function(){return this.add(new s.a),this},e.prototype.addPointers=function(){return this.add(new r.a),this},e.prototype.addKeyboard=function(){return this.add(new a.a),this},e.prototype.addVRDeviceOrientation=function(){return this.add(new n.a),this},e}(i(34).b)},131:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var o=i(1),n=i(48),r=i(0);i(25).a.AddNodeConstructor("DeviceOrientationCamera",function(t,e){return function(){return new a(t,r.Vector3.Zero(),e)}});var a=function(t){function e(e,i,o){var n=t.call(this,e,i,o)||this;return n._quaternionCache=new r.Quaternion,n.inputs.addDeviceOrientation(),n}return o.d(e,t),e.prototype.getClassName=function(){return"DeviceOrientationCamera"},e.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},e.prototype.resetToCurrentRotation=function(t){var e=this;void 0===t&&(t=r.Axis.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new r.Quaternion),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(i){t[i]?e._initialQuaternion[i]*=-1:e._initialQuaternion[i]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},e}(n.a)},132:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var o=i(1),n=i(22),r=i(131),a=i(89),s=i(0);i(25).a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(t,e){return function(){return new c(t,s.Vector3.Zero(),e)}});var c=function(t){function e(e,i,o,r,s){void 0===r&&(r=!0),void 0===s&&(s=a.a.GetDefault());var c=t.call(this,e,i,o)||this;return s.compensateDistortion=r,c.setCameraRigMode(n.a.RIG_MODE_VR,{vrCameraMetrics:s}),c}return o.d(e,t),e.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},e}(r.a)},147:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var o=i(0),n=i(11),r=function(){function t(){this._scaledPosition=o.Vector3.Zero(),this._scaledVelocity=o.Vector3.Zero(),this._finalPosition=o.Vector3.Zero()}return t.prototype.getNewPosition=function(t,e,i,o,n,r,a){t.divideToRef(i._radius,this._scaledPosition),e.divideToRef(i._radius,this._scaledVelocity),i.collidedMesh=null,i._retry=0,i._initialVelocity=this._scaledVelocity,i._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,o,this._finalPosition,n),this._finalPosition.multiplyInPlace(i._radius),r(a,this._finalPosition,i.collidedMesh)},t.prototype.init=function(t){this._scene=t},t.prototype.destroy=function(){},t.prototype.onMeshAdded=function(t){},t.prototype.onMeshUpdated=function(t){},t.prototype.onMeshRemoved=function(t){},t.prototype.onGeometryAdded=function(t){},t.prototype.onGeometryUpdated=function(t){},t.prototype.onGeometryDeleted=function(t){},t.prototype._collideWithWorld=function(t,e,i,o,r,a){void 0===a&&(a=null);var s=10*n.Engine.CollisionsEpsilon;if(i._retry>=o)r.copyFrom(t);else{var c=a?a.collisionMask:i.collisionMask;i._initialize(t,e,s);for(var h=0;h<this._scene.meshes.length;h++){var l=this._scene.meshes[h];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==a&&0!=(c&l.collisionGroup)&&l._checkCollision(i)}i.collisionFound?(0===e.x&&0===e.y&&0===e.z||i._getResponse(t,e),e.length()<=s?r.copyFrom(t):(i._retry++,this._collideWithWorld(t,e,i,o,r,a))):t.addToRef(e,r)}},t}()},173:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var o=i(1),n=i(2),r=i(34),a=i(52),s=function(){function t(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40}return t.prototype.attachControl=function(t,e){var i=this,o=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=o.onGamepadConnectedObservable.add(function(t){t.type!==a.a.POSE_ENABLED&&(i.gamepad&&t.type!==a.a.XBOX||(i.gamepad=t))}),this._onGamepadDisconnectedObserver=o.onGamepadDisconnectedObservable.add(function(t){i.gamepad===t&&(i.gamepad=null)}),this.gamepad=o.getGamepadByType(a.a.XBOX)},t.prototype.detachControl=function(t){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},t.prototype.checkInputs=function(){if(this.gamepad){var t=this.camera,e=this.gamepad.rightStick;if(e){if(0!=e.x){var i=e.x/this.gamepadRotationSensibility;0!=i&&Math.abs(i)>.005&&(t.inertialAlphaOffset+=i)}if(0!=e.y){var o=e.y/this.gamepadRotationSensibility;0!=o&&Math.abs(o)>.005&&(t.inertialBetaOffset+=o)}}var n=this.gamepad.leftStick;if(n&&0!=n.y){var r=n.y/this.gamepadMoveSensibility;0!=r&&Math.abs(r)>.005&&(this.camera.inertialRadiusOffset-=r)}}},t.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},t.prototype.getSimpleName=function(){return"gamepad"},o.c([Object(n.c)()],t.prototype,"gamepadRotationSensibility",void 0),o.c([Object(n.c)()],t.prototype,"gamepadMoveSensibility",void 0),t}();r.a.ArcRotateCameraGamepadInput=s},174:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var o=i(1),n=i(2),r=i(34),a=i(57),s=function(){function t(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return t.prototype.attachControl=function(t,e){var i=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){i._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(t){var o,n=t.event;n.metaKey||(t.type===a.a.KEYDOWN?(i._ctrlPressed=n.ctrlKey,i._altPressed=n.altKey,(-1!==i.keysUp.indexOf(n.keyCode)||-1!==i.keysDown.indexOf(n.keyCode)||-1!==i.keysLeft.indexOf(n.keyCode)||-1!==i.keysRight.indexOf(n.keyCode)||-1!==i.keysReset.indexOf(n.keyCode))&&(-1===(o=i._keys.indexOf(n.keyCode))&&i._keys.push(n.keyCode),n.preventDefault&&(e||n.preventDefault()))):-1===i.keysUp.indexOf(n.keyCode)&&-1===i.keysDown.indexOf(n.keyCode)&&-1===i.keysLeft.indexOf(n.keyCode)&&-1===i.keysRight.indexOf(n.keyCode)&&-1===i.keysReset.indexOf(n.keyCode)||((o=i._keys.indexOf(n.keyCode))>=0&&i._keys.splice(o,1),n.preventDefault&&(e||n.preventDefault())))}))},t.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var i=this._keys[e];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&t.useInputToRestoreState&&t.restoreState()}},t.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},t.prototype.getSimpleName=function(){return"keyboard"},o.c([Object(n.c)()],t.prototype,"keysUp",void 0),o.c([Object(n.c)()],t.prototype,"keysDown",void 0),o.c([Object(n.c)()],t.prototype,"keysLeft",void 0),o.c([Object(n.c)()],t.prototype,"keysRight",void 0),o.c([Object(n.c)()],t.prototype,"keysReset",void 0),o.c([Object(n.c)()],t.prototype,"panningSensibility",void 0),o.c([Object(n.c)()],t.prototype,"zoomingSensibility",void 0),o.c([Object(n.c)()],t.prototype,"useAltToZoom",void 0),o.c([Object(n.c)()],t.prototype,"angularSpeed",void 0),t}();r.a.ArcRotateCameraKeyboardMoveInput=s},175:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var o=i(1),n=i(2),r=i(34),a=i(13),s=function(){function t(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return t.prototype.attachControl=function(t,e){var i=this;this._wheel=function(t,o){if(t.type===a.a.POINTERWHEEL){var n=t.event,r=0,s=n;if(s.wheelDelta)if(i.wheelDeltaPercentage){var c=.01*s.wheelDelta*i.wheelDeltaPercentage*i.camera.radius;r=s.wheelDelta>0?c/(1+i.wheelDeltaPercentage):c*(1+i.wheelDeltaPercentage)}else r=s.wheelDelta/(40*i.wheelPrecision);else r=-(n.deltaY||n.detail)/i.wheelPrecision;r&&(i.camera.inertialRadiusOffset+=r),n.preventDefault&&(e||n.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,a.a.POINTERWHEEL)},t.prototype.detachControl=function(t){this._observer&&t&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},t.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},t.prototype.getSimpleName=function(){return"mousewheel"},o.c([Object(n.c)()],t.prototype,"wheelPrecision",void 0),o.c([Object(n.c)()],t.prototype,"wheelDeltaPercentage",void 0),t}();r.a.ArcRotateCameraMouseWheelInput=s},176:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var o=i(1),n=i(2),r=i(5),a=i(34),s=i(13),c=function(){function t(){this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1}return t.prototype.attachControl=function(t,e){var i,o=this,n=this.camera.getEngine(),a=null,c=null,h=0,l=0,u=0,p={x:0,y:0,isPaning:!1,isPinching:!1};this._pointerInput=function(r,d){var _=r.event,m="touch"===r.event.pointerType;if(!n.isInVRExclusivePointerMode&&(r.type===s.a.POINTERMOVE||-1!==o.buttons.indexOf(_.button))){var f=_.srcElement||_.target;if(r.type===s.a.POINTERDOWN&&f){try{f.setPointerCapture(_.pointerId)}catch(t){}o._isPanClick=_.button===o.camera._panningMouseButton,i={x:_.clientX,y:_.clientY,pointerId:_.pointerId,type:_.pointerType},null===a?a=i:null===c&&(c=i),e||(_.preventDefault(),t.focus())}else if(r.type===s.a.POINTERDOUBLETAP)o.camera.useInputToRestoreState&&o.camera.restoreState();else if(r.type===s.a.POINTERUP&&f){try{f.releasePointerCapture(_.pointerId)}catch(t){}i=null,h=0,p.isPaning=!1,p.isPinching=!1,u=0,l=0,m||(c=null),n._badOS?a=c=null:c&&a&&a.pointerId==_.pointerId?(a=c,c=null,i={x:a.x,y:a.y,pointerId:a.pointerId,type:_.pointerType}):a&&c&&c.pointerId==_.pointerId?(c=null,i={x:a.x,y:a.y,pointerId:a.pointerId,type:_.pointerType}):a=c=null,e||_.preventDefault()}else if(r.type===s.a.POINTERMOVE)if(e||_.preventDefault(),a&&null===c&&i){if(0!==o.panningSensibility&&(_.ctrlKey&&o.camera._useCtrlForPanning||o._isPanClick))o.camera.inertialPanningX+=-(_.clientX-i.x)/o.panningSensibility,o.camera.inertialPanningY+=(_.clientY-i.y)/o.panningSensibility;else{var g=_.clientX-i.x,y=_.clientY-i.y;o.camera.inertialAlphaOffset-=g/o.angularSensibilityX,o.camera.inertialBetaOffset-=y/o.angularSensibilityY}i.x=_.clientX,i.y=_.clientY}else if(a&&c){var v=a.pointerId===_.pointerId?a:c;v.x=_.clientX,v.y=_.clientY;var b=o.pinchInwards?1:-1,C=a.x-c.x,R=a.y-c.y,M=C*C+R*R,P=Math.sqrt(M);if(0===h)return l=P,h=M,p.x=(a.x+c.x)/2,void(p.y=(a.y+c.y)/2);if(o.multiTouchPanAndZoom){if(o.pinchDeltaPercentage?o.camera.inertialRadiusOffset+=.001*(M-h)*o.camera.radius*o.pinchDeltaPercentage:o.camera.inertialRadiusOffset+=(M-h)/(o.pinchPrecision*((o.angularSensibilityX+o.angularSensibilityY)/2)*b),0!==o.panningSensibility){var x=(a.x+c.x)/2,T=(a.y+c.y)/2,O=x-p.x,V=T-p.y;p.x=x,p.y=T,o.camera.inertialPanningX+=-O/o.panningSensibility,o.camera.inertialPanningY+=V/o.panningSensibility}}else{if(u++,p.isPinching||u<20&&Math.abs(P-l)>o.camera.pinchToPanMaxDistance)o.pinchDeltaPercentage?o.camera.inertialRadiusOffset+=.001*(M-h)*o.camera.radius*o.pinchDeltaPercentage:o.camera.inertialRadiusOffset+=(M-h)/(o.pinchPrecision*((o.angularSensibilityX+o.angularSensibilityY)/2)*b),p.isPaning=!1,p.isPinching=!0;else if(i&&i.pointerId===v.pointerId&&0!==o.panningSensibility&&o.multiTouchPanning){if(!p.isPaning)return p.isPaning=!0,p.isPinching=!1,p.x=v.x,void(p.y=v.y);o.camera.inertialPanningX+=-(v.x-p.x)/o.panningSensibility,o.camera.inertialPanningY+=(v.y-p.y)/o.panningSensibility}i&&i.pointerId===_.pointerId&&(p.x=v.x,p.y=v.y)}h=M}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,s.a.POINTERDOWN|s.a.POINTERUP|s.a.POINTERMOVE|s.a.POINTERDOUBLETAP),this._onContextMenu=function(t){t.preventDefault()},this.camera._useCtrlForPanning||t.addEventListener("contextmenu",this._onContextMenu,!1),this._onLostFocus=function(){a=c=null,h=0,p.isPaning=!1,p.isPinching=!1,u=0,i=null,l=0},this._onMouseMove=function(t){if(n.isPointerLock){var i=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,r=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0;o.camera.inertialAlphaOffset-=i/o.angularSensibilityX,o.camera.inertialBetaOffset-=r/o.angularSensibilityY,e||t.preventDefault()}},this._onGestureStart=function(e){void 0!==window.MSGesture&&(o._MSGestureHandler||(o._MSGestureHandler=new MSGesture,o._MSGestureHandler.target=t),o._MSGestureHandler.addPointer(e.pointerId))},this._onGesture=function(t){o.camera.radius*=t.scale,t.preventDefault&&(e||(t.stopPropagation(),t.preventDefault()))},t.addEventListener("mousemove",this._onMouseMove,!1),t.addEventListener("MSPointerDown",this._onGestureStart,!1),t.addEventListener("MSGestureChange",this._onGesture,!1),r.h.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}])},t.prototype.detachControl=function(t){this._onLostFocus&&r.h.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),t&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._onContextMenu&&t.removeEventListener("contextmenu",this._onContextMenu),this._onMouseMove&&t.removeEventListener("mousemove",this._onMouseMove),this._onGestureStart&&t.removeEventListener("MSPointerDown",this._onGestureStart),this._onGesture&&t.removeEventListener("MSGestureChange",this._onGesture),this._isPanClick=!1,this.pinchInwards=!0,this._onMouseMove=null,this._onGestureStart=null,this._onGesture=null,this._MSGestureHandler=null,this._onLostFocus=null,this._onContextMenu=null)},t.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},t.prototype.getSimpleName=function(){return"pointers"},o.c([Object(n.c)()],t.prototype,"buttons",void 0),o.c([Object(n.c)()],t.prototype,"angularSensibilityX",void 0),o.c([Object(n.c)()],t.prototype,"angularSensibilityY",void 0),o.c([Object(n.c)()],t.prototype,"pinchPrecision",void 0),o.c([Object(n.c)()],t.prototype,"pinchDeltaPercentage",void 0),o.c([Object(n.c)()],t.prototype,"panningSensibility",void 0),o.c([Object(n.c)()],t.prototype,"multiTouchPanning",void 0),o.c([Object(n.c)()],t.prototype,"multiTouchPanAndZoom",void 0),t}();a.a.ArcRotateCameraPointersInput=c},177:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var o=i(34),n=function(){function t(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return t.prototype.attachControl=function(t,e){this.camera.attachControl(t,e),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},t.prototype._onOrientationEvent=function(t){null!==t.alpha&&(this._alpha=(0|+t.alpha)*this.alphaCorrection),null!==t.gamma&&(this._gamma=(0|+t.gamma)*this.gammaCorrection),this._dirty=!0},t.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},t.prototype.detachControl=function(t){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},t.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},t.prototype.getSimpleName=function(){return"VRDeviceOrientation"},t}();o.a.ArcRotateCameraVRDeviceOrientationInput=n},178:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var o=i(34),n=i(0),r=i(5),a=function(){function t(){var t=this;this._screenOrientationAngle=0,this._screenQuaternion=new n.Quaternion,this._alpha=0,this._beta=0,this._gamma=0,this._orientationChanged=function(){t._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,t._screenOrientationAngle=-r.h.ToRadians(t._screenOrientationAngle/2),t._screenQuaternion.copyFromFloats(0,Math.sin(t._screenOrientationAngle),0,Math.cos(t._screenOrientationAngle))},this._deviceOrientation=function(e){t._alpha=null!==e.alpha?e.alpha:0,t._beta=null!==e.beta?e.beta:0,t._gamma=null!==e.gamma?e.gamma:0},this._constantTranform=new n.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(t){this._camera=t,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new n.Quaternion)},enumerable:!0,configurable:!0}),t.prototype.attachControl=function(t,e){window.addEventListener("orientationchange",this._orientationChanged),window.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()},t.prototype.detachControl=function(t){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation)},t.prototype.checkInputs=function(){this._alpha&&(n.Quaternion.RotationYawPitchRollToRef(r.h.ToRadians(this._alpha),r.h.ToRadians(this._beta),-r.h.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},t.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},t.prototype.getSimpleName=function(){return"deviceOrientation"},t}();o.a.FreeCameraDeviceOrientationInput=a},179:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var o=i(1),n=i(2),r=i(34),a=i(0),s=i(52),c=function(){function t(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._cameraTransform=a.Matrix.Identity(),this._deltaTransform=a.Vector3.Zero(),this._vector3=a.Vector3.Zero(),this._vector2=a.Vector2.Zero()}return t.prototype.attachControl=function(t,e){var i=this,o=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=o.onGamepadConnectedObservable.add(function(t){t.type!==s.a.POSE_ENABLED&&(i.gamepad&&t.type!==s.a.XBOX||(i.gamepad=t))}),this._onGamepadDisconnectedObserver=o.onGamepadDisconnectedObservable.add(function(t){i.gamepad===t&&(i.gamepad=null)}),this.gamepad=o.getGamepadByType(s.a.XBOX)},t.prototype.detachControl=function(t){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},t.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var t=this.camera,e=this.gamepad.leftStick,i=e.x/this.gamepadMoveSensibility,o=e.y/this.gamepadMoveSensibility;e.x=Math.abs(i)>.005?0+i:0,e.y=Math.abs(o)>.005?0+o:0;var n=this.gamepad.rightStick;if(n){var r=n.x/this.gamepadAngularSensibility,s=n.y/this.gamepadAngularSensibility;n.x=Math.abs(r)>.001?0+r:0,n.y=Math.abs(s)>.001?0+s:0}else n={x:0,y:0};t.rotationQuaternion?t.rotationQuaternion.toRotationMatrix(this._cameraTransform):a.Matrix.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,this._cameraTransform);var c=50*t._computeLocalCameraSpeed();this._vector3.copyFromFloats(e.x*c,0,-e.y*c),a.Vector3.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),t.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(n.y,n.x),t.cameraRotation.addInPlace(this._vector2)}},t.prototype.getClassName=function(){return"FreeCameraGamepadInput"},t.prototype.getSimpleName=function(){return"gamepad"},o.c([Object(n.c)()],t.prototype,"gamepadAngularSensibility",void 0),o.c([Object(n.c)()],t.prototype,"gamepadMoveSensibility",void 0),t}();r.a.FreeCameraGamepadInput=c},180:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var o=i(1),n=i(2),r=i(34),a=i(57),s=i(0),c=function(){function t(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}return t.prototype.attachControl=function(t,e){var i=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){i._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(t){var o,n=t.event;n.metaKey||(t.type===a.a.KEYDOWN?-1===i.keysUp.indexOf(n.keyCode)&&-1===i.keysDown.indexOf(n.keyCode)&&-1===i.keysLeft.indexOf(n.keyCode)&&-1===i.keysRight.indexOf(n.keyCode)||(-1===(o=i._keys.indexOf(n.keyCode))&&i._keys.push(n.keyCode),e||n.preventDefault()):-1===i.keysUp.indexOf(n.keyCode)&&-1===i.keysDown.indexOf(n.keyCode)&&-1===i.keysLeft.indexOf(n.keyCode)&&-1===i.keysRight.indexOf(n.keyCode)||((o=i._keys.indexOf(n.keyCode))>=0&&i._keys.splice(o,1),e||n.preventDefault()))}))},t.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var i=this._keys[e],o=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?t._localDirection.copyFromFloats(-o,0,0):-1!==this.keysUp.indexOf(i)?t._localDirection.copyFromFloats(0,0,o):-1!==this.keysRight.indexOf(i)?t._localDirection.copyFromFloats(o,0,0):-1!==this.keysDown.indexOf(i)&&t._localDirection.copyFromFloats(0,0,-o),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),s.Vector3.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},t.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},t.prototype._onLostFocus=function(){this._keys=[]},t.prototype.getSimpleName=function(){return"keyboard"},o.c([Object(n.c)()],t.prototype,"keysUp",void 0),o.c([Object(n.c)()],t.prototype,"keysDown",void 0),o.c([Object(n.c)()],t.prototype,"keysLeft",void 0),o.c([Object(n.c)()],t.prototype,"keysRight",void 0),t}();r.a.FreeCameraKeyboardMoveInput=c},181:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var o=i(1),n=i(2),r=i(34),a=i(13),s=function(){function t(t){void 0===t&&(t=!0),this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null}return t.prototype.attachControl=function(t,e){var i=this,o=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(n){var r=n.event;if(!o.isInVRExclusivePointerMode&&(i.touchEnabled||"touch"!==r.pointerType)&&(n.type===a.a.POINTERMOVE||-1!==i.buttons.indexOf(r.button))){var s=r.srcElement||r.target;if(n.type===a.a.POINTERDOWN&&s){try{s.setPointerCapture(r.pointerId)}catch(t){}i.previousPosition={x:r.clientX,y:r.clientY},e||(r.preventDefault(),t.focus())}else if(n.type===a.a.POINTERUP&&s){try{s.releasePointerCapture(r.pointerId)}catch(t){}i.previousPosition=null,e||r.preventDefault()}else if(n.type===a.a.POINTERMOVE){if(!i.previousPosition||o.isPointerLock)return;var c=r.clientX-i.previousPosition.x;i.camera.getScene().useRightHandedSystem&&(c*=-1),i.camera.parent&&i.camera.parent._getWorldMatrixDeterminant()<0&&(c*=-1),i.camera.cameraRotation.y+=c/i.angularSensibility;var h=r.clientY-i.previousPosition.y;i.camera.cameraRotation.x+=h/i.angularSensibility,i.previousPosition={x:r.clientX,y:r.clientY},e||r.preventDefault()}}}),this._onMouseMove=function(t){if(o.isPointerLock&&!o.isInVRExclusivePointerMode){var n=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0;i.camera.getScene().useRightHandedSystem&&(n*=-1),i.camera.parent&&i.camera.parent._getWorldMatrixDeterminant()<0&&(n*=-1),i.camera.cameraRotation.y+=n/i.angularSensibility;var r=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0;i.camera.cameraRotation.x+=r/i.angularSensibility,i.previousPosition=null,e||t.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,a.a.POINTERDOWN|a.a.POINTERUP|a.a.POINTERMOVE),t.addEventListener("mousemove",this._onMouseMove,!1)},t.prototype.detachControl=function(t){this._observer&&t&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&t.removeEventListener("mousemove",this._onMouseMove),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},t.prototype.getClassName=function(){return"FreeCameraMouseInput"},t.prototype.getSimpleName=function(){return"mouse"},o.c([Object(n.c)()],t.prototype,"buttons",void 0),o.c([Object(n.c)()],t.prototype,"angularSensibility",void 0),t}();r.a.FreeCameraMouseInput=s},182:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var o=i(1),n=i(2),r=i(34),a=i(13),s=i(0),c=function(){function t(){this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}return t.prototype.attachControl=function(t,e){var i=this,o=null;void 0===this._pointerInput&&(this._onLostFocus=function(){i._offsetX=null,i._offsetY=null},this._pointerInput=function(t){var n=t.event;if("mouse"!==n.pointerType)if(t.type===a.a.POINTERDOWN){if(e||n.preventDefault(),i._pointerPressed.push(n.pointerId),1!==i._pointerPressed.length)return;o={x:n.clientX,y:n.clientY}}else if(t.type===a.a.POINTERUP){if(e||n.preventDefault(),-1===(r=i._pointerPressed.indexOf(n.pointerId)))return;if(i._pointerPressed.splice(r,1),0!=r)return;o=null,i._offsetX=null,i._offsetY=null}else if(t.type===a.a.POINTERMOVE){if(e||n.preventDefault(),!o)return;var r;if(0!=(r=i._pointerPressed.indexOf(n.pointerId)))return;i._offsetX=n.clientX-o.x,i._offsetY=-(n.clientY-o.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,a.a.POINTERDOWN|a.a.POINTERUP|a.a.POINTERMOVE),this._onLostFocus&&t.addEventListener("blur",this._onLostFocus)},t.prototype.detachControl=function(t){this._pointerInput&&t&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(t.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},t.prototype.checkInputs=function(){if(this._offsetX&&this._offsetY){var t=this.camera;if(t.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)t.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var e=t._computeLocalCameraSpeed(),i=new s.Vector3(0,0,e*this._offsetY/this.touchMoveSensibility);s.Matrix.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(s.Vector3.TransformCoordinates(i,t._cameraRotationMatrix))}}},t.prototype.getClassName=function(){return"FreeCameraTouchInput"},t.prototype.getSimpleName=function(){return"touch"},o.c([Object(n.c)()],t.prototype,"touchAngularSensibility",void 0),o.c([Object(n.c)()],t.prototype,"touchMoveSensibility",void 0),t}();r.a.FreeCameraTouchInput=c},183:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var o=i(104),n=i(34),r=i(0),a=function(){function t(){}return t.prototype.getLeftJoystick=function(){return this._leftjoystick},t.prototype.getRightJoystick=function(){return this._rightjoystick},t.prototype.checkInputs=function(){if(this._leftjoystick){var t=this.camera,e=50*t._computeLocalCameraSpeed(),i=r.Matrix.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),o=r.Vector3.TransformCoordinates(new r.Vector3(this._leftjoystick.deltaPosition.x*e,this._leftjoystick.deltaPosition.y*e,this._leftjoystick.deltaPosition.z*e),i);t.cameraDirection=t.cameraDirection.add(o),t.cameraRotation=t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},t.prototype.attachControl=function(t,e){this._leftjoystick=new o.b(!0),this._leftjoystick.setAxisForUpDown(o.a.Z),this._leftjoystick.setAxisForLeftRight(o.a.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new o.b(!1),this._rightjoystick.setAxisForUpDown(o.a.X),this._rightjoystick.setAxisForLeftRight(o.a.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},t.prototype.detachControl=function(t){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},t.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},t.prototype.getSimpleName=function(){return"virtualJoystick"},t}();n.a.FreeCameraVirtualJoystickInput=a},184:function(t,e,i){"use strict";i.d(e,"a",function(){return V});var o=i(1),n=i(9),r=i(7),a=i(48),s=i(63),c=i(131),h=i(132),l=i(185),u=i(13),p=i(0),d=i(52),_=i(42),m=i(61),f=i(116),g=i(10),y=i(35),v=i(40),b=i(31),C=i(77),R=i(133),M=i(73),P=i(16),x=function(){function t(e,i){if(void 0===i&&(i=null),this.scene=e,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=t._idCounter++,i)this._gazeTracker=i.clone("gazeTracker");else{this._gazeTracker=g.a.CreateTorus("gazeTracker",.0035,.0025,20,e,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var o=new b.StandardMaterial("targetMat",e);o.specularColor=p.Color3.Black(),o.emissiveColor=new p.Color3(.7,.7,.7),o.backFaceCulling=!1,this._gazeTracker.material=o}}return t.prototype._getForwardRay=function(t){return new y.a(p.Vector3.Zero(),new p.Vector3(0,0,t))},t.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},t.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},t.prototype._activatePointer=function(){this._activePointer=!0},t.prototype._deactivatePointer=function(){this._activePointer=!1},t.prototype._updatePointerDistance=function(){},t.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},t._idCounter=0,t}(),T=function(t){function e(e,i,o){var n=t.call(this,i,o)||this;n.webVRController=e,n._laserPointer=g.a.CreateCylinder("laserPointer",1,.004,2e-4,20,1,i,!1);var r=new b.StandardMaterial("laserPointerMat",i);if(r.emissiveColor=new p.Color3(.7,.7,.7),r.alpha=.6,n._laserPointer.material=r,n._laserPointer.rotation.x=Math.PI/2,n._laserPointer.position.z=-.5,n._laserPointer.isVisible=!1,n._laserPointer.isPickable=!1,!e.mesh){var a=new g.a("preloadControllerMesh",i),s=new g.a(_.a.POINTING_POSE,i);s.rotation.x=-.7,a.addChild(s),e.attachToMesh(a)}return n._setLaserPointerParent(e.mesh),n._meshAttachedObserver=e._meshAttachedObservable.add(function(t){n._setLaserPointerParent(t)}),n}return o.d(e,t),e.prototype._getForwardRay=function(t){return this.webVRController.getForwardRay(t)},e.prototype._activatePointer=function(){t.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},e.prototype._deactivatePointer=function(){t.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},e.prototype._setLaserPointerColor=function(t){this._laserPointer.material.emissiveColor=t},e.prototype._setLaserPointerParent=function(t){var e=function(t){t.isPickable=!1,t.getChildMeshes().forEach(function(t){e(t)})};e(t);var i=t.getChildren(void 0,!1),o=t;this.webVRController._pointingPoseNode=null;for(var n=0;n<i.length;n++)if(i[n].name&&i[n].name.indexOf(_.a.POINTING_POSE)>=0){o=i[n],this.webVRController._pointingPoseNode=o;break}this._laserPointer.parent=o},e.prototype._updatePointerDistance=function(t){void 0===t&&(t=100),this._laserPointer.scaling.y=t,this._laserPointer.position.z=-t/2},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},e}(x),O=function(t){function e(e,i){var o=t.call(this,i)||this;return o.getCamera=e,o}return o.d(e,t),e.prototype._getForwardRay=function(t){var e=this.getCamera();return e?e.getForwardRay(t):new y.a(p.Vector3.Zero(),p.Vector3.Forward())},e}(x),V=function(){function t(t,e){void 0===e&&(e={});var i=this;if(this.webVROptions=e,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.onEnteringVRObservable=new r.c,this.onExitingVRObservable=new r.c,this.onControllerMeshLoadedObservable=new r.c,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._rotationAllowed=!0,this._teleportBackwardsVector=new p.Vector3(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new p.Vector3(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this.onNewMeshSelected=new r.c,this.onNewMeshPicked=new r.c,this.onBeforeCameraTeleport=new r.c,this.onAfterCameraTeleport=new r.c,this.onSelectedMeshUnselected=new r.c,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this._onResize=function(){i.moveButtonToBottomRight(),i._fullscreenVRpresenting&&i._webVRready&&i.exitVR()},this._onFullscreenChange=function(){void 0!==document.fullscreen?i._fullscreenVRpresenting=document.fullscreen:void 0!==document.mozFullScreen?i._fullscreenVRpresenting=document.mozFullScreen:void 0!==document.webkitIsFullScreen?i._fullscreenVRpresenting=document.webkitIsFullScreen:void 0!==document.msIsFullScreen?i._fullscreenVRpresenting=document.msIsFullScreen:void 0!==document.msFullscreenElement&&(i._fullscreenVRpresenting=document.msFullscreenElement),!i._fullscreenVRpresenting&&i._canvas&&(i.exitVR(),i._useCustomVRButton||(i._btnVR.style.top=i._canvas.offsetTop+i._canvas.offsetHeight-70+"px",i._btnVR.style.left=i._canvas.offsetLeft+i._canvas.offsetWidth-100+"px"))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this.beforeRender=function(){i._leftController&&i._leftController._activePointer&&i._castRayAndSelectObject(i._leftController),i._rightController&&i._rightController._activePointer&&i._castRayAndSelectObject(i._rightController),i._noControllerIsActive?i._castRayAndSelectObject(i._cameraGazer):i._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(t){if(t.type!==d.a.POSE_ENABLED)t.leftStick&&t.onleftstickchanged(function(t){i._teleportationInitialized&&i.teleportationEnabled&&(!i._leftController&&!i._rightController||i._leftController&&!i._leftController._activePointer&&i._rightController&&!i._rightController._activePointer)&&(i._checkTeleportWithRay(t,i._cameraGazer),i._checkTeleportBackwards(t,i._cameraGazer))}),t.rightStick&&t.onrightstickchanged(function(t){i._teleportationInitialized&&i._checkRotate(t,i._cameraGazer)}),t.type===d.a.XBOX&&(t.onbuttondown(function(t){i._interactionsEnabled&&t===f.a.A&&i._cameraGazer._selectionPointerDown()}),t.onbuttonup(function(t){i._interactionsEnabled&&t===f.a.A&&i._cameraGazer._selectionPointerUp()}));else{var e=t,o=new T(e,i._scene,i._cameraGazer._gazeTracker);"right"===e.hand||i._leftController&&i._leftController.webVRController!=e?i._rightController=o:i._leftController=o,i._tryEnableInteractionOnController(o)}},this._tryEnableInteractionOnController=function(t){i._interactionsRequested&&!t._interactionsEnabled&&i._enableInteractionOnController(t),i._teleportationRequested&&!t._teleportationEnabled&&i._enableTeleportationOnController(t)},this._onNewGamepadDisconnected=function(t){t instanceof m.a&&("left"===t.hand&&null!=i._leftController&&(i._leftController.dispose(),i._leftController=null),"right"===t.hand&&null!=i._rightController&&(i._rightController.dispose(),i._rightController=null))},this._workingVector=p.Vector3.Zero(),this._workingQuaternion=p.Quaternion.Identity(),this._workingMatrix=p.Matrix.Identity(),this._scene=t,this._canvas=t.getEngine().getRenderingCanvas(),void 0===e.createFallbackVRDeviceOrientationFreeCamera&&(e.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===e.createDeviceOrientationCamera&&(e.createDeviceOrientationCamera=!0),void 0===e.laserToggle&&(e.laserToggle=!0),void 0===e.defaultHeight&&(e.defaultHeight=1.7),e.useCustomVRButton&&(this._useCustomVRButton=!0,e.customVRButton&&(this._btnVR=e.customVRButton)),e.rayLength&&(this._rayLength=e.rayLength),this._defaultHeight=e.defaultHeight,e.positionScale&&(this._rayLength*=e.positionScale,this._defaultHeight*=e.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new p.Vector3(0,this._defaultHeight,0),e.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new c.a("deviceOrientationVRHelper",this._position.clone(),t),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof s.a&&this._scene.activeCamera.rotation)){var o=this._scene.activeCamera;o.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(o.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(p.Quaternion.RotationYawPitchRoll(o.rotation.y,o.rotation.x,o.rotation.z)),this._deviceOrientationCamera.rotation=o.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)}else this._existingCamera=this._scene.activeCamera;if(e.createFallbackVRDeviceOrientationFreeCamera&&(this._vrDeviceOrientationCamera=new h.a("VRDeviceOrientationVRHelper",this._position,this._scene),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new l.a("WebVRHelper",this._position,this._scene,e),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new O(function(){return i.currentVRCamera},t),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";".babylonVRicon.vrdisplaypresenting { display: none; }";var n=document.createElement("style");n.appendChild(document.createTextNode(".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }.babylonVRicon.vrdisplaypresenting { display: none; }")),document.getElementsByTagName("head")[0].appendChild(n),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){i.isInVRMode?i.exitVR():i.enterVR()}),window.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,e.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(t){t.vrDisplay&&i.displayVRButton()}),this._onKeyDown=function(t){27===t.keyCode&&i.isInVRMode&&i.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(){i.isInVRMode&&(i.exitVR(),i._fullscreenVRpresenting&&i._scene.getEngine().switchFullscreen(!0))},u.a.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(t){return i.onVRDisplayChanged(t)},this._onVrDisplayPresentChange=function(){return i.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){i._webVRrequesting=!0,i.updateButtonVisibility()},this._onVRRequestPresentComplete=function(){i._webVRrequesting=!1,i.updateButtonVisibility()},t.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),t.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),t.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),t.onDisposeObservable.add(function(){i.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(t){return i._onDefaultMeshLoaded(t)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new M.d,this._circleEase.setEasingMode(M.f.EASINGMODE_EASEINOUT),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes})}return Object.defineProperty(t.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(t){t&&(t.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(t){t&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=t,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(t){this._displayGaze=t,t||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(t){this._displayLaserPointer=t,t?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_teleportationRequestInitiated",{get:function(){return this._cameraGazer._teleportationRequestInitiated||null!==this._leftController&&this._leftController._teleportationRequestInitiated||null!==this._rightController&&this._rightController._teleportationRequestInitiated},enumerable:!0,configurable:!0}),t.prototype._onDefaultMeshLoaded=function(t){this._leftController&&this._leftController.webVRController==t&&t.mesh&&this._leftController._setLaserPointerParent(t.mesh),this._rightController&&this._rightController.webVRController==t&&t.mesh&&this._rightController._setLaserPointerParent(t.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(t)}catch(t){n.a.Warn("Error in your custom logic onControllerMeshLoaded: "+t)}},Object.defineProperty(t.prototype,"isInVRMode",{get:function(){return this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!0,configurable:!0}),t.prototype.onVrDisplayPresentChange=function(){var t=this._scene.getEngine().getVRDevice();if(t){var e=this._webVRpresenting;this._webVRpresenting=t.isPresenting,e&&!this._webVRpresenting&&this.exitVR()}else n.a.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},t.prototype.onVRDisplayChanged=function(t){this._webVRsupported=t.vrSupported,this._webVRready=!!t.vrDisplay,this._webVRpresenting=t.vrDisplay&&t.vrDisplay.isPresenting,this.updateButtonVisibility()},t.prototype.moveButtonToBottomRight=function(){this._canvas&&!this._useCustomVRButton&&(this._btnVR.style.top=this._canvas.offsetTop+this._canvas.offsetHeight-70+"px",this._btnVR.style.left=this._canvas.offsetLeft+this._canvas.offsetWidth-100+"px")},t.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},t.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},t.prototype.enterVR=function(){if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(t){n.a.Warn("Error in your custom logic onEnteringVR: "+t)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=p.Quaternion.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this.webVRCamera){var t=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,e=p.Quaternion.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y-t,i=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=p.Quaternion.FromEulerAngles(0,i+e,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().switchFullscreen(!0),this.updateButtonVisibility()),this._scene.activeCamera&&this._canvas&&this._scene.activeCamera.attachControl(this._canvas),this._interactionsEnabled&&this._scene.registerBeforeRender(this.beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach(function(t){t&&t._activatePointer()}),this._hasEnteredVR=!0)},t.prototype.exitVR=function(){if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(t){n.a.Warn("Error in your custom logic onExitingVR: "+t)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas),this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this.updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this.beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach(function(t){t&&t._deactivatePointer()}),this._hasEnteredVR=!1}},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._scene.activeCamera&&(this._scene.activeCamera.position=t)},enumerable:!0,configurable:!0}),t.prototype.enableInteractions=function(){var t=this;this._interactionsEnabled||(this._interactionsRequested=!0,this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(e){return e.isVisible&&(e.isPickable||e.name===t._floorMeshName)},this.meshSelectionPredicate=function(){return!0},this._raySelectionPredicate=function(e){return!!(t._isTeleportationFloor(e)||-1===e.name.indexOf("gazeTracker")&&-1===e.name.indexOf("teleportationTarget")&&-1===e.name.indexOf("torusTeleportation"))&&t.raySelectionPredicate(e)},this._interactionsEnabled=!0)},Object.defineProperty(t.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)},enumerable:!0,configurable:!0}),t.prototype._isTeleportationFloor=function(t){for(var e=0;e<this._floorMeshesCollection.length;e++)if(this._floorMeshesCollection[e].id===t.id)return!0;return!(!this._floorMeshName||t.name!==this._floorMeshName)},t.prototype.addFloorMesh=function(t){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(t)>-1||this._floorMeshesCollection.push(t))},t.prototype.removeFloorMesh=function(t){if(this._floorMeshesCollection){var e=this._floorMeshesCollection.indexOf(t);-1!==e&&this._floorMeshesCollection.splice(e,1)}},t.prototype.enableTeleportation=function(t){if(void 0===t&&(t={}),!this._teleportationInitialized){this._teleportationRequested=!0,this.enableInteractions(),t.floorMeshName&&(this._floorMeshName=t.floorMeshName),t.floorMeshes&&(this._floorMeshesCollection=t.floorMeshes),null!=this._leftController&&this._enableTeleportationOnController(this._leftController),null!=this._rightController&&this._enableTeleportationOnController(this._rightController);var e=new v.a;e.vignetteColor=new p.Color4(0,0,0,0),e.vignetteEnabled=!0,this._postProcessMove=new R.a("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,e),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},t.prototype._enableInteractionOnController=function(t){var e=this;t.webVRController.mesh&&(t._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&t._activatePointer(),this.webVROptions.laserToggle&&t.webVRController.onMainButtonStateChangedObservable.add(function(i){e._displayLaserPointer&&1===i.value&&(t._activePointer?t._deactivatePointer():t._activatePointer(),e.displayGaze&&(t._gazeTracker.isVisible=t._activePointer))}),t.webVRController.onTriggerStateChangedObservable.add(function(i){var o=t;e._noControllerIsActive&&(o=e._cameraGazer),o._pointerDownOnMeshAsked?i.value<e._padSensibilityDown&&o._selectionPointerUp():i.value>e._padSensibilityUp&&o._selectionPointerDown()}))},t.prototype._checkTeleportWithRay=function(t,e){this._teleportationRequestInitiated&&!e._teleportationRequestInitiated||(e._teleportationRequestInitiated?Math.sqrt(t.y*t.y+t.x*t.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),e._teleportationRequestInitiated=!1):t.y<-this._padSensibilityUp&&e._dpadPressed&&(e._activatePointer(),e._teleportationRequestInitiated=!0))},t.prototype._checkRotate=function(t,e){e._teleportationRequestInitiated||(e._rotationLeftAsked?t.x>-this._padSensibilityDown&&(e._rotationLeftAsked=!1):t.x<-this._padSensibilityUp&&e._dpadPressed&&(e._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),e._rotationRightAsked?t.x<this._padSensibilityDown&&(e._rotationRightAsked=!1):t.x>this._padSensibilityUp&&e._dpadPressed&&(e._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},t.prototype._checkTeleportBackwards=function(t,e){if(!e._teleportationRequestInitiated)if(t.y>this._padSensibilityUp&&e._dpadPressed){if(!e._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var i=p.Quaternion.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),o=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(i=this.currentVRCamera.deviceRotationQuaternion,o=this.currentVRCamera.devicePosition),i.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,p.Quaternion.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),p.Vector3.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var n=new y.a(o,this._workingVector),r=this._scene.pickWithRay(n,this._raySelectionPredicate);r&&r.pickedPoint&&r.pickedMesh&&this._isTeleportationFloor(r.pickedMesh)&&r.distance<5&&this.teleportCamera(r.pickedPoint),e._teleportationBackRequestInitiated=!0}}else e._teleportationBackRequestInitiated=!1},t.prototype._enableTeleportationOnController=function(t){var e=this;t.webVRController.mesh&&(t._interactionsEnabled||this._enableInteractionOnController(t),t._interactionsEnabled=!0,t._teleportationEnabled=!0,t.webVRController.controllerType===_.c.VIVE&&(t._dpadPressed=!1,t.webVRController.onPadStateChangedObservable.add(function(e){t._dpadPressed=e.pressed,t._dpadPressed||(t._rotationLeftAsked=!1,t._rotationRightAsked=!1,t._teleportationBackRequestInitiated=!1)})),t.webVRController.onPadValuesChangedObservable.add(function(i){e.teleportationEnabled&&(e._checkTeleportBackwards(i,t),e._checkTeleportWithRay(i,t)),e._checkRotate(i,t)}))},t.prototype._createTeleportationCircles=function(){this._teleportationTarget=g.a.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var t=new C.a("DynamicTexture",512,this._scene,!0);t.hasAlpha=!0;var e=t.getContext();e.beginPath(),e.arc(256,256,200,0,2*Math.PI,!1),e.fillStyle=this._teleportationFillColor,e.fill(),e.lineWidth=10,e.strokeStyle=this._teleportationBorderColor,e.stroke(),e.closePath(),t.update();var i=new b.StandardMaterial("TextPlaneMaterial",this._scene);i.diffuseTexture=t,this._teleportationTarget.material=i;var o=g.a.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);o.isPickable=!1,o.parent=this._teleportationTarget;var n=new P.a("animationInnerCircle","position.y",30,P.a.ANIMATIONTYPE_FLOAT,P.a.ANIMATIONLOOPMODE_CYCLE),r=[];r.push({frame:0,value:0}),r.push({frame:30,value:.4}),r.push({frame:60,value:0}),n.setKeys(r);var a=new M.m;a.setEasingMode(M.f.EASINGMODE_EASEINOUT),n.setEasingFunction(a),o.animations=[],o.animations.push(n),this._scene.beginAnimation(o,0,60,!0),this._hideTeleportationTarget()},t.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},t.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},t.prototype._rotateCamera=function(t){var e=this;if(this.currentVRCamera instanceof a.a){t?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var i=p.Quaternion.FromRotationMatrix(p.Matrix.RotationY(Math.PI/4*this._rotationAngle)),o=new P.a("animationRotation","rotationQuaternion",90,P.a.ANIMATIONTYPE_QUATERNION,P.a.ANIMATIONLOOPMODE_CONSTANT),n=[];n.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),n.push({frame:6,value:i}),o.setKeys(n),o.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(o),this._postProcessMove.animations=[];var r=new P.a("animationPP","vignetteWeight",90,P.a.ANIMATIONTYPE_FLOAT,P.a.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:0}),s.push({frame:3,value:4}),s.push({frame:6,value:0}),r.setKeys(s),r.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(r);var c=new P.a("animationPP2","vignetteStretch",90,P.a.ANIMATIONTYPE_FLOAT,P.a.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:0}),h.push({frame:3,value:10}),h.push({frame:6,value:0}),c.setKeys(h),c.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(c),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){e._webVRCamera.detachPostProcess(e._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},t.prototype._moveTeleportationSelectorTo=function(t,e,i){if(t.pickedPoint){e._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(t.pickedPoint),this._teleportationTarget.position.copyFrom(t.pickedPoint));var o=this._convertNormalToDirectionOfRay(t.getNormal(!0,!1),i);if(o){var n=p.Vector3.Cross(p.Axis.Y,o),r=p.Vector3.Cross(o,n);p.Vector3.RotationFromAxisToRef(r,o,n,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},t.prototype.teleportCamera=function(t){var e=this;if(this.currentVRCamera instanceof a.a){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),t.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(t),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector),this.currentVRCamera.animations=[];var i=new P.a("animationCameraTeleportation","position",90,P.a.ANIMATIONTYPE_VECTOR3,P.a.ANIMATIONLOOPMODE_CONSTANT),o=[{frame:0,value:this.currentVRCamera.position},{frame:11,value:this._workingVector}];i.setKeys(o),i.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(i),this._postProcessMove.animations=[];var n=new P.a("animationPP","vignetteWeight",90,P.a.ANIMATIONTYPE_FLOAT,P.a.ANIMATIONLOOPMODE_CONSTANT),r=[];r.push({frame:0,value:0}),r.push({frame:5,value:8}),r.push({frame:11,value:0}),n.setKeys(r),this._postProcessMove.animations.push(n);var s=new P.a("animationPP2","vignetteStretch",90,P.a.ANIMATIONTYPE_FLOAT,P.a.ANIMATIONLOOPMODE_CONSTANT),c=[];c.push({frame:0,value:0}),c.push({frame:5,value:10}),c.push({frame:11,value:0}),s.setKeys(c),this._postProcessMove.animations.push(s),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,11,!1,1,function(){e._webVRCamera.detachPostProcess(e._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,11,!1,1,function(){e.onAfterCameraTeleport.notifyObservers(e._workingVector)}),this._hideTeleportationTarget()}},t.prototype._convertNormalToDirectionOfRay=function(t,e){t&&(Math.acos(p.Vector3.Dot(t,e.direction))<Math.PI/2&&t.scaleInPlace(-1));return t},t.prototype._castRayAndSelectObject=function(t){if(this.currentVRCamera instanceof a.a){var e=t._getForwardRay(this._rayLength),i=this._scene.pickWithRay(e,this._raySelectionPredicate);if(i&&(t._laserPointer&&(i.originMesh=t._laserPointer.parent),this._scene.simulatePointerMove(i,{pointerId:t._id})),t._currentHit=i,i&&i.pickedPoint){if(this._displayGaze){var o=1;t._gazeTracker.isVisible=!0,t._isActionableMesh&&(o=3),this.updateGazeTrackerScale&&(t._gazeTracker.scaling.x=i.distance*o,t._gazeTracker.scaling.y=i.distance*o,t._gazeTracker.scaling.z=i.distance*o);var r=this._convertNormalToDirectionOfRay(i.getNormal(),e);if(r){var s=p.Vector3.Cross(p.Axis.Y,r),c=p.Vector3.Cross(r,s);p.Vector3.RotationFromAxisToRef(c,r,s,t._gazeTracker.rotation)}t._gazeTracker.position.copyFrom(i.pickedPoint),t._gazeTracker.position.x<0?t._gazeTracker.position.x+=.002:t._gazeTracker.position.x-=.002,t._gazeTracker.position.y<0?t._gazeTracker.position.y+=.002:t._gazeTracker.position.y-=.002,t._gazeTracker.position.z<0?t._gazeTracker.position.z+=.002:t._gazeTracker.position.z-=.002}t._updatePointerDistance()}else t._updatePointerDistance(),t._gazeTracker.isVisible=!1;if(i&&i.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(i.pickedMesh)&&i.pickedPoint)return t._currentMeshSelected&&!this._isTeleportationFloor(t._currentMeshSelected)&&this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,void(t._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(i,t,e));if(i.pickedMesh!==t._currentMeshSelected)if(this.meshSelectionPredicate(i.pickedMesh)){this.onNewMeshPicked.notifyObservers(i),t._currentMeshSelected=i.pickedMesh,i.pickedMesh.isPickable&&i.pickedMesh.actionManager?(this.changeGazeColor(new p.Color3(0,0,1)),this.changeLaserColor(new p.Color3(.2,.2,1)),t._isActionableMesh=!0):(this.changeGazeColor(new p.Color3(.7,.7,.7)),this.changeLaserColor(new p.Color3(.7,.7,.7)),t._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(i.pickedMesh)}catch(t){n.a.Warn("Error in your custom logic onNewMeshSelected: "+t)}}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(new p.Color3(.7,.7,.7)),this.changeLaserColor(new p.Color3(.7,.7,.7))}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(new p.Color3(.7,.7,.7)),this.changeLaserColor(new p.Color3(.7,.7,.7))}},t.prototype._notifySelectedMeshUnselected=function(t){t&&this.onSelectedMeshUnselected.notifyObservers(t)},t.prototype.changeLaserColor=function(t){this._leftController&&this._leftController._setLaserPointerColor(t),this._rightController&&this._rightController._setLaserPointerColor(t)},t.prototype.changeGazeColor=function(t){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=t,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=t),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=t))},t.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},t.prototype.getClassName=function(){return"VRExperienceHelper"},t}()},185:function(t,e,i){"use strict";i.d(e,"a",function(){return p});var o=i(1),n=i(7),r=i(48),a=i(22),s=i(0),c=i(52),h=i(42),l=i(25),u=i(71);l.a.AddNodeConstructor("WebVRFreeCamera",function(t,e){return function(){return new p(t,s.Vector3.Zero(),e)}}),l.a.AddNodeConstructor("WebVRGamepadCamera",function(t,e){return function(){return new p(t,s.Vector3.Zero(),e)}});var p=function(t){function e(e,i,o,r){void 0===r&&(r={});var c=t.call(this,e,i,o)||this;c.webVROptions=r,c._vrDevice=null,c.rawPose=null,c._specsVersion="1.1",c._attached=!1,c._descendants=[],c._deviceRoomPosition=s.Vector3.Zero(),c._deviceRoomRotationQuaternion=s.Quaternion.Identity(),c._standingMatrix=null,c.devicePosition=s.Vector3.Zero(),c.deviceRotationQuaternion=s.Quaternion.Identity(),c.deviceScaleFactor=1,c._deviceToWorld=s.Matrix.Identity(),c._worldToDevice=s.Matrix.Identity(),c.controllers=[],c.onControllersAttachedObservable=new n.c,c.onControllerMeshLoadedObservable=new n.c,c.onPoseUpdatedFromDeviceObservable=new n.c,c._poseSet=!1,c.rigParenting=!0,c._defaultHeight=void 0,c._htmlElementAttached=null,c._detachIfAttached=function(){var t=c.getEngine().getVRDevice();t&&!t.isPresenting&&c._htmlElementAttached&&c.detachControl(c._htmlElementAttached)},c._workingVector=s.Vector3.Zero(),c._oneVector=s.Vector3.One(),c._workingMatrix=s.Matrix.Identity(),c._tmpMatrix=new s.Matrix,c._cache.position=s.Vector3.Zero(),r.defaultHeight&&(c._defaultHeight=r.defaultHeight,c.position.y=c._defaultHeight),c.minZ=.1,5===arguments.length&&(c.webVROptions=arguments[4]),null==c.webVROptions.trackPosition&&(c.webVROptions.trackPosition=!0),null==c.webVROptions.controllerMeshes&&(c.webVROptions.controllerMeshes=!0),null==c.webVROptions.defaultLightingOnControllers&&(c.webVROptions.defaultLightingOnControllers=!0),c.rotationQuaternion=new s.Quaternion,c.webVROptions&&c.webVROptions.positionScale&&(c.deviceScaleFactor=c.webVROptions.positionScale);var h=c.getEngine();return c._onVREnabled=function(t){t&&c.initControllers()},h.onVRRequestPresentComplete.add(c._onVREnabled),h.initWebVR().add(function(t){t.vrDisplay&&c._vrDevice!==t.vrDisplay&&(c._vrDevice=t.vrDisplay,c.setCameraRigMode(a.a.RIG_MODE_WEBVR,{parentCamera:c,vrDisplay:c._vrDevice,frameData:c._frameData,specs:c._specsVersion}),c._attached&&c.getEngine().enableVR())}),"undefined"!=typeof VRFrameData&&(c._frameData=new VRFrameData),o.onBeforeCameraRenderObservable.add(function(t){t.parent===c&&c.rigParenting&&(c._descendants=c.getDescendants(!0,function(t){var e=c.controllers.some(function(e){return e._mesh===t}),i=-1!==c._rigCameras.indexOf(t);return!e&&!i}),c._descendants.forEach(function(e){e.parent=t}))}),o.onAfterCameraRenderObservable.add(function(t){t.parent===c&&c.rigParenting&&c._descendants.forEach(function(t){t.parent=c})}),c}return o.d(e,t),e.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},e.prototype.useStandingMatrix=function(t){var e=this;void 0===t&&(t=function(t){}),this.getEngine().initWebVRAsync().then(function(i){i.vrDisplay&&i.vrDisplay.stageParameters&&i.vrDisplay.stageParameters.sittingToStandingTransform&&e.webVROptions.trackPosition?(e._standingMatrix=new s.Matrix,s.Matrix.FromFloat32ArrayToRefScaled(i.vrDisplay.stageParameters.sittingToStandingTransform,0,1,e._standingMatrix),e.getScene().useRightHandedSystem||e._standingMatrix&&e._standingMatrix.toggleModelMatrixHandInPlace(),t(!0)):t(!1)})},e.prototype.useStandingMatrixAsync=function(){var t=this;return new Promise(function(e){t.useStandingMatrix(function(t){e(t)})})},e.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),t.prototype.dispose.call(this)},e.prototype.getControllerByName=function(t){for(var e=0,i=this.controllers;e<i.length;e++){var o=i[e];if(o.hand===t)return o}return null},Object.defineProperty(e.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!0,configurable:!0}),e.prototype.getForwardRay=function(e){return void 0===e&&(e=100),this.leftCamera?t.prototype.getForwardRay.call(this,e,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):t.prototype.getForwardRay.call(this,e)},e.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),t.prototype._checkInputs.call(this)},e.prototype.updateFromDevice=function(t){t&&t.orientation&&(this.rawPose=t,this._deviceRoomRotationQuaternion.copyFromFloats(t.orientation[0],t.orientation[1],-t.orientation[2],-t.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},e.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),this._attached=!0,this._htmlElementAttached=e,i=!a.a.ForceAttachControlToAlwaysPreventDefault&&i,this._vrDevice&&this.getEngine().enableVR(),window.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},e.prototype.detachControl=function(e){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),t.prototype.detachControl.call(this,e),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},e.prototype.getClassName=function(){return"WebVRFreeCamera"},e.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},e.prototype._updateRigCameras=function(){var t=this._rigCameras[0],e=this._rigCameras[1];t.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),t.position.copyFrom(this._deviceRoomPosition),e.position.copyFrom(this._deviceRoomPosition)},e.prototype._correctPositionIfNotTrackPosition=function(t,e){void 0===e&&(e=!1),this.rawPose&&this.rawPose.position&&!this.webVROptions.trackPosition&&(s.Matrix.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),e||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(t,t))},e.prototype._updateCache=function(e){var i=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.updateCacheCalled||(this.updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),s.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),s.Matrix.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(t){t._deviceToWorld.copyFrom(i._deviceToWorld),i._correctPositionIfNotTrackPosition(t._deviceToWorld),t.update()})),e||t.prototype._updateCache.call(this),this.updateCacheCalled=!1},e.prototype._computeDevicePosition=function(){s.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},e.prototype.update=function(){this._computeDevicePosition(),s.Matrix.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),s.Quaternion.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),t.prototype.update.call(this)},e.prototype._getViewMatrix=function(){return s.Matrix.Identity()},e.prototype._getWebVRViewMatrix=function(){var t=this._cameraRigParams.parentCamera;t._updateCache();var e=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return s.Matrix.FromArrayToRef(e,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),s.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),1!==t.deviceScaleFactor&&(this._webvrViewMatrix.invert(),t.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,t.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,t.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,t.deviceScaleFactor)),this._webvrViewMatrix.invert()),t._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),t._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||s.Matrix.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(t.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},e.prototype._getWebVRProjectionMatrix=function(){var t=this.parent;t._vrDevice.depthNear=t.minZ,t._vrDevice.depthFar=t.maxZ;var e=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return s.Matrix.FromArrayToRef(e,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix},e.prototype.initControllers=function(){var t=this;this.controllers=[];var e=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add(function(e){if(e.type===c.a.POSE_ENABLED){var i=e;i.defaultModel&&i.defaultModel.setEnabled(!1),"right"===i.hand&&(t._rightController=null),"left"===i.hand&&(t._leftController=null);var o=t.controllers.indexOf(i);-1!==o&&t.controllers.splice(o,1)}}),this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add(function(e){if(e.type===c.a.POSE_ENABLED){var i=e;if(t.webVROptions.trackPosition||(i._disableTrackPosition(new s.Vector3("left"==i.hand?-.15:.15,-.5,.25)),t._updateCacheWhenTrackingDisabledObserver||(t._updateCacheWhenTrackingDisabledObserver=t._scene.onBeforeRenderObservable.add(function(){t._updateCache()}))),i.deviceScaleFactor=t.deviceScaleFactor,i._deviceToWorld.copyFrom(t._deviceToWorld),t._correctPositionIfNotTrackPosition(i._deviceToWorld),t.webVROptions.controllerMeshes&&(i.defaultModel?i.defaultModel.setEnabled(!0):i.initControllerMesh(t.getScene(),function(e){if(e.scaling.scaleInPlace(t.deviceScaleFactor),t.onControllerMeshLoadedObservable.notifyObservers(i),t.webVROptions.defaultLightingOnControllers){t._lightOnControllers||(t._lightOnControllers=new u.HemisphericLight("vrControllersLight",new s.Vector3(0,1,0),t.getScene()));var o=function(t,e){var i=t.getChildren();i&&0!==i.length&&i.forEach(function(t){e.includedOnlyMeshes.push(t),o(t,e)})};t._lightOnControllers.includedOnlyMeshes.push(e),o(e,t._lightOnControllers)}})),i.attachToPoseControlledCamera(t),-1===t.controllers.indexOf(i)){t.controllers.push(i);for(var o=!1,n=0;n<t.controllers.length;n++)t.controllers[n].controllerType===h.c.VIVE&&(o?t.controllers[n].hand="right":(o=!0,t.controllers[n].hand="left"));t.controllers.length>=2&&t.onControllersAttachedObservable.notifyObservers(t.controllers)}}})},e}(r.a)},186:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var o=i(1),n=i(0),r=i(22),a=i(48),s=i(63),c=function(t){function e(e,i){var o=t.call(this,e,n.Vector3.Zero(),i)||this;return o.minZ=0,o.rotationQuaternion=new n.Quaternion,o.cameraRigMode=r.a.RIG_MODE_CUSTOM,o.updateUpVectorFromRotation=!0,o._updateNumberOfRigCameras(1),o}return o.d(e,t),e.prototype._updateNumberOfRigCameras=function(t){for(void 0===t&&(t=1);this.rigCameras.length<t;){var e=new s.a("view: "+this.rigCameras.length,n.Vector3.Zero(),this.getScene());e.minZ=0,e.parent=this,e.rotationQuaternion=new n.Quaternion,e.updateUpVectorFromRotation=!0,this.rigCameras.push(e)}for(;this.rigCameras.length>t;){var i=this.rigCameras.pop();i&&i.dispose()}},e.prototype._updateForDualEyeDebugging=function(t){void 0===t&&(t=.01),this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new n.Viewport(0,0,.5,1),this.rigCameras[0].position.x=-t/2,this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new n.Viewport(.5,0,.5,1),this.rigCameras[1].position.x=t/2,this.rigCameras[1].outputRenderTarget=null},e.prototype.updateFromXRSessionManager=function(t){var i=this;if(!t._currentXRFrame||!t._currentXRFrame.getDevicePose)return!1;var o=t._currentXRFrame.getDevicePose(t._frameOfReference);return!(!o||!o.poseModelMatrix)&&(n.Matrix.FromFloat32ArrayToRefScaled(o.poseModelMatrix,0,1,e._TmpMatrix),this._scene.useRightHandedSystem||e._TmpMatrix.toggleModelMatrixHandInPlace(),e._TmpMatrix.getTranslationToRef(this.position),e._TmpMatrix.getRotationMatrixToRef(e._TmpMatrix),n.Quaternion.FromRotationMatrixToRef(e._TmpMatrix,this.rotationQuaternion),this.computeWorldMatrix(),this._updateNumberOfRigCameras(t._currentXRFrame.views.length),t._currentXRFrame.views.forEach(function(e,r){n.Matrix.FromFloat32ArrayToRefScaled(o.getViewMatrix(e),0,1,i.rigCameras[r]._computedViewMatrix),n.Matrix.FromFloat32ArrayToRefScaled(e.projectionMatrix,0,1,i.rigCameras[r]._projectionMatrix),i._scene.useRightHandedSystem||(i.rigCameras[r]._computedViewMatrix.toggleModelMatrixHandInPlace(),i.rigCameras[r]._projectionMatrix.toggleProjectionMatrixHandInPlace());var a=t._xrSession.baseLayer.getViewport(e),s=t._xrSession.baseLayer.framebufferWidth,c=t._xrSession.baseLayer.framebufferHeight;i.rigCameras[r].viewport.width=a.width/s,i.rigCameras[r].viewport.height=a.height/c,i.rigCameras[r].viewport.x=a.x/s,i.rigCameras[r].viewport.y=a.y/c,i.rigCameras[r].outputRenderTarget=t._sessionRenderTargetTexture}),!0)},e._TmpMatrix=new n.Matrix,e}(a.a)},187:function(t,e,i){"use strict";i.d(e,"b",function(){return a}),i.d(e,"c",function(){return s}),i.d(e,"a",function(){return c});var o=i(1),n=i(7),r=i(85),a=function(){function t(t,e){this.element=t,this.initializationOptions=e}return t.prototype.update=function(t){},t}(),s=function(){return function(){}}(),c=function(){function t(t,e){var i=this;if(this.scene=t,this._buttons=[],this._activeButton=null,this.activeButtonChangedObservable=new n.c,this._overlay=document.createElement("div"),this._overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;",e.customButtons)this._buttons=e.customButtons;else{var o=document.createElement("button");o.style.cssText="color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-repeat:no-repeat; background-position: center; outline: none;",o.innerText="HMD",this._buttons.push(new a(o,{immersive:!0,outputContext:e.outputCanvasContext})),this._buttons[this._buttons.length-1].update=function(t){this.element.style.display=null===t||t===this?"":"none",this.element.innerText=t===this?"EXIT":"HMD"};var r=document.createElement("button");r.style.cssText=o.style.cssText,r.innerText="Window",this._buttons.push(new a(r,{immersive:!1,environmentIntegration:!0,outputContext:e.outputCanvasContext})),this._buttons[this._buttons.length-1].update=function(t){this.element.style.display=null===t||t===this?"":"none",this.element.innerText=t===this?"EXIT":"Window"},this._updateButtons(null)}var s=t.getEngine().getRenderingCanvas();s&&s.parentNode&&(s.parentNode.appendChild(this._overlay),t.onDisposeObservable.addOnce(function(){i.dispose()}))}return t.CreateAsync=function(e,i,n){var a=this,s=new t(e,n),c=s._buttons.map(function(t){return i.supportsSessionAsync(t.initializationOptions)});return i.onStateChangedObservable.add(function(t){t==r.b.NOT_IN_XR&&s._updateButtons(null)}),Promise.all(c).then(function(t){return t.forEach(function(t,e){t&&(s._overlay.appendChild(s._buttons[e].element),s._buttons[e].element.onclick=function(){return o.b(a,void 0,void 0,function(){return o.e(this,function(t){switch(t.label){case 0:return i.state!=r.b.IN_XR?[3,2]:(s._updateButtons(null),[4,i.exitXRAsync()]);case 1:return t.sent(),[2];case 2:return i.state!=r.b.NOT_IN_XR?[3,4]:(s._updateButtons(s._buttons[e]),[4,i.enterXRAsync(s._buttons[e].initializationOptions,"eye-level")]);case 3:t.sent(),t.label=4;case 4:return[2]}})})})}),s})},t.prototype._updateButtons=function(t){var e=this;this._activeButton=t,this._buttons.forEach(function(t){t.update(e._activeButton)}),this.activeButtonChangedObservable.notifyObservers(this._activeButton)},t.prototype.dispose=function(){var t=this.scene.getEngine().getRenderingCanvas();t&&t.parentNode&&t.parentNode.contains(this._overlay)&&t.parentNode.removeChild(this._overlay),this.activeButtonChangedObservable.clear()},t}()},188:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var o=i(9),n=i(7),r=i(0),a=i(30),s=i(39),c=function(){function t(t){this.scene=t,this.onXRFrameObservable=new n.c,this.onXRSessionEnded=new n.c,this._sessionRenderTargetTexture=null,this._tmpMatrix=new r.Matrix}return t.prototype.initializeAsync=function(){var t=this;return o.a.Warn("The WebXR APIs are still under development and are subject to change in the future."),this._xrNavigator=navigator,this._xrNavigator.xr?this._xrNavigator.xr.requestDevice().then(function(e){return t._xrDevice=e,t.scene.getEngine()._gl.setCompatibleXRDevice(t._xrDevice)}):Promise.reject("webXR not supported by this browser")},t.prototype.enterXRAsync=function(e,i){var o=this;return this._xrDevice.requestSession(e).then(function(t){return o._xrSession=t,o._xrSession.addEventListener("end",function(){o._sessionRenderTargetTexture=null,o.scene.getEngine().restoreDefaultFramebuffer(),o.scene.getEngine().customAnimationFrameRequester=null,o.onXRSessionEnded.notifyObservers(null),o.scene.getEngine()._renderLoop()},{once:!0}),o._xrSession.baseLayer=new XRWebGLLayer(o._xrSession,o.scene.getEngine()._gl),o._xrSession.requestFrameOfReference(i)}).then(function(e){o._frameOfReference=e,o.scene.getEngine().customAnimationFrameRequester={requestAnimationFrame:o._xrSession.requestAnimationFrame.bind(o._xrSession),renderFunction:function(t,e){o._currentXRFrame=e,o.onXRFrameObservable.notifyObservers(null),o.scene.getEngine()._renderLoop()}},o._sessionRenderTargetTexture=t._CreateRenderTargetTextureFromSession(o._xrSession,o.scene),window.cancelAnimationFrame(o.scene.getEngine()._frameHandler),o.scene.getEngine()._renderLoop()})},t.prototype.exitXRAsync=function(){return this._xrSession.end()},t.prototype.environmentPointHitTestAsync=function(t){var e=this;return new Promise(function(i){var o=new Float32Array([t.origin.x,t.origin.y,t.origin.z]),n=new Float32Array([t.direction.x,t.direction.y,t.direction.z]);e.scene.useRightHandedSystem||(o[2]*=-1,n[2]*=-1),e._xrSession.requestHitTest(o,n,e._frameOfReference).then(function(t){if(t.length>0){r.Matrix.FromFloat32ArrayToRefScaled(t[0].hitMatrix,0,1,e._tmpMatrix);var o=e._tmpMatrix.getTranslation();e.scene.useRightHandedSystem||(o.z*=-1),i(o)}else i(null)}).catch(function(){i(null)})})},t.prototype.supportsSessionAsync=function(t){return this._xrDevice.supportsSession(t).then(function(){return!0}).catch(function(){return!1})},t._CreateRenderTargetTextureFromSession=function(t,e){var i=new a.a(e.getEngine(),a.a.DATASOURCE_UNKNOWN,!0);i.width=t.baseLayer.framebufferWidth,i.height=t.baseLayer.framebufferHeight,i._framebuffer=t.baseLayer.framebuffer;var o=new s.a("XR renderTargetTexture",{width:i.width,height:i.height},e,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0);return o._texture=i,o},t.prototype.dispose=function(){this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear()},t}()},189:function(t,e,i){"use strict";i.d(e,"a",function(){return r}),i.d(e,"b",function(){return a});var o=i(0),n=i(23),r=function(){function t(t){this.pointer=new n.a("controllerPointer",t)}return t.prototype.dispose=function(){this.grip&&this.grip.dispose(),this.pointer.dispose()},t}(),a=function(){function t(t){var e=this;this.helper=t,this.controllers=[],this._tmpMatrix=new o.Matrix,this._frameObserver=t._sessionManager.onXRFrameObservable.add(function(){if(t._sessionManager._currentXRFrame&&t._sessionManager._currentXRFrame.getDevicePose){var i=t._sessionManager._currentXRFrame;t._sessionManager._xrSession.getInputSources().forEach(function(a,s){var c=i.getInputPose(a,t._sessionManager._frameOfReference);if(c){e.controllers.length<=s&&e.controllers.push(new r(t.container.getScene()));var h=e.controllers[s];c.gripMatrix&&(h.grip||(h.grip=new n.a("controllerGrip",t.container.getScene())),o.Matrix.FromFloat32ArrayToRefScaled(c.gripMatrix,0,1,e._tmpMatrix),h.grip.getScene().useRightHandedSystem||e._tmpMatrix.toggleModelMatrixHandInPlace(),h.grip.rotationQuaternion||(h.grip.rotationQuaternion=new o.Quaternion),e._tmpMatrix.decompose(h.grip.scaling,h.grip.rotationQuaternion,h.grip.position)),o.Matrix.FromFloat32ArrayToRefScaled(c.targetRay.transformMatrix,0,1,e._tmpMatrix),h.pointer.getScene().useRightHandedSystem||e._tmpMatrix.toggleModelMatrixHandInPlace(),h.pointer.rotationQuaternion||(h.pointer.rotationQuaternion=new o.Quaternion),e._tmpMatrix.decompose(h.pointer.scaling,h.pointer.rotationQuaternion,h.pointer.position)}})}})}return t.prototype.dispose=function(){this.controllers.forEach(function(t){t.dispose()}),this.helper._sessionManager.onXRFrameObservable.remove(this._frameObserver)},t}()},190:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var o=i(85),n=function(){function t(t,e){var i=this;this._canvas=null,this.canvasContext=null,e||((e=document.createElement("canvas")).style.cssText="position:absolute; bottom:0px;right:0px;z-index:10;width:100%;height:100%;background-color: #000000;"),this._setManagedOutputCanvas(e),t.onStateChangedObservable.add(function(e){e==o.b.ENTERING_XR?i._addCanvas():t.state==o.b.NOT_IN_XR&&i._removeCanvas()})}return t.prototype.dispose=function(){this._removeCanvas(),this._setManagedOutputCanvas(null)},t.prototype._setManagedOutputCanvas=function(t){this._removeCanvas(),t?(this._canvas=t,this.canvasContext=this._canvas.getContext("xrpresent")):(this._canvas=null,this.canvasContext=null)},t.prototype._addCanvas=function(){this._canvas&&document.body.appendChild(this._canvas)},t.prototype._removeCanvas=function(){this._canvas&&document.body.contains(this._canvas)&&document.body.removeChild(this._canvas)},t}()},22:function(t,e,i){"use strict";i.d(e,"a",function(){return y});var o=i(1),n=i(2),r=i(36),a=i(5),s=i(7),c=i(0),h=i(25),l=i(35),u=i(69),p=i(164),d=i(165),_=i(146),m=i(16),f=i(89),g=i(9),y=function(t){function e(i,o,n,a){void 0===a&&(a=!0);var h=t.call(this,i,n)||this;return h.upVector=c.Vector3.Up(),h.orthoLeft=null,h.orthoRight=null,h.orthoBottom=null,h.orthoTop=null,h.fov=.8,h.minZ=1,h.maxZ=1e4,h.inertia=.9,h.mode=e.PERSPECTIVE_CAMERA,h.isIntermediate=!1,h.viewport=new c.Viewport(0,0,1,1),h.layerMask=268435455,h.fovMode=e.FOVMODE_VERTICAL_FIXED,h.cameraRigMode=e.RIG_MODE_NONE,h.customRenderTargets=new Array,h.outputRenderTarget=null,h.onViewMatrixChangedObservable=new s.c,h.onProjectionMatrixChangedObservable=new s.c,h.onAfterCheckInputsObservable=new s.c,h.onRestoreStateObservable=new s.c,h._rigCameras=new Array,h._webvrViewMatrix=c.Matrix.Identity(),h._skipRendering=!1,h._projectionMatrix=new c.Matrix,h._postProcesses=new Array,h._activeMeshes=new r.a(256),h._globalPosition=c.Vector3.Zero(),h._computedViewMatrix=c.Matrix.Identity(),h._doNotComputeProjectionMatrix=!1,h._transformMatrix=c.Matrix.Zero(),h._refreshFrustumPlanes=!0,h._isCamera=!0,h.getScene().addCamera(h),a&&!h.getScene().activeCamera&&(h.getScene().activeCamera=h),h.position=o,h}return o.d(e,t),e.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},e.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},e.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},e.prototype.getClassName=function(){return"Camera"},e.prototype.toString=function(t){var e="Name: "+this.name;if(e+=", type: "+this.getClassName(),this.animations)for(var i=0;i<this.animations.length;i++)e+=", animation[0]: "+this.animations[i].toString(t);return e},Object.defineProperty(e.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),e.prototype.getActiveMeshes=function(){return this._activeMeshes},e.prototype.isActiveMesh=function(t){return-1!==this._activeMeshes.indexOf(t)},e.prototype.isReady=function(e){if(void 0===e&&(e=!1),e)for(var i=0,o=this._postProcesses;i<o.length;i++){var n=o[i];if(n&&!n.isReady())return!1}return t.prototype.isReady.call(this,e)},e.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.position=new c.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new c.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},e.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},e.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},e.prototype._isSynchronizedViewMatrix=function(){return!!t.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},e.prototype._isSynchronizedProjectionMatrix=function(){var t=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!t)return!1;var i=this.getEngine();return t=this.mode===e.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===i.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===i.getRenderWidth()&&this._cache.renderHeight===i.getRenderHeight()},e.prototype.attachControl=function(t,e){},e.prototype.detachControl=function(t){},e.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==e.RIG_MODE_NONE&&this._updateRigCameras()},e.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(e.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),e.prototype._getFirstPostProcess=function(){for(var t=0;t<this._postProcesses.length;t++)if(null!==this._postProcesses[t])return this._postProcesses[t];return null},e.prototype._cascadePostProcessesToRigCams=function(){var t=this._getFirstPostProcess();t&&t.markTextureDirty();for(var e=0,i=this._rigCameras.length;e<i;e++){var o=this._rigCameras[e],n=o._rigPostProcess;if(n)n instanceof u.b&&(o.isIntermediate=0===this._postProcesses.length),o._postProcesses=this._postProcesses.slice(0).concat(n),n.markTextureDirty();else o._postProcesses=this._postProcesses.slice(0)}},e.prototype.attachPostProcess=function(t,e){return void 0===e&&(e=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1?(g.a.Error("You're trying to reuse a post process not defined as reusable."),0):(null==e||e<0?this._postProcesses.push(t):null===this._postProcesses[e]?this._postProcesses[e]=t:this._postProcesses.splice(e,0,t),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(t))},e.prototype.detachPostProcess=function(t){var e=this._postProcesses.indexOf(t);-1!==e&&(this._postProcesses[e]=null),this._cascadePostProcessesToRigCams()},e.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},e.prototype._getViewMatrix=function(){return c.Matrix.Identity()},e.prototype.getViewMatrix=function(t){return!t&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childRenderId=this._currentRenderId,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},e.prototype.freezeProjectionMatrix=function(t){this._doNotComputeProjectionMatrix=!0,void 0!==t&&(this._projectionMatrix=t)},e.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},e.prototype.getProjectionMatrix=function(t){if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var i=this.getEngine(),o=this.getScene();if(this.mode===e.PERSPECTIVE_CAMERA)this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=i.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1),o.useRightHandedSystem?c.Matrix.PerspectiveFovRHToRef(this.fov,i.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===e.FOVMODE_VERTICAL_FIXED):c.Matrix.PerspectiveFovLHToRef(this.fov,i.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===e.FOVMODE_VERTICAL_FIXED);else{var n=i.getRenderWidth()/2,r=i.getRenderHeight()/2;o.useRightHandedSystem?c.Matrix.OrthoOffCenterRHToRef(this.orthoLeft||-n,this.orthoRight||n,this.orthoBottom||-r,this.orthoTop||r,this.minZ,this.maxZ,this._projectionMatrix):c.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-n,this.orthoRight||n,this.orthoBottom||-r,this.orthoTop||r,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=i.getRenderWidth(),this._cache.renderHeight=i.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},e.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},e.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?c.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=c.Frustum.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},e.prototype.isInFrustum=function(t){return this._updateFrustumPlanes(),t.isInFrustum(this._frustumPlanes)},e.prototype.isCompletelyInFrustum=function(t){return this._updateFrustumPlanes(),t.isCompletelyInFrustum(this._frustumPlanes)},e.prototype.getForwardRay=function(t,e,i){void 0===t&&(t=100),e||(e=this.getWorldMatrix()),i||(i=this.position);var o=this._scene.useRightHandedSystem?new c.Vector3(0,0,-1):new c.Vector3(0,0,1),n=c.Vector3.TransformNormal(o,e),r=c.Vector3.Normalize(n);return new l.a(i,r,t)},e.prototype.dispose=function(i,o){for(void 0===o&&(o=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==e.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var r=this._postProcesses.length;--r>=0;){var a=this._postProcesses[r];a&&a.dispose(this)}for(r=this.customRenderTargets.length;--r>=0;)this.customRenderTargets[r].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),t.prototype.dispose.call(this,i,o)},Object.defineProperty(e.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),e.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},e.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},e.prototype.setCameraRigMode=function(t,i){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){var o=this._rigCameras.pop();o&&o.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=i.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=a.h.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==e.RIG_MODE_NONE){var n=this.createRigCamera(this.name+"_L",0),r=this.createRigCamera(this.name+"_R",1);n&&r&&(this._rigCameras.push(n),this._rigCameras.push(r))}switch(this.cameraRigMode){case e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:this._rigCameras[0]._rigPostProcess=new u.b(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new p.a(this.name+"_anaglyph",1,this._rigCameras);break;case e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.RIG_MODE_STEREOSCOPIC_OVERUNDER:var s=this.cameraRigMode===e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;this._rigCameras[0]._rigPostProcess=new u.b(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new d.a(this.name+"_stereoInterlace",this._rigCameras,s);break;case e.RIG_MODE_VR:var h=i.vrCameraMetrics||f.a.GetDefault();this._rigCameras[0]._cameraRigParams.vrMetrics=h,this._rigCameras[0].viewport=new c.Viewport(0,0,.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new c.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=h.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=h.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=this._rigCameras[0]._getVRProjectionMatrix,this._rigCameras[1]._cameraRigParams.vrMetrics=h,this._rigCameras[1].viewport=new c.Viewport(.5,0,.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new c.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=h.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=h.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,h.compensateDistortion&&(this._rigCameras[0]._rigPostProcess=new _.a("VR_Distort_Compensation_Left",this._rigCameras[0],!1,h),this._rigCameras[1]._rigPostProcess=new _.a("VR_Distort_Compensation_Right",this._rigCameras[1],!0,h));break;case e.RIG_MODE_WEBVR:if(i.vrDisplay){var l=i.vrDisplay.getEyeParameters("left"),m=i.vrDisplay.getEyeParameters("right");this._rigCameras[0].viewport=new c.Viewport(0,0,.5,1),this._rigCameras[0].setCameraRigParameter("left",!0),this._rigCameras[0].setCameraRigParameter("specs",i.specs),this._rigCameras[0].setCameraRigParameter("eyeParameters",l),this._rigCameras[0].setCameraRigParameter("frameData",i.frameData),this._rigCameras[0].setCameraRigParameter("parentCamera",i.parentCamera),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new c.Matrix,this._rigCameras[0].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[0].parent=this,this._rigCameras[0]._getViewMatrix=this._getWebVRViewMatrix,this._rigCameras[1].viewport=new c.Viewport(.5,0,.5,1),this._rigCameras[1].setCameraRigParameter("eyeParameters",m),this._rigCameras[1].setCameraRigParameter("specs",i.specs),this._rigCameras[1].setCameraRigParameter("frameData",i.frameData),this._rigCameras[1].setCameraRigParameter("parentCamera",i.parentCamera),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new c.Matrix,this._rigCameras[1].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[1].parent=this,this._rigCameras[1]._getViewMatrix=this._getWebVRViewMatrix,e.UseAlternateWebVRRendering&&(this._rigCameras[1]._skipRendering=!0,this._rigCameras[0]._alternateCamera=this._rigCameras[1])}}this._cascadePostProcessesToRigCams(),this.update()}},e.prototype._getVRProjectionMatrix=function(){return c.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},e.prototype._updateCameraRotationMatrix=function(){},e.prototype._updateWebVRCameraRotationMatrix=function(){},e.prototype._getWebVRProjectionMatrix=function(){return c.Matrix.Identity()},e.prototype._getWebVRViewMatrix=function(){return c.Matrix.Identity()},e.prototype.setCameraRigParameter=function(t,e){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[t]=e,"interaxialDistance"===t&&(this._cameraRigParams.stereoHalfAngle=a.h.ToRadians(e/.0637))},e.prototype.createRigCamera=function(t,e){return null},e.prototype._updateRigCameras=function(){for(var t=0;t<this._rigCameras.length;t++)this._rigCameras[t].minZ=this.minZ,this._rigCameras[t].maxZ=this.maxZ,this._rigCameras[t].fov=this.fov,this._rigCameras[t].upVector.copyFrom(this.upVector);this.cameraRigMode===e.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},e.prototype._setupInputs=function(){},e.prototype.serialize=function(){var t=n.a.Serialize(this);return t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.id),this.inputs&&this.inputs.serialize(t),n.a.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},e.prototype.clone=function(t){return n.a.Clone(e.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},e.prototype.getDirection=function(t){var e=c.Vector3.Zero();return this.getDirectionToRef(t,e),e},e.prototype.getDirectionToRef=function(t,e){c.Vector3.TransformNormalToRef(t,this.getWorldMatrix(),e)},e.GetConstructorFromName=function(t,i,o,n,r){void 0===n&&(n=0),void 0===r&&(r=!0);var a=h.a.Construct(t,i,o,{interaxial_distance:n,isStereoscopicSideBySide:r});return a||function(){return e._createDefaultParsedCamera(i,o)}},e.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},e.Parse=function(t,i){var o=t.type,r=e.GetConstructorFromName(o,t.name,i,t.interaxial_distance,t.isStereoscopicSideBySide),a=n.a.Parse(r,t,i);if(t.parentId&&(a._waitingParentId=t.parentId),a.inputs&&(a.inputs.parse(t),a._setupInputs()),a.setPosition&&(a.position.copyFromFloats(0,0,0),a.setPosition(c.Vector3.FromArray(t.position))),t.target&&a.setTarget&&a.setTarget(c.Vector3.FromArray(t.target)),t.cameraRigMode){var s=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};a.setCameraRigMode(t.cameraRigMode,s)}if(t.animations){for(var l=0;l<t.animations.length;l++){var u=t.animations[l];a.animations.push(m.a.Parse(u))}h.a.ParseAnimationRanges(a,t,i)}return t.autoAnimate&&i.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),a},e._createDefaultParsedCamera=function(t,e){throw"UniversalCamera needs to be imported before deserialization can create a default camera."},e.PERSPECTIVE_CAMERA=0,e.ORTHOGRAPHIC_CAMERA=1,e.FOVMODE_VERTICAL_FIXED=0,e.FOVMODE_HORIZONTAL_FIXED=1,e.RIG_MODE_NONE=0,e.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,e.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,e.RIG_MODE_VR=20,e.RIG_MODE_WEBVR=21,e.RIG_MODE_CUSTOM=22,e.ForceAttachControlToAlwaysPreventDefault=!1,e.UseAlternateWebVRRendering=!1,o.c([Object(n.n)()],e.prototype,"position",void 0),o.c([Object(n.n)()],e.prototype,"upVector",void 0),o.c([Object(n.c)()],e.prototype,"orthoLeft",void 0),o.c([Object(n.c)()],e.prototype,"orthoRight",void 0),o.c([Object(n.c)()],e.prototype,"orthoBottom",void 0),o.c([Object(n.c)()],e.prototype,"orthoTop",void 0),o.c([Object(n.c)()],e.prototype,"fov",void 0),o.c([Object(n.c)()],e.prototype,"minZ",void 0),o.c([Object(n.c)()],e.prototype,"maxZ",void 0),o.c([Object(n.c)()],e.prototype,"inertia",void 0),o.c([Object(n.c)()],e.prototype,"mode",void 0),o.c([Object(n.c)()],e.prototype,"layerMask",void 0),o.c([Object(n.c)()],e.prototype,"fovMode",void 0),o.c([Object(n.c)()],e.prototype,"cameraRigMode",void 0),o.c([Object(n.c)()],e.prototype,"interaxialDistance",void 0),o.c([Object(n.c)()],e.prototype,"isStereoscopicSideBySide",void 0),e}(h.a)},221:function(t,e,i){"use strict";var o=i(88);i.d(e,"a",function(){return o.a});var n=i(147);i.d(e,"b",function(){return n.a});var r=i(65);i.d(e,"d",function(){return r.a});var a=i(127);i.d(e,"c",function(){return a.a})},244:function(t,e,i){"use strict";var o=i(173),n=i(174),r=i(175),a=i(176),s=i(177),c=i(1),h=i(2),l=i(34),u=i(57),p=i(0),d=function(){function t(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array}return t.prototype.attachControl=function(t,e){var i=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){i._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(t){var o,n=t.event;t.type===u.a.KEYDOWN?-1===i.keysForward.indexOf(n.keyCode)&&-1===i.keysBackward.indexOf(n.keyCode)&&-1===i.keysUp.indexOf(n.keyCode)&&-1===i.keysDown.indexOf(n.keyCode)&&-1===i.keysLeft.indexOf(n.keyCode)&&-1===i.keysRight.indexOf(n.keyCode)||(-1===(o=i._keys.indexOf(n.keyCode))&&i._keys.push(n.keyCode),e||n.preventDefault()):-1===i.keysForward.indexOf(n.keyCode)&&-1===i.keysBackward.indexOf(n.keyCode)&&-1===i.keysUp.indexOf(n.keyCode)&&-1===i.keysDown.indexOf(n.keyCode)&&-1===i.keysLeft.indexOf(n.keyCode)&&-1===i.keysRight.indexOf(n.keyCode)||((o=i._keys.indexOf(n.keyCode))>=0&&i._keys.splice(o,1),e||n.preventDefault())}))},t.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.getClassName=function(){return"FlyCameraKeyboardInput"},t.prototype._onLostFocus=function(t){this._keys=[]},t.prototype.getSimpleName=function(){return"keyboard"},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var i=this._keys[e],o=t._computeLocalCameraSpeed();-1!==this.keysForward.indexOf(i)?t._localDirection.copyFromFloats(0,0,o):-1!==this.keysBackward.indexOf(i)?t._localDirection.copyFromFloats(0,0,-o):-1!==this.keysUp.indexOf(i)?t._localDirection.copyFromFloats(0,o,0):-1!==this.keysDown.indexOf(i)?t._localDirection.copyFromFloats(0,-o,0):-1!==this.keysRight.indexOf(i)?t._localDirection.copyFromFloats(o,0,0):-1!==this.keysLeft.indexOf(i)&&t._localDirection.copyFromFloats(-o,0,0),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),p.Vector3.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},c.c([Object(h.c)()],t.prototype,"keysForward",void 0),c.c([Object(h.c)()],t.prototype,"keysBackward",void 0),c.c([Object(h.c)()],t.prototype,"keysUp",void 0),c.c([Object(h.c)()],t.prototype,"keysDown",void 0),c.c([Object(h.c)()],t.prototype,"keysRight",void 0),c.c([Object(h.c)()],t.prototype,"keysLeft",void 0),t}();l.a.FlyCameraKeyboardInput=d;var _=i(13),m=function(){function t(t){void 0===t&&(t=!0),this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1e3,this.previousPosition=null}return t.prototype.attachControl=function(t,e){var i=this;this.element=t,this.noPreventDefault=e,this._observer=this.camera.getScene().onPointerObservable.add(function(t,e){i._pointerInput(t,e)},_.a.POINTERDOWN|_.a.POINTERUP|_.a.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add(function(){i.camera.rollCorrect&&i.camera.restoreRoll(i.camera.rollCorrect)}),this._mousemoveCallback=function(t){i._onMouseMove(t)},t.addEventListener("mousemove",this._mousemoveCallback,!1)},t.prototype.detachControl=function(t){this._observer&&t&&(this.camera.getScene().onPointerObservable.remove(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._mousemoveCallback&&t.removeEventListener("mousemove",this._mousemoveCallback),this._observer=null,this._rollObserver=null,this.previousPosition=null,this.noPreventDefault=void 0)},t.prototype.getClassName=function(){return"FlyCameraMouseInput"},t.prototype.getSimpleName=function(){return"mouse"},t.prototype._pointerInput=function(t,e){var i=t.event,o=this.camera.getEngine();if(!o.isInVRExclusivePointerMode&&(this.touchEnabled||"touch"!==i.pointerType)&&(t.type===_.a.POINTERMOVE||-1!==this.buttons.indexOf(i.button))){var n=i.srcElement||i.target;if(t.type===_.a.POINTERDOWN&&n){try{n.setPointerCapture(i.pointerId)}catch(i){}this.previousPosition={x:i.clientX,y:i.clientY},this.activeButton=i.button,this.noPreventDefault||(i.preventDefault(),this.element.focus())}else if(t.type===_.a.POINTERUP&&n){try{n.releasePointerCapture(i.pointerId)}catch(i){}this.activeButton=-1,this.previousPosition=null,this.noPreventDefault||i.preventDefault()}else if(t.type===_.a.POINTERMOVE){if(!this.previousPosition||o.isPointerLock)return;var r=i.clientX-this.previousPosition.x,a=i.clientY-this.previousPosition.y;this.rotateCamera(r,a),this.previousPosition={x:i.clientX,y:i.clientY},this.noPreventDefault||i.preventDefault()}}},t.prototype._onMouseMove=function(t){var e=this.camera.getEngine();if(e.isPointerLock&&!e.isInVRExclusivePointerMode){var i=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,o=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0;this.rotateCamera(i,o),this.previousPosition=null,this.noPreventDefault||t.preventDefault()}},t.prototype.rotateCamera=function(t,e){var i=this,o=this.camera;this.camera.getScene().useRightHandedSystem&&(t*=-1),o.parent&&o.parent._getWorldMatrixDeterminant()<0&&(t*=-1);var n,r=t/this.angularSensibility,a=e/this.angularSensibility,s=p.Quaternion.RotationYawPitchRoll(o.rotation.y,o.rotation.x,o.rotation.z);if(this.buttonsPitch.some(function(t){return t===i.activeButton})&&(n=p.Quaternion.RotationAxis(p.Axis.X,a),s.multiplyInPlace(n)),this.buttonsYaw.some(function(t){return t===i.activeButton})){n=p.Quaternion.RotationAxis(p.Axis.Y,r),s.multiplyInPlace(n);var c=o.bankedTurnLimit+o._trackRoll;if(o.bankedTurn&&-c<o.rotation.z&&o.rotation.z<c){var h=o.bankedTurnMultiplier*-r;n=p.Quaternion.RotationAxis(p.Axis.Z,h),s.multiplyInPlace(n)}}this.buttonsRoll.some(function(t){return t===i.activeButton})&&(n=p.Quaternion.RotationAxis(p.Axis.Z,-r),o._trackRoll-=r,s.multiplyInPlace(n)),s.toEulerAnglesToRef(o.rotation)},c.c([Object(h.c)()],t.prototype,"buttons",void 0),c.c([Object(h.c)()],t.prototype,"angularSensibility",void 0),t}();l.a.FlyCameraMouseInput=m;var f=i(178),g=i(179),y=i(180),v=i(181),b=i(182),C=i(183),R=i(22),M=i(63),P=i(48),x=i(129),T=i(25);T.a.AddNodeConstructor("TouchCamera",function(t,e){return function(){return new O(t,p.Vector3.Zero(),e)}});var O=function(t){function e(e,i,o){var n=t.call(this,e,i,o)||this;return n.inputs.addTouch(),n._setupInputs(),n}return c.d(e,t),Object.defineProperty(e.prototype,"touchAngularSensibility",{get:function(){var t=this.inputs.attached.touch;return t?t.touchAngularSensibility:0},set:function(t){var e=this.inputs.attached.touch;e&&(e.touchAngularSensibility=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"touchMoveSensibility",{get:function(){var t=this.inputs.attached.touch;return t?t.touchMoveSensibility:0},set:function(t){var e=this.inputs.attached.touch;e&&(e.touchMoveSensibility=t)},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"TouchCamera"},e.prototype._setupInputs=function(){var t=this.inputs.attached.mouse;t&&(t.touchEnabled=!1)},e}(P.a),V=i(70),S=i(130),w=i(131),A=i(11),k=i(88),I=function(t){function e(e){return t.call(this,e)||this}return c.d(e,t),e.prototype.addKeyboard=function(){return this.add(new d),this},e.prototype.addMouse=function(t){return void 0===t&&(t=!0),this.add(new m(t)),this},e}(l.b),D=function(t){function e(e,i,o,n){void 0===n&&(n=!0);var r=t.call(this,e,i,o,n)||this;return r.ellipsoid=new p.Vector3(1,1,1),r.ellipsoidOffset=new p.Vector3(0,0,0),r.checkCollisions=!1,r.applyGravity=!1,r.cameraDirection=p.Vector3.Zero(),r._trackRoll=0,r.rollCorrect=100,r.bankedTurn=!1,r.bankedTurnLimit=Math.PI/2,r.bankedTurnMultiplier=1,r._needMoveForGravity=!1,r._oldPosition=p.Vector3.Zero(),r._diffPosition=p.Vector3.Zero(),r._newPosition=p.Vector3.Zero(),r._collisionMask=-1,r._onCollisionPositionChange=function(t,e,i){void 0===i&&(i=null);var o;o=e,r._newPosition.copyFrom(o),r._newPosition.subtractToRef(r._oldPosition,r._diffPosition),r._diffPosition.length()>A.Engine.CollisionsEpsilon&&(r.position.addInPlace(r._diffPosition),r.onCollide&&i&&r.onCollide(i))},r.inputs=new I(r),r.inputs.addKeyboard().addMouse(),r}return c.d(e,t),Object.defineProperty(e.prototype,"angularSensibility",{get:function(){var t=this.inputs.attached.mouse;return t?t.angularSensibility:0},set:function(t){var e=this.inputs.attached.mouse;e&&(e.angularSensibility=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysForward",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysForward:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysForward=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysBackward",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysBackward:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysBackward=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysUp",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysUp:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysUp=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysDown",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysDown:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysDown=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysLeft",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysLeft:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysRight",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysRight:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysRight=t)},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(t,e){this.inputs.attachElement(t,e)},e.prototype.detachControl=function(t){this.inputs.detachElement(t),this.cameraDirection=new p.Vector3(0,0,0)},Object.defineProperty(e.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(t){this._collisionMask=isNaN(t)?-1:t},enumerable:!0,configurable:!0}),e.prototype._collideWithWorld=function(t){(this.parent?p.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset),this._collider||(this._collider=new k.a),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var e=t;this.applyGravity&&(e=t.add(this.getScene().gravity)),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,e,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},e.prototype._checkInputs=function(){this._localDirection||(this._localDirection=p.Vector3.Zero(),this._transformedDirection=p.Vector3.Zero()),this.inputs.checkInputs(),t.prototype._checkInputs.call(this)},e.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},e.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):t.prototype._updatePosition.call(this)},e.prototype.restoreRoll=function(t){var e=this._trackRoll,i=e-this.rotation.z;Math.abs(i)>=.001&&(this.rotation.z+=i/t,Math.abs(e-this.rotation.z)<=.001&&(this.rotation.z=e))},e.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},e.prototype.getClassName=function(){return"FlyCamera"},c.c([Object(h.n)()],e.prototype,"ellipsoid",void 0),c.c([Object(h.n)()],e.prototype,"ellipsoidOffset",void 0),c.c([Object(h.c)()],e.prototype,"checkCollisions",void 0),c.c([Object(h.c)()],e.prototype,"applyGravity",void 0),e}(M.a),E=i(5),F=function(){function t(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this.minHeightOffset=0,this.minRadius=0,this._keys=new Array}return t.prototype.attachControl=function(t,e){var i=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){i._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(t){var o,n=t.event;n.metaKey||(t.type===u.a.KEYDOWN?(i._altPressed=n.altKey,(-1!==i.keysUp.indexOf(n.keyCode)||-1!==i.keysDown.indexOf(n.keyCode)||-1!==i.keysLeft.indexOf(n.keyCode)||-1!==i.keysRight.indexOf(n.keyCode))&&(-1===(o=i._keys.indexOf(n.keyCode))&&i._keys.push(n.keyCode),n.preventDefault&&(e||n.preventDefault()))):-1===i.keysUp.indexOf(n.keyCode)&&-1===i.keysDown.indexOf(n.keyCode)&&-1===i.keysLeft.indexOf(n.keyCode)&&-1===i.keysRight.indexOf(n.keyCode)||((o=i._keys.indexOf(n.keyCode))>=0&&i._keys.splice(o,1),n.preventDefault&&(e||n.preventDefault())))}))},t.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=0;t<this._keys.length;t++){var e=this._keys[t];-1!==this.keysLeft.indexOf(e)?(this.camera.rotationOffset+=this.rotationSensibility,this.camera.rotationOffset%=360):-1!==this.keysUp.indexOf(e)?this._altPressed?this.camera.radius+=this.radiusSensibility:this.camera.heightOffset+=this.heightSensibility:-1!==this.keysRight.indexOf(e)?(this.camera.rotationOffset-=this.rotationSensibility,this.camera.rotationOffset%=360):-1!==this.keysDown.indexOf(e)&&(this._altPressed?(this.camera.radius-=this.radiusSensibility,this.camera.radius=Math.max(this.minRadius,this.camera.radius)):(this.camera.heightOffset-=this.heightSensibility,this.camera.heightOffset=Math.max(this.minHeightOffset,this.camera.heightOffset)))}},t.prototype.getClassName=function(){return"FollowCameraKeyboardMoveInput"},t.prototype.getSimpleName=function(){return"keyboard"},c.c([Object(h.c)()],t.prototype,"keysUp",void 0),c.c([Object(h.c)()],t.prototype,"keysDown",void 0),c.c([Object(h.c)()],t.prototype,"keysLeft",void 0),c.c([Object(h.c)()],t.prototype,"keysRight",void 0),c.c([Object(h.c)()],t.prototype,"heightSensibility",void 0),c.c([Object(h.c)()],t.prototype,"rotationSensibility",void 0),c.c([Object(h.c)()],t.prototype,"radiusSensibility",void 0),c.c([Object(h.c)()],t.prototype,"minHeightOffset",void 0),c.c([Object(h.c)()],t.prototype,"minRadius",void 0),t}();l.a.FollowCameraKeyboardMoveInput=F;var L=function(t){function e(e){return t.call(this,e)||this}return c.d(e,t),e.prototype.addKeyboard=function(){return this.add(new F),this},e.prototype.addMouseWheel=function(){return console.warn("MouseWheel support not yet implemented for FollowCamera."),this},e.prototype.addPointers=function(){return console.warn("Pointer support not yet implemented for FollowCamera."),this},e.prototype.addVRDeviceOrientation=function(){return console.warn("DeviceOrientation support not yet implemented for FollowCamera."),this},e}(l.b);T.a.AddNodeConstructor("FollowCamera",function(t,e){return function(){return new N(t,p.Vector3.Zero(),e)}}),T.a.AddNodeConstructor("ArcFollowCamera",function(t,e){return function(){return new z(t,0,0,1,null,e)}});var N=function(t){function e(e,i,o,n){void 0===n&&(n=null);var r=t.call(this,e,i,o)||this;return r.radius=12,r.rotationOffset=0,r.heightOffset=4,r.cameraAcceleration=.05,r.maxCameraSpeed=20,r.lockedTarget=n,r.inputs=new L(r),r.inputs.addKeyboard(),r}return c.d(e,t),e.prototype._follow=function(t){if(t){var e;if(t.rotationQuaternion){var i=new p.Matrix;t.rotationQuaternion.toRotationMatrix(i),e=Math.atan2(i.m[8],i.m[10])}else e=t.rotation.y;var o=E.h.ToRadians(this.rotationOffset)+e,n=t.getAbsolutePosition(),r=n.x+Math.sin(o)*this.radius,a=n.z+Math.cos(o)*this.radius,s=r-this.position.x,c=n.y+this.heightOffset-this.position.y,h=a-this.position.z,l=s*this.cameraAcceleration*2,u=c*this.cameraAcceleration,d=h*this.cameraAcceleration*2;(l>this.maxCameraSpeed||l<-this.maxCameraSpeed)&&(l=l<1?-this.maxCameraSpeed:this.maxCameraSpeed),(u>this.maxCameraSpeed||u<-this.maxCameraSpeed)&&(u=u<1?-this.maxCameraSpeed:this.maxCameraSpeed),(d>this.maxCameraSpeed||d<-this.maxCameraSpeed)&&(d=d<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new p.Vector3(this.position.x+l,this.position.y+u,this.position.z+d),this.setTarget(n)}},e.prototype.attachControl=function(t,e){this.inputs.attachElement(t,e),this._reset=function(){}},e.prototype.detachControl=function(t){this.inputs.detachElement(t),this._reset&&this._reset()},e.prototype._checkInputs=function(){this.inputs.checkInputs(),t.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},e.prototype.getClassName=function(){return"FollowCamera"},c.c([Object(h.c)()],e.prototype,"radius",void 0),c.c([Object(h.c)()],e.prototype,"rotationOffset",void 0),c.c([Object(h.c)()],e.prototype,"heightOffset",void 0),c.c([Object(h.c)()],e.prototype,"cameraAcceleration",void 0),c.c([Object(h.c)()],e.prototype,"maxCameraSpeed",void 0),c.c([Object(h.j)("lockedTargetId")],e.prototype,"lockedTarget",void 0),e}(M.a),z=function(t){function e(e,i,o,n,r,a){var s=t.call(this,e,p.Vector3.Zero(),a)||this;return s.alpha=i,s.beta=o,s.radius=n,s.target=r,s._cartesianCoordinates=p.Vector3.Zero(),s._follow(),s}return c.d(e,t),e.prototype._follow=function(){if(this.target){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var t=this.target.getAbsolutePosition();this.position=t.add(this._cartesianCoordinates),this.setTarget(t)}},e.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this._follow()},e.prototype.getClassName=function(){return"ArcFollowCamera"},e}(M.a);T.a.AddNodeConstructor("FreeCamera",function(t,e){return function(){return new B(t,p.Vector3.Zero(),e)}});var B=function(t){function e(e,i,o){var n=t.call(this,e,i,o)||this;return n.inputs.addGamepad(),n}return c.d(e,t),Object.defineProperty(e.prototype,"gamepadAngularSensibility",{get:function(){var t=this.inputs.attached.gamepad;return t?t.gamepadAngularSensibility:0},set:function(t){var e=this.inputs.attached.gamepad;e&&(e.gamepadAngularSensibility=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gamepadMoveSensibility",{get:function(){var t=this.inputs.attached.gamepad;return t?t.gamepadMoveSensibility:0},set:function(t){var e=this.inputs.attached.gamepad;e&&(e.gamepadMoveSensibility=t)},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"UniversalCamera"},e}(O);R.a._createDefaultParsedCamera=function(t,e){return new B(t,p.Vector3.Zero(),e)},T.a.AddNodeConstructor("GamepadCamera",function(t,e){return function(){return new j(t,p.Vector3.Zero(),e)}});var j=function(t){function e(e,i,o){return t.call(this,e,i,o)||this}return c.d(e,t),e.prototype.getClassName=function(){return"GamepadCamera"},e}(B);T.a.AddNodeConstructor("AnaglyphArcRotateCamera",function(t,e,i){return function(){return new W(t,0,0,1,p.Vector3.Zero(),i.interaxial_distance,e)}});var W=function(t){function e(e,i,o,n,r,a,s){var c=t.call(this,e,i,o,n,r,s)||this;return c.interaxialDistance=a,c.setCameraRigMode(R.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a}),c}return c.d(e,t),e.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},e}(V.ArcRotateCamera);T.a.AddNodeConstructor("AnaglyphFreeCamera",function(t,e,i){return function(){return new Y(t,p.Vector3.Zero(),i.interaxial_distance,e)}});var Y=function(t){function e(e,i,o,n){var r=t.call(this,e,i,n)||this;return r.interaxialDistance=o,r.setCameraRigMode(R.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:o}),r}return c.d(e,t),e.prototype.getClassName=function(){return"AnaglyphFreeCamera"},e}(P.a);T.a.AddNodeConstructor("AnaglyphGamepadCamera",function(t,e,i){return function(){return new G(t,p.Vector3.Zero(),i.interaxial_distance,e)}});var G=function(t){function e(e,i,o,n){var r=t.call(this,e,i,n)||this;return r.interaxialDistance=o,r.setCameraRigMode(R.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:o}),r}return c.d(e,t),e.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},e}(j);T.a.AddNodeConstructor("AnaglyphUniversalCamera",function(t,e,i){return function(){return new Q(t,p.Vector3.Zero(),i.interaxial_distance,e)}});var Q=function(t){function e(e,i,o,n){var r=t.call(this,e,i,n)||this;return r.interaxialDistance=o,r.setCameraRigMode(R.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:o}),r}return c.d(e,t),e.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},e}(B);T.a.AddNodeConstructor("StereoscopicArcRotateCamera",function(t,e,i){return function(){return new Z(t,0,0,1,p.Vector3.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)}});var Z=function(t){function e(e,i,o,n,r,a,s,c){var h=t.call(this,e,i,o,n,r,c)||this;return h.interaxialDistance=a,h.isStereoscopicSideBySide=s,h.setCameraRigMode(s?R.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:R.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a}),h}return c.d(e,t),e.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},e}(V.ArcRotateCamera);T.a.AddNodeConstructor("StereoscopicFreeCamera",function(t,e,i){return function(){return new X(t,p.Vector3.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)}});var X=function(t){function e(e,i,o,n,r){var a=t.call(this,e,i,r)||this;return a.interaxialDistance=o,a.isStereoscopicSideBySide=n,a.setCameraRigMode(n?R.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:R.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:o}),a}return c.d(e,t),e.prototype.getClassName=function(){return"StereoscopicFreeCamera"},e}(P.a);T.a.AddNodeConstructor("StereoscopicGamepadCamera",function(t,e,i){return function(){return new U(t,p.Vector3.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)}});var U=function(t){function e(e,i,o,n,r){var a=t.call(this,e,i,r)||this;return a.interaxialDistance=o,a.isStereoscopicSideBySide=n,a.setCameraRigMode(n?R.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:R.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:o}),a}return c.d(e,t),e.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},e}(j);T.a.AddNodeConstructor("StereoscopicFreeCamera",function(t,e,i){return function(){return new H(t,p.Vector3.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)}});var H=function(t){function e(e,i,o,n,r){var a=t.call(this,e,i,r)||this;return a.interaxialDistance=o,a.isStereoscopicSideBySide=n,a.setCameraRigMode(n?R.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:R.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:o}),a}return c.d(e,t),e.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},e}(B);T.a.AddNodeConstructor("VirtualJoysticksCamera",function(t,e){return function(){return new q(t,p.Vector3.Zero(),e)}});var q=function(t){function e(e,i,o){var n=t.call(this,e,i,o)||this;return n.inputs.addVirtualJoystick(),n}return c.d(e,t),e.prototype.getClassName=function(){return"VirtualJoysticksCamera"},e}(P.a),K=i(89);T.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(t,e){return function(){return new J(t,0,0,1,p.Vector3.Zero(),e)}});var J=function(t){function e(e,i,o,n,r,a,s,c){void 0===s&&(s=!0),void 0===c&&(c=K.a.GetDefault());var h=t.call(this,e,i,o,n,r,a)||this;return c.compensateDistortion=s,h.setCameraRigMode(R.a.RIG_MODE_VR,{vrCameraMetrics:c}),h.inputs.addVRDeviceOrientation(),h}return c.d(e,t),e.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},e}(V.ArcRotateCamera),$=i(132);T.a.AddNodeConstructor("VRDeviceOrientationGamepadCamera",function(t,e){return function(){return new tt(t,p.Vector3.Zero(),e)}});var tt=function(t){function e(e,i,o,n,r){void 0===n&&(n=!0),void 0===r&&(r=K.a.GetDefault());var a=t.call(this,e,i,o,n,r)||this;return a.inputs.addGamepad(),a}return c.d(e,t),e.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},e}($.a),et=i(184),it=i(185),ot=i(186),nt=i(187),rt=i(85),at=i(189),st=i(190),ct=i(188);i.d(e,"i",function(){return n.a}),i.d(e,"j",function(){return r.a}),i.d(e,"k",function(){return a.a}),i.d(e,"l",function(){return s.a}),i.d(e,"g",function(){return o.a}),i.d(e,"s",function(){return d}),i.d(e,"t",function(){return m}),i.d(e,"w",function(){return f.a}),i.d(e,"x",function(){return g.a}),i.d(e,"z",function(){return y.a}),i.d(e,"A",function(){return v.a}),i.d(e,"B",function(){return b.a}),i.d(e,"C",function(){return C.a}),i.d(e,"n",function(){return l.a}),i.d(e,"o",function(){return l.b}),i.d(e,"m",function(){return R.a}),i.d(e,"I",function(){return M.a}),i.d(e,"v",function(){return P.a}),i.d(e,"y",function(){return x.a}),i.d(e,"J",function(){return O}),i.d(e,"f",function(){return V.ArcRotateCamera}),i.d(e,"h",function(){return S.a}),i.d(e,"p",function(){return w.a}),i.d(e,"q",function(){return D}),i.d(e,"r",function(){return I}),i.d(e,"u",function(){return N}),i.d(e,"e",function(){return z}),i.d(e,"D",function(){return j}),i.d(e,"a",function(){return W}),i.d(e,"b",function(){return Y}),i.d(e,"c",function(){return G}),i.d(e,"d",function(){return Q}),i.d(e,"E",function(){return Z}),i.d(e,"F",function(){return X}),i.d(e,"G",function(){return U}),i.d(e,"H",function(){return H}),i.d(e,"K",function(){return B}),i.d(e,"Q",function(){return q}),i.d(e,"L",function(){return K.a}),i.d(e,"M",function(){return J}),i.d(e,"N",function(){return $.a}),i.d(e,"O",function(){return tt}),i.d(e,"P",function(){return et.a}),i.d(e,"R",function(){return it.a}),i.d(e,"S",function(){return ot.a}),i.d(e,"V",function(){return nt.b}),i.d(e,"W",function(){return nt.c}),i.d(e,"U",function(){return nt.a}),i.d(e,"bb",function(){return rt.b}),i.d(e,"X",function(){return rt.a}),i.d(e,"T",function(){return at.a}),i.d(e,"Y",function(){return at.b}),i.d(e,"Z",function(){return st.a}),i.d(e,"ab",function(){return ct.a})},252:function(t,e,i){"use strict";var o=i(111),n=i(53),r=i(114),a=i(36),s=i(0),c=function(){function t(t,e,i,o,n,r){this.entries=new Array,this._boundingVectors=new Array,this._capacity=i,this._depth=o,this._maxDepth=n,this._creationFunc=r,this._minPoint=t,this._maxPoint=e,this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors[2].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[3].y=e.y,this._boundingVectors.push(t.clone()),this._boundingVectors[4].z=e.z,this._boundingVectors.push(e.clone()),this._boundingVectors[5].z=t.z,this._boundingVectors.push(e.clone()),this._boundingVectors[6].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[7].y=t.y}return Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),t.prototype.addEntry=function(t){if(this.blocks)for(var e=0;e<this.blocks.length;e++){this.blocks[e].addEntry(t)}else this._creationFunc(t,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},t.prototype.removeEntry=function(t){if(this.blocks)for(var e=0;e<this.blocks.length;e++){this.blocks[e].removeEntry(t)}else{var i=this.entries.indexOf(t);i>-1&&this.entries.splice(i,1)}},t.prototype.addEntries=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.addEntry(i)}},t.prototype.select=function(t,e,i){if(o.a.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(var n=0;n<this.blocks.length;n++){this.blocks[n].select(t,e,i)}return}i?e.concat(this.entries):e.concatWithNoDuplicate(this.entries)}},t.prototype.intersects=function(t,e,i,n){if(o.a.IntersectsSphere(this._minPoint,this._maxPoint,t,e)){if(this.blocks){for(var r=0;r<this.blocks.length;r++){this.blocks[r].intersects(t,e,i,n)}return}n?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}},t.prototype.intersectsRay=function(t,e){if(t.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var i=0;i<this.blocks.length;i++){this.blocks[i].intersectsRay(t,e)}return}e.concatWithNoDuplicate(this.entries)}},t.prototype.createInnerBlocks=function(){t._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},t._CreateBlocks=function(e,i,o,n,r,a,c,h){c.blocks=new Array;for(var l=new s.Vector3((i.x-e.x)/2,(i.y-e.y)/2,(i.z-e.z)/2),u=0;u<2;u++)for(var p=0;p<2;p++)for(var d=0;d<2;d++){var _=new t(e.add(l.multiplyByFloats(u,p,d)),e.add(l.multiplyByFloats(u+1,p+1,d+1)),n,r+1,a,h);_.addEntries(o),c.blocks.push(_)}},t}(),h=function(){function t(t,e,i){void 0===i&&(i=2),this.maxDepth=i,this.dynamicContent=new Array,this._maxBlockCapacity=e||64,this._selectionContent=new a.b(1024),this._creationFunc=t}return t.prototype.update=function(t,e,i){c._CreateBlocks(t,e,i,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},t.prototype.addMesh=function(t){for(var e=0;e<this.blocks.length;e++){this.blocks[e].addEntry(t)}},t.prototype.removeMesh=function(t){for(var e=0;e<this.blocks.length;e++){this.blocks[e].removeEntry(t)}},t.prototype.select=function(t,e){this._selectionContent.reset();for(var i=0;i<this.blocks.length;i++){this.blocks[i].select(t,this._selectionContent,e)}return e?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersects=function(t,e,i){this._selectionContent.reset();for(var o=0;o<this.blocks.length;o++){this.blocks[o].intersects(t,e,this._selectionContent,i)}return i?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersectsRay=function(t){this._selectionContent.reset();for(var e=0;e<this.blocks.length;e++){this.blocks[e].intersectsRay(t,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.CreationFuncForMeshes=function(t,e){var i=t.getBoundingInfo();!t.isBlocked&&i.boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)},t.CreationFuncForSubMeshes=function(t,e){t.getBoundingInfo().boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)},t}(),l=i(19),u=i(23),p=i(35),d=i(15);l.Scene.prototype.createOrUpdateSelectionOctree=function(t,e){void 0===t&&(t=64),void 0===e&&(e=2);var i=this._getComponent(d.a.NAME_OCTREE);i||(i=new _(this),this._addComponent(i)),this._selectionOctree||(this._selectionOctree=new h(h.CreationFuncForMeshes,t,e));var o=this.getWorldExtends();return this._selectionOctree.update(o.min,o.max,this.meshes),this._selectionOctree},Object.defineProperty(l.Scene.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),u.a.prototype.createOrUpdateSubmeshesOctree=function(t,e){void 0===t&&(t=64),void 0===e&&(e=2);var i=this.getScene(),o=i._getComponent(d.a.NAME_OCTREE);o||(o=new _(i),i._addComponent(o)),this._submeshesOctree||(this._submeshesOctree=new h(h.CreationFuncForSubMeshes,t,e)),this.computeWorldMatrix(!0);var n=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(n.minimumWorld,n.maximumWorld,this.subMeshes),this._submeshesOctree};var _=function(){function t(t){this.name=d.a.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new p.a(s.Vector3.Zero(),new s.Vector3(1,1,1)),this.scene=t,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this)}return t.prototype.register=function(){var t=this;this.scene.onMeshRemovedObservable.add(function(e){var i=t.scene.selectionOctree;if(null!=i){var o=i.dynamicContent.indexOf(e);-1!==o&&i.dynamicContent.splice(o,1)}}),this.scene.onMeshImportedObservable.add(function(e){var i=t.scene.selectionOctree;null!=i&&i.addMesh(e)})},t.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},t.prototype.getActiveSubMeshCandidates=function(t){return t._submeshesOctree&&t.useOctreeForRenderingSelection?t._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(t)},t.prototype.getIntersectingSubMeshCandidates=function(t,e){return t._submeshesOctree&&t.useOctreeForPicking?(p.a.TransformToRef(e,t.getWorldMatrix(),this._tempRay),t._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(t)},t.prototype.getCollidingSubMeshCandidates=function(t,e){if(t._submeshesOctree&&t.useOctreeForCollisions){var i=e._velocityWorldLength+Math.max(e._radius.x,e._radius.y,e._radius.z);return t._submeshesOctree.intersects(e._basePointWorld,i)}return this.scene._getDefaultSubMeshCandidates(t)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){},t}();i.d(e,"a",function(){return o.a}),i.d(e,"b",function(){return n.a}),i.d(e,"c",function(){return r.a}),i.d(e,"d",function(){return h}),i.d(e,"e",function(){return c}),i.d(e,"f",function(){return _}),i.d(e,"g",function(){return p.a})},262:function(t,e,i){"use strict";var o=i(81),n=i(0),r=function(){function t(t,e,i){if(this.targetPosition=n.Vector3.Zero(),this.poleTargetPosition=n.Vector3.Zero(),this.poleTargetLocalOffset=n.Vector3.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=n.Quaternion.Identity(),this._bone1Mat=n.Matrix.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=n.Vector3.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=e,this._bone1=e.getParent(),this._bone1){this.mesh=t;var o=e.getPosition();if(e.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,o.x>o.y&&o.x>o.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var r=this._bone1.getScale(),a=this._bone2.getScale();this._bone1Length=this._bone1.length*r.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*a.y*this.mesh.scaling.y}else if(this._bone1.children[0]){t.computeWorldMatrix(!0);var s=this._bone2.children[0].getAbsolutePosition(t),c=this._bone2.getAbsolutePosition(t),h=this._bone1.getAbsolutePosition(t);this._bone1Length=n.Vector3.Distance(s,c),this._bone2Length=n.Vector3.Distance(c,h)}this._bone1.getRotationMatrixToRef(n.Space.WORLD,t,this._bone1Mat),this.maxAngle=Math.PI,i&&(i.targetMesh&&(this.targetMesh=i.targetMesh,this.targetMesh.computeWorldMatrix(!0)),i.poleTargetMesh?(this.poleTargetMesh=i.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):i.poleTargetBone?this.poleTargetBone=i.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),i.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(i.poleTargetLocalOffset),i.poleAngle&&(this.poleAngle=i.poleAngle),i.bendAxis&&this._bendAxis.copyFrom(i.bendAxis),i.maxAngle&&(this.maxAngle=i.maxAngle),i.slerpAmount&&(this.slerpAmount=i.slerpAmount))}}return Object.defineProperty(t.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(t){this._setMaxAngle(t)},enumerable:!0,configurable:!0}),t.prototype._setMaxAngle=function(t){t<0&&(t=0),(t>Math.PI||null==t)&&(t=Math.PI),this._maxAngle=t;var e=this._bone1Length,i=this._bone2Length;this._maxReach=Math.sqrt(e*e+i*i-2*e*i*Math.cos(t))},t.prototype.update=function(){var e=this._bone1;if(e){var i=this.targetPosition,o=this.poleTargetPosition,r=t._tmpMats[0],a=t._tmpMats[1];this.targetMesh&&i.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,o):this.poleTargetMesh&&n.Vector3.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),o);var s=t._tmpVecs[0],c=t._tmpVecs[1],h=t._tmpVecs[2],l=t._tmpVecs[3],u=t._tmpVecs[4],p=t._tmpQuat;e.getAbsolutePositionToRef(this.mesh,s),o.subtractToRef(s,u),0==u.x&&0==u.y&&0==u.z?u.y=1:u.normalize(),i.subtractToRef(s,l),l.normalize(),n.Vector3.CrossToRef(l,u,c),c.normalize(),n.Vector3.CrossToRef(l,c,h),h.normalize(),n.Matrix.FromXYZAxesToRef(h,l,c,r);var d=this._bone1Length,_=this._bone2Length,m=n.Vector3.Distance(s,i);this._maxReach>0&&(m=Math.min(this._maxReach,m));var f=(_*_+m*m-d*d)/(2*_*m),g=(m*m+d*d-_*_)/(2*m*d);f>1&&(f=1),g>1&&(g=1),f<-1&&(f=-1),g<-1&&(g=-1);var y=Math.acos(f),v=Math.acos(g),b=-y-v;if(this._rightHandedSystem)n.Matrix.RotationYawPitchRollToRef(0,0,this._adjustRoll,a),a.multiplyToRef(r,r),n.Matrix.RotationAxisToRef(this._bendAxis,v,a),a.multiplyToRef(r,r);else{var C=t._tmpVecs[5];C.copyFrom(this._bendAxis),C.x*=-1,n.Matrix.RotationAxisToRef(C,-v,a),a.multiplyToRef(r,r)}this.poleAngle&&(n.Matrix.RotationAxisToRef(l,this.poleAngle,a),r.multiplyToRef(a,r)),this._bone1&&(this.slerpAmount<1?(this._slerping||n.Quaternion.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),n.Quaternion.FromRotationMatrixToRef(r,p),n.Quaternion.SlerpToRef(this._bone1Quat,p,this.slerpAmount,this._bone1Quat),b=this._bone2Ang*(1-this.slerpAmount)+b*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,n.Space.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(r,n.Space.WORLD,this.mesh),this._bone1Mat.copyFrom(r),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,b,n.Space.LOCAL),this._bone2Ang=b}},t._tmpVecs=[n.Vector3.Zero(),n.Vector3.Zero(),n.Vector3.Zero(),n.Vector3.Zero(),n.Vector3.Zero(),n.Vector3.Zero()],t._tmpQuat=n.Quaternion.Identity(),t._tmpMats=[n.Matrix.Identity(),n.Matrix.Identity()],t}(),a=i(43),s=function(){function t(t,e,i,o){if(this.upAxis=n.Vector3.Up(),this.upAxisSpace=n.Space.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=n.Quaternion.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=n.Vector3.Forward(),this.mesh=t,this.bone=e,this.target=i,o&&(o.adjustYaw&&(this.adjustYaw=o.adjustYaw),o.adjustPitch&&(this.adjustPitch=o.adjustPitch),o.adjustRoll&&(this.adjustRoll=o.adjustRoll),null!=o.maxYaw?this.maxYaw=o.maxYaw:this.maxYaw=Math.PI,null!=o.minYaw?this.minYaw=o.minYaw:this.minYaw=-Math.PI,null!=o.maxPitch?this.maxPitch=o.maxPitch:this.maxPitch=Math.PI,null!=o.minPitch?this.minPitch=o.minPitch:this.minPitch=-Math.PI,null!=o.slerpAmount&&(this.slerpAmount=o.slerpAmount),null!=o.upAxis&&(this.upAxis=o.upAxis),null!=o.upAxisSpace&&(this.upAxisSpace=o.upAxisSpace),null!=o.yawAxis||null!=o.pitchAxis)){var r=n.Axis.Y,a=n.Axis.X;null!=o.yawAxis&&(r=o.yawAxis.clone()).normalize(),null!=o.pitchAxis&&(a=o.pitchAxis.clone()).normalize();var s=n.Vector3.Cross(a,r);this._transformYawPitch=n.Matrix.Identity(),n.Matrix.FromXYZAxesToRef(a,r,s,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}e.getParent()||this.upAxisSpace!=n.Space.BONE||(this.upAxisSpace=n.Space.LOCAL)}return Object.defineProperty(t.prototype,"minYaw",{get:function(){return this._minYaw},set:function(t){this._minYaw=t,this._minYawSin=Math.sin(t),this._minYawCos=Math.cos(t),null!=this._maxYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(t){this._maxYaw=t,this._maxYawSin=Math.sin(t),this._maxYawCos=Math.cos(t),null!=this._minYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPitch",{get:function(){return this._minPitch},set:function(t){this._minPitch=t,this._minPitchTan=Math.tan(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(t){this._maxPitch=t,this._maxPitchTan=Math.tan(t)},enumerable:!0,configurable:!0}),t.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var e=this.bone,i=t._tmpVecs[0];e.getAbsolutePositionToRef(this.mesh,i);var o=this.target,r=t._tmpMats[0],a=t._tmpMats[1],s=this.mesh,c=e.getParent(),h=t._tmpVecs[1];h.copyFrom(this.upAxis),this.upAxisSpace==n.Space.BONE&&c?(this._transformYawPitch&&n.Vector3.TransformCoordinatesToRef(h,this._transformYawPitchInv,h),c.getDirectionToRef(h,this.mesh,h)):this.upAxisSpace==n.Space.LOCAL&&(s.getDirectionToRef(h,h),1==s.scaling.x&&1==s.scaling.y&&1==s.scaling.z||h.normalize());var l=!1,u=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(l=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(u=!0),l||u){var p=t._tmpMats[2],d=t._tmpMats[3];if(this.upAxisSpace==n.Space.BONE&&1==h.y&&c)c.getRotationMatrixToRef(n.Space.WORLD,this.mesh,p);else if(this.upAxisSpace!=n.Space.LOCAL||1!=h.y||c){(m=t._tmpVecs[2]).copyFrom(this._fowardAxis),this._transformYawPitch&&n.Vector3.TransformCoordinatesToRef(m,this._transformYawPitchInv,m),c?c.getDirectionToRef(m,this.mesh,m):s.getDirectionToRef(m,m);var _=n.Vector3.Cross(h,m);_.normalize();var m=n.Vector3.Cross(_,h);n.Matrix.FromXYZAxesToRef(_,h,m,p)}else p.copyFrom(s.getWorldMatrix());p.invertToRef(d);var f=null;if(u){var g=t._tmpVecs[3];o.subtractToRef(i,g),n.Vector3.TransformCoordinatesToRef(g,d,g),f=Math.sqrt(g.x*g.x+g.z*g.z);var y=Math.atan2(g.y,f),v=y;y>this._maxPitch?(g.y=this._maxPitchTan*f,v=this._maxPitch):y<this._minPitch&&(g.y=this._minPitchTan*f,v=this._minPitch),y!=v&&(n.Vector3.TransformCoordinatesToRef(g,p,g),g.addInPlace(i),o=g)}if(l){g=t._tmpVecs[4];o.subtractToRef(i,g),n.Vector3.TransformCoordinatesToRef(g,d,g);var b=Math.atan2(g.x,g.z),C=b;if((b>this._maxYaw||b<this._minYaw)&&(null==f&&(f=Math.sqrt(g.x*g.x+g.z*g.z)),this._yawRange>Math.PI?this._isAngleBetween(b,this._maxYaw,this._midYawConstraint)?(g.z=this._maxYawCos*f,g.x=this._maxYawSin*f,C=this._maxYaw):this._isAngleBetween(b,this._midYawConstraint,this._minYaw)&&(g.z=this._minYawCos*f,g.x=this._minYawSin*f,C=this._minYaw):b>this._maxYaw?(g.z=this._maxYawCos*f,g.x=this._maxYawSin*f,C=this._maxYaw):b<this._minYaw&&(g.z=this._minYawCos*f,g.x=this._minYawSin*f,C=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var R=t._tmpVecs[8];R.copyFrom(n.Axis.Z),this._transformYawPitch&&n.Vector3.TransformCoordinatesToRef(R,this._transformYawPitchInv,R);var M=t._tmpMats[4];this._boneQuat.toRotationMatrix(M),this.mesh.getWorldMatrix().multiplyToRef(M,M),n.Vector3.TransformCoordinatesToRef(R,M,R),n.Vector3.TransformCoordinatesToRef(R,d,R);var P=Math.atan2(R.x,R.z);if(this._getAngleBetween(P,b)>this._getAngleBetween(P,this._midYawConstraint)){null==f&&(f=Math.sqrt(g.x*g.x+g.z*g.z));var x=this._getAngleBetween(P,this._maxYaw);this._getAngleBetween(P,this._minYaw)<x?(C=P+.75*Math.PI,g.z=Math.cos(C)*f,g.x=Math.sin(C)*f):(C=P-.75*Math.PI,g.z=Math.cos(C)*f,g.x=Math.sin(C)*f)}}b!=C&&(n.Vector3.TransformCoordinatesToRef(g,p,g),g.addInPlace(i),o=g)}}var T=t._tmpVecs[5],O=t._tmpVecs[6],V=t._tmpVecs[7],S=t._tmpQuat;o.subtractToRef(i,T),T.normalize(),n.Vector3.CrossToRef(h,T,O),O.normalize(),n.Vector3.CrossToRef(T,O,V),V.normalize(),n.Matrix.FromXYZAxesToRef(O,V,T,r),0===O.x&&0===O.y&&0===O.z||0===V.x&&0===V.y&&0===V.z||0===T.x&&0===T.y&&0===T.z||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(n.Matrix.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,a),a.multiplyToRef(r,r)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(n.Space.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(r,r),n.Quaternion.FromRotationMatrixToRef(r,S),n.Quaternion.SlerpToRef(this._boneQuat,S,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,n.Space.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(r,r),this.bone.setRotationMatrix(r,n.Space.WORLD,this.mesh),this._slerping=!1))}},t.prototype._getAngleDiff=function(t,e){var i=e-t;return(i%=2*Math.PI)>Math.PI?i-=2*Math.PI:i<-Math.PI&&(i+=2*Math.PI),i},t.prototype._getAngleBetween=function(t,e){var i=0;return(i=(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)<(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)?e-t:t-e)>Math.PI&&(i=2*Math.PI-i),i},t.prototype._isAngleBetween=function(t,e,i){if(t=(t%=2*Math.PI)<0?t+2*Math.PI:t,(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)<(i=(i%=2*Math.PI)<0?i+2*Math.PI:i)){if(t>e&&t<i)return!0}else if(t>i&&t<e)return!0;return!1},t._tmpVecs=a.a.BuildArray(10,n.Vector3.Zero),t._tmpQuat=n.Quaternion.Identity(),t._tmpMats=a.a.BuildArray(5,n.Matrix.Identity),t}(),c=i(92);i.d(e,"a",function(){return o.a}),i.d(e,"b",function(){return r}),i.d(e,"c",function(){return s}),i.d(e,"d",function(){return c.a})},34:function(t,e,i){"use strict";i.d(e,"a",function(){return a}),i.d(e,"b",function(){return s});var o=i(9),n=i(2),r=i(22),a={},s=function(){function t(t){this.attached={},this.camera=t,this.checkInputs=function(){}}return t.prototype.add=function(t){var e=t.getSimpleName();this.attached[e]?o.a.Warn("camera input of type "+e+" already exists on camera"):(this.attached[e]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedElement&&t.attachControl(this.attachedElement))},t.prototype.remove=function(t){for(var e in this.attached){var i=this.attached[e];i===t&&(i.detachControl(this.attachedElement),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}},t.prototype.removeByType=function(t){for(var e in this.attached){var i=this.attached[e];i.getClassName()===t&&(i.detachControl(this.attachedElement),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}},t.prototype._addCheckInputs=function(t){var e=this.checkInputs;return function(){e(),t()}},t.prototype.attachInput=function(t){this.attachedElement&&t.attachControl(this.attachedElement,this.noPreventDefault)},t.prototype.attachElement=function(t,e){if(void 0===e&&(e=!1),!this.attachedElement)for(var i in e=!r.a.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedElement=t,this.noPreventDefault=e,this.attached)this.attached[i].attachControl(t,e)},t.prototype.detachElement=function(t,e){if(void 0===e&&(e=!1),this.attachedElement===t){for(var i in this.attached)this.attached[i].detachControl(t),e&&(this.attached[i].camera=null);this.attachedElement=null}},t.prototype.rebuildInputCheck=function(){for(var t in this.checkInputs=function(){},this.attached){var e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}},t.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},t.prototype.serialize=function(t){var e={};for(var i in this.attached){var o=this.attached[i],r=n.a.Serialize(o);e[o.getClassName()]=r}t.inputsmgr=e},t.prototype.parse=function(t){var e=t.inputsmgr;if(e)for(var i in this.clear(),e){if(s=a[i]){var o=e[i],r=n.a.Parse(function(){return new s},o,null);this.add(r)}}else for(var i in this.attached){var s;if(s=a[this.attached[i].getClassName()]){r=n.a.Parse(function(){return new s},t,null);this.remove(this.attached[i]),this.add(r)}}},t}()},35:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var o=i(43),n=i(0),r=i(127),a=function(){function t(t,e,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=t,this.direction=e,this.length=i}return t.prototype.intersectsBoxMinMax=function(e,i,o){void 0===o&&(o=0);var n,r,a,s,c=t.TmpVector3[0].copyFromFloats(e.x-o,e.y-o,e.z-o),h=t.TmpVector3[1].copyFromFloats(i.x+o,i.y+o,i.z+o),l=0,u=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<c.x||this.origin.x>h.x)return!1}else if(n=1/this.direction.x,r=(c.x-this.origin.x)*n,(a=(h.x-this.origin.x)*n)===-1/0&&(a=1/0),r>a&&(s=r,r=a,a=s),(l=Math.max(r,l))>(u=Math.min(a,u)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<c.y||this.origin.y>h.y)return!1}else if(n=1/this.direction.y,r=(c.y-this.origin.y)*n,(a=(h.y-this.origin.y)*n)===-1/0&&(a=1/0),r>a&&(s=r,r=a,a=s),(l=Math.max(r,l))>(u=Math.min(a,u)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<c.z||this.origin.z>h.z)return!1}else if(n=1/this.direction.z,r=(c.z-this.origin.z)*n,(a=(h.z-this.origin.z)*n)===-1/0&&(a=1/0),r>a&&(s=r,r=a,a=s),(l=Math.max(r,l))>(u=Math.min(a,u)))return!1;return!0},t.prototype.intersectsBox=function(t,e){return void 0===e&&(e=0),this.intersectsBoxMinMax(t.minimum,t.maximum,e)},t.prototype.intersectsSphere=function(t,e){void 0===e&&(e=0);var i=t.center.x-this.origin.x,o=t.center.y-this.origin.y,n=t.center.z-this.origin.z,r=i*i+o*o+n*n,a=t.radius+e,s=a*a;if(r<=s)return!0;var c=i*this.direction.x+o*this.direction.y+n*this.direction.z;return!(c<0)&&r-c*c<=s},t.prototype.intersectsTriangle=function(e,i,o){var a=t.TmpVector3[0],s=t.TmpVector3[1],c=t.TmpVector3[2],h=t.TmpVector3[3],l=t.TmpVector3[4];i.subtractToRef(e,a),o.subtractToRef(e,s),n.Vector3.CrossToRef(this.direction,s,c);var u=n.Vector3.Dot(a,c);if(0===u)return null;var p=1/u;this.origin.subtractToRef(e,h);var d=n.Vector3.Dot(h,c)*p;if(d<0||d>1)return null;n.Vector3.CrossToRef(h,a,l);var _=n.Vector3.Dot(this.direction,l)*p;if(_<0||d+_>1)return null;var m=n.Vector3.Dot(s,l)*p;return m>this.length?null:new r.a(d,_,m)},t.prototype.intersectsPlane=function(t){var e,i=n.Vector3.Dot(t.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;var o=n.Vector3.Dot(t.normal,this.origin);return(e=(-t.d-o)/i)<0?e<-9.99999997475243e-7?null:0:e},t.prototype.intersectsMesh=function(e,i){var o=n.Tmp.Matrix[0];return e.getWorldMatrix().invertToRef(o),this._tmpRay?t.TransformToRef(this,o,this._tmpRay):this._tmpRay=t.Transform(this,o),e.intersects(this._tmpRay,i)},t.prototype.intersectsMeshes=function(t,e,i){i?i.length=0:i=[];for(var o=0;o<t.length;o++){var n=this.intersectsMesh(t[o],e);n.hit&&i.push(n)}return i.sort(this._comparePickingInfo),i},t.prototype._comparePickingInfo=function(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:0},t.prototype.intersectionSegment=function(e,i,o){var r=this.origin,a=n.Tmp.Vector3[0],s=n.Tmp.Vector3[1],c=n.Tmp.Vector3[2],h=n.Tmp.Vector3[3];i.subtractToRef(e,a),this.direction.scaleToRef(t.rayl,c),r.addToRef(c,s),e.subtractToRef(r,h);var l,u,p,d,_=n.Vector3.Dot(a,a),m=n.Vector3.Dot(a,c),f=n.Vector3.Dot(c,c),g=n.Vector3.Dot(a,h),y=n.Vector3.Dot(c,h),v=_*f-m*m,b=v,C=v;v<t.smallnum?(u=0,b=1,d=y,C=f):(d=_*y-m*g,(u=m*y-f*g)<0?(u=0,d=y,C=f):u>b&&(u=b,d=y+m,C=f)),d<0?(d=0,-g<0?u=0:-g>_?u=b:(u=-g,b=_)):d>C&&(d=C,-g+m<0?u=0:-g+m>_?u=b:(u=-g+m,b=_)),l=Math.abs(u)<t.smallnum?0:u/b,p=Math.abs(d)<t.smallnum?0:d/C;var R=n.Tmp.Vector3[4];c.scaleToRef(p,R);var M=n.Tmp.Vector3[5];a.scaleToRef(l,M),M.addInPlace(h);var P=n.Tmp.Vector3[6];return M.subtractToRef(R,P),p>0&&p<=this.length&&P.lengthSquared()<o*o?M.length():-1},t.prototype.update=function(t,e,i,o,n,r,a){return this.unprojectRayToRef(t,e,i,o,n,r,a),this},t.Zero=function(){return new t(n.Vector3.Zero(),n.Vector3.Zero())},t.CreateNew=function(e,i,o,n,r,a,s){return t.Zero().update(e,i,o,n,r,a,s)},t.CreateNewFromTo=function(e,i,o){void 0===o&&(o=n.Matrix.IdentityReadOnly);var r=i.subtract(e),a=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.normalize(),t.Transform(new t(e,r,a),o)},t.Transform=function(e,i){var o=new t(new n.Vector3(0,0,0),new n.Vector3(0,0,0));return t.TransformToRef(e,i,o),o},t.TransformToRef=function(t,e,i){n.Vector3.TransformCoordinatesToRef(t.origin,e,i.origin),n.Vector3.TransformNormalToRef(t.direction,e,i.direction),i.length=t.length;var o=i.direction,r=o.length();if(0!==r&&1!==r){var a=1/r;o.x*=a,o.y*=a,o.z*=a,i.length*=r}},t.prototype.unprojectRayToRef=function(t,e,i,o,r,a,s){var c=n.Tmp.Matrix[0];r.multiplyToRef(a,c),c.multiplyToRef(s,c),c.invert();var h=n.Tmp.Vector3[0];h.x=t/i*2-1,h.y=-(e/o*2-1),h.z=-1;var l=n.Tmp.Vector3[1].copyFromFloats(h.x,h.y,1),u=n.Tmp.Vector3[2],p=n.Tmp.Vector3[3];n.Vector3._UnprojectFromInvertedMatrixToRef(h,c,u),n.Vector3._UnprojectFromInvertedMatrixToRef(l,c,p),this.origin.copyFrom(u),p.subtractToRef(u,this.direction),this.direction.normalize()},t.TmpVector3=o.a.BuildArray(6,n.Vector3.Zero),t.smallnum=1e-8,t.rayl=1e9,t}()},48:function(t,e,i){"use strict";i.d(e,"a",function(){return l});var o=i(1),n=i(2),r=i(0),a=i(88),s=i(11),c=i(63),h=i(129),l=function(t){function e(e,i,o,n){void 0===n&&(n=!0);var a=t.call(this,e,i,o,n)||this;return a.ellipsoid=new r.Vector3(.5,1,.5),a.ellipsoidOffset=new r.Vector3(0,0,0),a.checkCollisions=!1,a.applyGravity=!1,a._needMoveForGravity=!1,a._oldPosition=r.Vector3.Zero(),a._diffPosition=r.Vector3.Zero(),a._newPosition=r.Vector3.Zero(),a._collisionMask=-1,a._onCollisionPositionChange=function(t,e,i){void 0===i&&(i=null);var o;o=e,a._newPosition.copyFrom(o),a._newPosition.subtractToRef(a._oldPosition,a._diffPosition),a._diffPosition.length()>s.Engine.CollisionsEpsilon&&(a.position.addInPlace(a._diffPosition),a.onCollide&&i&&a.onCollide(i))},a.inputs=new h.a(a),a.inputs.addKeyboard().addMouse(),a}return o.d(e,t),Object.defineProperty(e.prototype,"angularSensibility",{get:function(){var t=this.inputs.attached.mouse;return t?t.angularSensibility:0},set:function(t){var e=this.inputs.attached.mouse;e&&(e.angularSensibility=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysUp",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysUp:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysUp=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysDown",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysDown:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysDown=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysLeft",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysLeft:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysRight",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysRight:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysRight=t)},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(t,e){this.inputs.attachElement(t,e)},e.prototype.detachControl=function(t){this.inputs.detachElement(t),this.cameraDirection=new r.Vector3(0,0,0),this.cameraRotation=new r.Vector2(0,0)},Object.defineProperty(e.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(t){this._collisionMask=isNaN(t)?-1:t},enumerable:!0,configurable:!0}),e.prototype._collideWithWorld=function(t){(this.parent?r.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset),this._collider||(this._collider=new a.a),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var e=t;this.applyGravity&&(e=t.add(this.getScene().gravity)),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,e,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},e.prototype._checkInputs=function(){this._localDirection||(this._localDirection=r.Vector3.Zero(),this._transformedDirection=r.Vector3.Zero()),this.inputs.checkInputs(),t.prototype._checkInputs.call(this)},e.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},e.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):t.prototype._updatePosition.call(this)},e.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},e.prototype.getClassName=function(){return"FreeCamera"},o.c([Object(n.n)()],e.prototype,"ellipsoid",void 0),o.c([Object(n.n)()],e.prototype,"ellipsoidOffset",void 0),o.c([Object(n.c)()],e.prototype,"checkCollisions",void 0),o.c([Object(n.c)()],e.prototype,"applyGravity",void 0),e}(c.a)},53:function(t,e,i){"use strict";i.d(e,"a",function(){return p});var o=i(43),n=i(0),r=i(4),a=i(111),s=i(114),c={min:0,max:0},h={min:0,max:0},l=function(t,e,i){var o=n.Vector3.Dot(e.centerWorld,t),r=Math.abs(n.Vector3.Dot(e.directions[0],t))*e.extendSize.x+Math.abs(n.Vector3.Dot(e.directions[1],t))*e.extendSize.y+Math.abs(n.Vector3.Dot(e.directions[2],t))*e.extendSize.z;i.min=o-r,i.max=o+r},u=function(t,e,i){return l(t,e,c),l(t,i,h),!(c.min>h.max||h.min>c.max)},p=function(){function t(t,e,i){this._isLocked=!1,this.boundingBox=new a.a(t,e,i),this.boundingSphere=new s.a(t,e,i)}return t.prototype.reConstruct=function(t,e,i){this.boundingBox.reConstruct(t,e,i),this.boundingSphere.reConstruct(t,e,i)},Object.defineProperty(t.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLocked",{get:function(){return this._isLocked},set:function(t){this._isLocked=t},enumerable:!0,configurable:!0}),t.prototype.update=function(t){this._isLocked||(this.boundingBox._update(t),this.boundingSphere._update(t))},t.prototype.centerOn=function(e,i){var o=t.TmpVector3[0].copyFrom(e).subtractInPlace(i),n=t.TmpVector3[1].copyFrom(e).addInPlace(i);return this.boundingBox.reConstruct(o,n,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(o,n,this.boundingBox.getWorldMatrix()),this},t.prototype.scale=function(t){return this.boundingBox.scale(t),this.boundingSphere.scale(t),this},t.prototype.isInFrustum=function(t,e){return void 0===e&&(e=r.a.MESHES_CULLINGSTRATEGY_STANDARD),!(e!==r.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION&&e!==r.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY||!this.boundingSphere.isCenterInFrustum(t))||!!this.boundingSphere.isInFrustum(t)&&(!(e!==r.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY&&e!==r.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY)||this.boundingBox.isInFrustum(t))},Object.defineProperty(t.prototype,"diagonalLength",{get:function(){var e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,t.TmpVector3[0]).length()},enumerable:!0,configurable:!0}),t.prototype.isCompletelyInFrustum=function(t){return this.boundingBox.isCompletelyInFrustum(t)},t.prototype._checkCollision=function(t){return t._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(t){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(t)&&!!this.boundingBox.intersectsPoint(t))},t.prototype.intersects=function(t,e){if(!s.a.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!a.a.Intersects(this.boundingBox,t.boundingBox))return!1;if(!e)return!0;var i=this.boundingBox,o=t.boundingBox;return!!u(i.directions[0],i,o)&&(!!u(i.directions[1],i,o)&&(!!u(i.directions[2],i,o)&&(!!u(o.directions[0],i,o)&&(!!u(o.directions[1],i,o)&&(!!u(o.directions[2],i,o)&&(!!u(n.Vector3.Cross(i.directions[0],o.directions[0]),i,o)&&(!!u(n.Vector3.Cross(i.directions[0],o.directions[1]),i,o)&&(!!u(n.Vector3.Cross(i.directions[0],o.directions[2]),i,o)&&(!!u(n.Vector3.Cross(i.directions[1],o.directions[0]),i,o)&&(!!u(n.Vector3.Cross(i.directions[1],o.directions[1]),i,o)&&(!!u(n.Vector3.Cross(i.directions[1],o.directions[2]),i,o)&&(!!u(n.Vector3.Cross(i.directions[2],o.directions[0]),i,o)&&(!!u(n.Vector3.Cross(i.directions[2],o.directions[1]),i,o)&&!!u(n.Vector3.Cross(i.directions[2],o.directions[2]),i,o))))))))))))))},t.TmpVector3=o.a.BuildArray(2,n.Vector3.Zero),t}()},63:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var o=i(1),n=i(2),r=i(22),a=i(0),s=function(t){function e(e,i,o,n){void 0===n&&(n=!0);var r=t.call(this,e,i,o,n)||this;return r.cameraDirection=new a.Vector3(0,0,0),r.cameraRotation=new a.Vector2(0,0),r.updateUpVectorFromRotation=!1,r._tmpQuaternion=new a.Quaternion,r.rotation=new a.Vector3(0,0,0),r.speed=2,r.noRotationConstraint=!1,r.lockedTarget=null,r._currentTarget=a.Vector3.Zero(),r._initialFocalDistance=1,r._viewMatrix=a.Matrix.Zero(),r._camMatrix=a.Matrix.Zero(),r._cameraTransformMatrix=a.Matrix.Zero(),r._cameraRotationMatrix=a.Matrix.Zero(),r._referencePoint=new a.Vector3(0,0,1),r._transformedReferencePoint=a.Vector3.Zero(),r._globalCurrentTarget=a.Vector3.Zero(),r._globalCurrentUpVector=a.Vector3.Zero(),r._defaultUp=a.Vector3.Up(),r._cachedRotationZ=0,r._cachedQuaternionRotationZ=0,r}return o.d(e,t),e.prototype.getFrontPosition=function(t){this.getWorldMatrix();var e=this.getTarget().subtract(this.position);return e.normalize(),e.scaleInPlace(t),this.globalPosition.add(e)},e.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},e.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),t.prototype.storeState.call(this)},e.prototype._restoreStateValues=function(){return!!t.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},e.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.lockedTarget=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new a.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},e.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},e.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},e.prototype._computeLocalCameraSpeed=function(){var t=this.getEngine();return this.speed*Math.sqrt(t.getDeltaTime()/(100*t.getFps()))},e.prototype.setTarget=function(t){this.upVector.normalize(),this._initialFocalDistance=t.subtract(this.position).length(),this.position.z===t.z&&(this.position.z+=a.Epsilon),a.Matrix.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var e=t.subtract(this.position);e.x>=0?this.rotation.y=-Math.atan(e.z/e.x)+Math.PI/2:this.rotation.y=-Math.atan(e.z/e.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&a.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},e.prototype.getTarget=function(){return this._currentTarget},e.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},e.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(a.Tmp.Matrix[0]),a.Vector3.TransformNormalToRef(this.cameraDirection,a.Tmp.Matrix[0],a.Tmp.Vector3[0]),void this.position.addInPlace(a.Tmp.Vector3[0]);this.position.addInPlace(this.cameraDirection)},e.prototype._checkInputs=function(){var e=this._decideIfNeedsToMove(),i=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(e&&this._updatePosition(),i){if(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion)this.rotation.lengthSquared()&&a.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion);if(!this.noRotationConstraint){var o=Math.PI/2*.95;this.rotation.x>o&&(this.rotation.x=o),this.rotation.x<-o&&(this.rotation.x=-o)}}e&&(Math.abs(this.cameraDirection.x)<this.speed*a.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*a.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*a.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*a.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*a.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),t.prototype._checkInputs.call(this)},e.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):a.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},e.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return a.Vector3.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},e.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),a.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?a.Axis.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(a.Quaternion.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),a.Axis.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},e.prototype._computeViewMatrix=function(t,e,i){if(this.parent){var o=this.parent.getWorldMatrix();a.Vector3.TransformCoordinatesToRef(t,o,this._globalPosition),a.Vector3.TransformCoordinatesToRef(e,o,this._globalCurrentTarget),a.Vector3.TransformNormalToRef(i,o,this._globalCurrentUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t),this._globalCurrentTarget.copyFrom(e),this._globalCurrentUpVector.copyFrom(i);this.getScene().useRightHandedSystem?a.Matrix.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):a.Matrix.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},e.prototype.createRigCamera=function(t,i){if(this.cameraRigMode!==r.a.RIG_MODE_NONE){var o=new e(t,this.position.clone(),this.getScene());return this.cameraRigMode!==r.a.RIG_MODE_VR&&this.cameraRigMode!==r.a.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new a.Quaternion),o._cameraRigParams={},o.rotationQuaternion=new a.Quaternion),o}return null},e.prototype._updateRigCameras=function(){var e=this._rigCameras[0],i=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case r.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case r.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:var o=this.cameraRigMode===r.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,n=this.cameraRigMode===r.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*o,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*n,i);break;case r.a.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),i.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),i.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),i.position.copyFrom(this.position)}t.prototype._updateRigCameras.call(this)},e.prototype._getRigCamPositionAndTarget=function(t,i){this.getTarget().subtractToRef(this.position,e._TargetFocalPoint),e._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var o=e._TargetFocalPoint.addInPlace(this.position);a.Matrix.TranslationToRef(-o.x,-o.y,-o.z,e._TargetTransformMatrix),e._TargetTransformMatrix.multiplyToRef(a.Matrix.RotationY(t),e._RigCamTransformMatrix),a.Matrix.TranslationToRef(o.x,o.y,o.z,e._TargetTransformMatrix),e._RigCamTransformMatrix.multiplyToRef(e._TargetTransformMatrix,e._RigCamTransformMatrix),a.Vector3.TransformCoordinatesToRef(this.position,e._RigCamTransformMatrix,i.position),i.setTarget(o)},e.prototype.getClassName=function(){return"TargetCamera"},e._RigCamTransformMatrix=new a.Matrix,e._TargetTransformMatrix=new a.Matrix,e._TargetFocalPoint=new a.Vector3,o.c([Object(n.n)()],e.prototype,"rotation",void 0),o.c([Object(n.c)()],e.prototype,"speed",void 0),o.c([Object(n.j)("lockedTargetId")],e.prototype,"lockedTarget",void 0),e}(r.a)},65:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var o=i(0),n=i(3),r=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}return t.prototype.getNormal=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(n.b.NormalKind))return null;var i,r=this.pickedMesh.getIndices();if(!r)return null;if(e){var a=this.pickedMesh.getVerticesData(n.b.NormalKind),s=o.Vector3.FromArray(a,3*r[3*this.faceId]),c=o.Vector3.FromArray(a,3*r[3*this.faceId+1]),h=o.Vector3.FromArray(a,3*r[3*this.faceId+2]);s=s.scale(this.bu),c=c.scale(this.bv),h=h.scale(1-this.bu-this.bv),i=new o.Vector3(s.x+c.x+h.x,s.y+c.y+h.y,s.z+c.z+h.z)}else{var l=this.pickedMesh.getVerticesData(n.b.PositionKind),u=o.Vector3.FromArray(l,3*r[3*this.faceId]),p=o.Vector3.FromArray(l,3*r[3*this.faceId+1]),d=o.Vector3.FromArray(l,3*r[3*this.faceId+2]),_=u.subtract(p),m=d.subtract(p);i=o.Vector3.Cross(_,m)}if(t){var f=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(o.Tmp.Matrix[0].copyFrom(f),(f=o.Tmp.Matrix[0]).setTranslationFromFloats(0,0,0),f.invert(),f.transposeToRef(o.Tmp.Matrix[1]),f=o.Tmp.Matrix[1]),i=o.Vector3.TransformNormal(i,f)}return i.normalize(),i},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(n.b.UVKind))return null;var t=this.pickedMesh.getIndices();if(!t)return null;var e=this.pickedMesh.getVerticesData(n.b.UVKind);if(!e)return null;var i=o.Vector2.FromArray(e,2*t[3*this.faceId]),r=o.Vector2.FromArray(e,2*t[3*this.faceId+1]),a=o.Vector2.FromArray(e,2*t[3*this.faceId+2]);return i=i.scale(1-this.bu-this.bv),r=r.scale(this.bu),a=a.scale(this.bv),new o.Vector2(i.x+r.x+a.x,i.y+r.y+a.y)},t}()},70:function(t,e,i){"use strict";i.r(e),i.d(e,"ArcRotateCamera",function(){return f});var o=i(1),n=i(2),r=i(7),a=i(0),s=i(25),c=i(10),h=i(168),l=i(169),u=i(170),p=i(88),d=i(22),_=i(63),m=i(130);s.a.AddNodeConstructor("ArcRotateCamera",function(t,e){return function(){return new f(t,0,0,1,a.Vector3.Zero(),e)}});var f=function(t){function e(e,i,o,n,s,c,h){void 0===h&&(h=!0);var l=t.call(this,e,a.Vector3.Zero(),c,h)||this;return l.inertialAlphaOffset=0,l.inertialBetaOffset=0,l.inertialRadiusOffset=0,l.lowerAlphaLimit=null,l.upperAlphaLimit=null,l.lowerBetaLimit=.01,l.upperBetaLimit=Math.PI-.01,l.lowerRadiusLimit=null,l.upperRadiusLimit=null,l.inertialPanningX=0,l.inertialPanningY=0,l.pinchToPanMaxDistance=20,l.panningDistanceLimit=null,l.panningOriginTarget=a.Vector3.Zero(),l.panningInertia=.9,l.zoomOnFactor=1,l.targetScreenOffset=a.Vector2.Zero(),l.allowUpsideDown=!0,l.useInputToRestoreState=!0,l._viewMatrix=new a.Matrix,l.panningAxis=new a.Vector3(1,1,0),l.onMeshTargetChangedObservable=new r.c,l.checkCollisions=!1,l.collisionRadius=new a.Vector3(.5,.5,.5),l._previousPosition=a.Vector3.Zero(),l._collisionVelocity=a.Vector3.Zero(),l._newPosition=a.Vector3.Zero(),l._computationVector=a.Vector3.Zero(),l._onCollisionPositionChange=function(t,e,i){void 0===i&&(i=null),i?(l.setPosition(e),l.onCollide&&l.onCollide(i)):l._previousPosition.copyFrom(l.position);var o=Math.cos(l.alpha),n=Math.sin(l.alpha),r=Math.cos(l.beta),a=Math.sin(l.beta);0===a&&(a=1e-4);var s=l._getTargetPosition();l._computationVector.copyFromFloats(l.radius*o*a,l.radius*r,l.radius*n*a),s.addToRef(l._computationVector,l._newPosition),l.position.copyFrom(l._newPosition);var c=l.upVector;l.allowUpsideDown&&l.beta<0&&(c=(c=c.clone()).negate()),l._computeViewMatrix(l.position,s,c),l._viewMatrix.addAtIndex(12,l.targetScreenOffset.x),l._viewMatrix.addAtIndex(13,l.targetScreenOffset.y),l._collisionTriggered=!1},l._target=a.Vector3.Zero(),s&&l.setTarget(s),l.alpha=i,l.beta=o,l.radius=n,l.getViewMatrix(),l.inputs=new m.a(l),l.inputs.addKeyboard().addMouseWheel().addPointers(),l}return o.d(e,t),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this.setTarget(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angularSensibilityX",{get:function(){var t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.angularSensibilityX=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angularSensibilityY",{get:function(){var t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.angularSensibilityY=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pinchPrecision",{get:function(){var t=this.inputs.attached.pointers;return t?t.pinchPrecision:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.pinchPrecision=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pinchDeltaPercentage",{get:function(){var t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.pinchDeltaPercentage=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"panningSensibility",{get:function(){var t=this.inputs.attached.pointers;return t?t.panningSensibility:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.panningSensibility=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysUp",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysUp:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysUp=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysDown",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysDown:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysDown=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysLeft",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysLeft:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keysRight",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysRight:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysRight=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wheelPrecision",{get:function(){var t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0},set:function(t){var e=this.inputs.attached.mousewheel;e&&(e.wheelPrecision=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wheelDeltaPercentage",{get:function(){var t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0},set:function(t){var e=this.inputs.attached.mousewheel;e&&(e.wheelDeltaPercentage=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new l.a,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new u.a,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new h.a,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),e.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache._target=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=a.Vector2.Zero()},e.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},e.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var t=this._targetHost.absolutePosition;this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(t)}var e=this._getLockedTargetPosition();return e||this._target},e.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),t.prototype.storeState.call(this)},e.prototype._restoreStateValues=function(){return!!t.prototype._restoreStateValues.call(this)&&(this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.setTarget(this._storedTarget.clone()),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},e.prototype._isSynchronizedViewMatrix=function(){return!!t.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},e.prototype.attachControl=function(t,e,i,o){var n=this;void 0===i&&(i=!0),void 0===o&&(o=2),this._useCtrlForPanning=i,this._panningMouseButton=o,this.inputs.attachElement(t,e),this._reset=function(){n.inertialAlphaOffset=0,n.inertialBetaOffset=0,n.inertialRadiusOffset=0,n.inertialPanningX=0,n.inertialPanningY=0}},e.prototype.detachControl=function(t){this.inputs.detachElement(t),this._reset&&this._reset()},e.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var e=this.inertialAlphaOffset;this.beta<=0&&(e*=-1),this.getScene().useRightHandedSystem&&(e*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this.alpha+=e,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<a.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<a.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*a.Epsilon&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){if(this._localDirection||(this._localDirection=a.Vector3.Zero(),this._transformedDirection=a.Vector3.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),a.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),a.Vector3.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*a.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*a.Epsilon&&(this.inertialPanningY=0)}this._checkLimits(),t.prototype._checkInputs.call(this)}},e.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},e.prototype.rebuildAnglesAndRadius=function(){this.position.subtractToRef(this._getTargetPosition(),this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4),this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},e.prototype.setPosition=function(t){this.position.equals(t)||(this.position.copyFrom(t),this.rebuildAnglesAndRadius())},e.prototype.setTarget=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),t.getBoundingInfo)this._targetBoundingCenter=e?t.getBoundingInfo().boundingBox.centerWorld.clone():null,this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var o=t,n=this._getTargetPosition();if(n&&!i&&n.equals(o))return;this._targetHost=null,this._target=o,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},e.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),e=Math.sin(this.alpha),i=Math.cos(this.beta),o=Math.sin(this.beta);0===o&&(o=1e-4);var n=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*t*o,this.radius*i,this.radius*e*o),0!==this.upVector.x||1!==this.upVector.y||0!==this.upVector.z){this._tempAxisVector||(this._tempAxisVector=new a.Vector3,this._tempAxisRotationMatrix=new a.Matrix),a.Vector3.CrossToRef(a.Vector3.Up(),this.upVector,this._tempAxisVector),this._tempAxisVector.normalize();var r=Math.acos(a.Vector3.Dot(a.Vector3.UpReadOnly,this.upVector));a.Matrix.RotationAxisToRef(this._tempAxisVector,r,this._tempAxisRotationMatrix),this._tempAxisVector.copyFrom(this._computationVector),a.Vector3.TransformCoordinatesToRef(this._tempAxisVector,this._tempAxisRotationMatrix,this._computationVector)}if(n.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)this._collider||(this._collider=new p.a),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);else{this.position.copyFrom(this._newPosition);var s=this.upVector;this.allowUpsideDown&&o<0&&(s=(s=s.clone()).negate()),this._computeViewMatrix(this.position,n,s),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=n,this._viewMatrix},e.prototype.zoomOn=function(t,e){void 0===e&&(e=!1),t=t||this.getScene().meshes;var i=c.a.MinMax(t),o=a.Vector3.Distance(i.min,i.max);this.radius=o*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:o},e)},e.prototype.focusOn=function(t,e){var i,o;if(void 0===e&&(e=!1),void 0===t.min){var n=t||this.getScene().meshes;i=c.a.MinMax(n),o=a.Vector3.Distance(i.min,i.max)}else{i=t,o=t.distance}this._target=c.a.Center(i),e||(this.maxZ=2*o)},e.prototype.createRigCamera=function(t,i){var o=0;switch(this.cameraRigMode){case d.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.a.RIG_MODE_VR:o=this._cameraRigParams.stereoHalfAngle*(0===i?1:-1);break;case d.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:o=this._cameraRigParams.stereoHalfAngle*(0===i?-1:1)}var n=new e(t,this.alpha+o,this.beta,this.radius,this._target,this.getScene());return n._cameraRigParams={},n},e.prototype._updateRigCameras=function(){var e=this._rigCameras[0],i=this._rigCameras[1];switch(e.beta=i.beta=this.beta,this.cameraRigMode){case d.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.a.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case d.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}t.prototype._updateRigCameras.call(this)},e.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},e.prototype.getClassName=function(){return"ArcRotateCamera"},o.c([Object(n.c)()],e.prototype,"alpha",void 0),o.c([Object(n.c)()],e.prototype,"beta",void 0),o.c([Object(n.c)()],e.prototype,"radius",void 0),o.c([Object(n.n)("target")],e.prototype,"_target",void 0),o.c([Object(n.c)()],e.prototype,"inertialAlphaOffset",void 0),o.c([Object(n.c)()],e.prototype,"inertialBetaOffset",void 0),o.c([Object(n.c)()],e.prototype,"inertialRadiusOffset",void 0),o.c([Object(n.c)()],e.prototype,"lowerAlphaLimit",void 0),o.c([Object(n.c)()],e.prototype,"upperAlphaLimit",void 0),o.c([Object(n.c)()],e.prototype,"lowerBetaLimit",void 0),o.c([Object(n.c)()],e.prototype,"upperBetaLimit",void 0),o.c([Object(n.c)()],e.prototype,"lowerRadiusLimit",void 0),o.c([Object(n.c)()],e.prototype,"upperRadiusLimit",void 0),o.c([Object(n.c)()],e.prototype,"inertialPanningX",void 0),o.c([Object(n.c)()],e.prototype,"inertialPanningY",void 0),o.c([Object(n.c)()],e.prototype,"pinchToPanMaxDistance",void 0),o.c([Object(n.c)()],e.prototype,"panningDistanceLimit",void 0),o.c([Object(n.n)()],e.prototype,"panningOriginTarget",void 0),o.c([Object(n.c)()],e.prototype,"panningInertia",void 0),o.c([Object(n.c)()],e.prototype,"zoomOnFactor",void 0),o.c([Object(n.c)()],e.prototype,"targetScreenOffset",void 0),o.c([Object(n.c)()],e.prototype,"allowUpsideDown",void 0),o.c([Object(n.c)()],e.prototype,"useInputToRestoreState",void 0),e}(_.a)},81:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var o=i(1),n=i(0),r=i(43),a=i(16),s=function(t){function e(e,i,o,r,a,s,c){void 0===o&&(o=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===c&&(c=null);var h=t.call(this,e,i.getScene(),!1)||this;return h.name=e,h.children=new Array,h.animations=new Array,h._index=null,h._absoluteTransform=new n.Matrix,h._invertedAbsoluteTransform=new n.Matrix,h._scalingDeterminant=1,h._worldTransform=new n.Matrix,h._needToDecompose=!0,h._needToCompose=!1,h._linkedTransformNode=null,h._skeleton=i,h._localMatrix=r?r.clone():n.Matrix.Identity(),h._restPose=a||h._localMatrix.clone(),h._baseMatrix=s||h._localMatrix.clone(),h._index=c,i.bones.push(h),h.setParent(o,!1),(s||r)&&h._updateDifferenceMatrix(),h}return o.d(e,t),Object.defineProperty(e.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(t){this._localMatrix.copyFrom(t),this._needToDecompose=!0},enumerable:!0,configurable:!0}),e.prototype.getSkeleton=function(){return this._skeleton},e.prototype.getParent=function(){return this._parent},e.prototype.setParent=function(t,e){if(void 0===e&&(e=!0),this._parent!==t){if(this._parent){var i=this._parent.children.indexOf(this);-1!==i&&this._parent.children.splice(i,1)}this._parent=t,this._parent&&this._parent.children.push(this),e&&this._updateDifferenceMatrix(),this.markAsDirty()}},e.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},e.prototype.getBaseMatrix=function(){return this._baseMatrix},e.prototype.getRestPose=function(){return this._restPose},e.prototype.getWorldMatrix=function(){return this._worldTransform},e.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},e.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},e.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},e.prototype.linkTransformNode=function(t){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=t,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},Object.defineProperty(e.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(t){this._decompose(),this._localPosition.copyFrom(t),this._markAsDirtyAndCompose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.getRotation()},set:function(t){this.setRotation(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(t){this.setRotationQuaternion(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaling",{get:function(){return this.getScale()},set:function(t){this.setScale(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!0,configurable:!0}),e.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=n.Vector3.Zero(),this._localRotation=n.Quaternion.Zero(),this._localPosition=n.Vector3.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},e.prototype._compose=function(){this._needToCompose&&(this._needToCompose=!1,n.Matrix.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix))},e.prototype.updateMatrix=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),this._baseMatrix.copyFrom(t),e&&this._updateDifferenceMatrix(),i?(this._localMatrix.copyFrom(t),this._markAsDirtyAndDecompose()):this.markAsDirty()},e.prototype._updateDifferenceMatrix=function(t,e){if(void 0===e&&(e=!0),t||(t=this._baseMatrix),this._parent?t.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(t),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),e)for(var i=0;i<this.children.length;i++)this.children[i]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},e.prototype.markAsDirty=function(){this._currentRenderId++,this._childRenderId++,this._skeleton._markAsDirty()},e.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},e.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},e.prototype.copyAnimationRange=function(t,e,i,o,n){void 0===o&&(o=!1),void 0===n&&(n=null),0===this.animations.length&&(this.animations.push(new a.a(this.name,"_matrix",t.animations[0].framePerSecond,a.a.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var r=t.animations[0].getRange(e);if(!r)return!1;for(var s,c,h,l=r.from,u=r.to,p=t.animations[0].getKeys(),d=t.length,_=t.getParent(),m=this.getParent(),f=o&&_&&d&&this.length&&d!==this.length,g=f&&m&&_?m.length/_.length:1,y=o&&!m&&n&&(1!==n.x||1!==n.y||1!==n.z),v=this.animations[0].getKeys(),b=0,C=p.length;b<C;b++)(s=p[b]).frame>=l&&s.frame<=u&&(o?(h=s.value.clone(),f?(c=h.getTranslation(),h.setTranslation(c.scaleInPlace(g))):y&&n?(c=h.getTranslation(),h.setTranslation(c.multiplyInPlace(n))):h=s.value):h=s.value,v.push({frame:s.frame+i,value:h}));return this.animations[0].createRange(e,l+i,u+i),!0},e.prototype.translate=function(t,i,o){void 0===i&&(i=n.Space.LOCAL);var r=this.getLocalMatrix();if(i==n.Space.LOCAL)r.addAtIndex(12,t.x),r.addAtIndex(13,t.y),r.addAtIndex(14,t.z);else{var a=null;o&&(a=o.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=e._tmpMats[0],c=e._tmpVecs[0];this._parent&&(o&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform())),s.setTranslationFromFloats(0,0,0),s.invert(),n.Vector3.TransformCoordinatesToRef(t,s,c),r.addAtIndex(12,c.x),r.addAtIndex(13,c.y),r.addAtIndex(14,c.z)}this._markAsDirtyAndDecompose()},e.prototype.setPosition=function(t,i,o){void 0===i&&(i=n.Space.LOCAL);var r=this.getLocalMatrix();if(i==n.Space.LOCAL)r.setTranslationFromFloats(t.x,t.y,t.z);else{var a=null;o&&(a=o.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=e._tmpMats[0],c=e._tmpVecs[0];this._parent&&(o&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform())),s.invert(),n.Vector3.TransformCoordinatesToRef(t,s,c),r.setTranslationFromFloats(c.x,c.y,c.z)}this._markAsDirtyAndDecompose()},e.prototype.setAbsolutePosition=function(t,e){this.setPosition(t,n.Space.WORLD,e)},e.prototype.scale=function(t,i,o,r){void 0===r&&(r=!1);var a=this.getLocalMatrix(),s=e._tmpMats[0];n.Matrix.ScalingToRef(t,i,o,s),s.multiplyToRef(a,a),s.invert();for(var c=0,h=this.children;c<h.length;c++){var l=(d=h[c]).getLocalMatrix();l.multiplyToRef(s,l),l.multiplyAtIndex(12,t),l.multiplyAtIndex(13,i),l.multiplyAtIndex(14,o),d._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),r)for(var u=0,p=this.children;u<p.length;u++){var d;(d=p[u]).scale(t,i,o,r)}},e.prototype.setScale=function(t){this._decompose(),this._localScaling.copyFrom(t),this._markAsDirtyAndCompose()},e.prototype.getScale=function(){return this._decompose(),this._localScaling},e.prototype.getScaleToRef=function(t){this._decompose(),t.copyFrom(this._localScaling)},e.prototype.setYawPitchRoll=function(t,i,o,r,a){if(void 0===r&&(r=n.Space.LOCAL),r===n.Space.LOCAL){var s=e._tmpQuat;return n.Quaternion.RotationYawPitchRollToRef(t,i,o,s),void this.setRotationQuaternion(s,r,a)}var c=e._tmpMats[0];if(this._getNegativeRotationToRef(c,a)){var h=e._tmpMats[1];n.Matrix.RotationYawPitchRollToRef(t,i,o,h),c.multiplyToRef(h,h),this._rotateWithMatrix(h,r,a)}},e.prototype.rotate=function(t,i,o,r){void 0===o&&(o=n.Space.LOCAL);var a=e._tmpMats[0];a.setTranslationFromFloats(0,0,0),n.Matrix.RotationAxisToRef(t,i,a),this._rotateWithMatrix(a,o,r)},e.prototype.setAxisAngle=function(t,i,o,r){if(void 0===o&&(o=n.Space.LOCAL),o===n.Space.LOCAL){var a=e._tmpQuat;return n.Quaternion.RotationAxisToRef(t,i,a),void this.setRotationQuaternion(a,o,r)}var s=e._tmpMats[0];if(this._getNegativeRotationToRef(s,r)){var c=e._tmpMats[1];n.Matrix.RotationAxisToRef(t,i,c),s.multiplyToRef(c,c),this._rotateWithMatrix(c,o,r)}},e.prototype.setRotation=function(t,e,i){void 0===e&&(e=n.Space.LOCAL),this.setYawPitchRoll(t.y,t.x,t.z,e,i)},e.prototype.setRotationQuaternion=function(t,i,o){if(void 0===i&&(i=n.Space.LOCAL),i===n.Space.LOCAL)return this._decompose(),this._localRotation.copyFrom(t),void this._markAsDirtyAndCompose();var r=e._tmpMats[0];if(this._getNegativeRotationToRef(r,o)){var a=e._tmpMats[1];n.Matrix.FromQuaternionToRef(t,a),r.multiplyToRef(a,a),this._rotateWithMatrix(a,i,o)}},e.prototype.setRotationMatrix=function(t,i,o){if(void 0===i&&(i=n.Space.LOCAL),i===n.Space.LOCAL){var r=e._tmpQuat;return n.Quaternion.FromRotationMatrixToRef(t,r),void this.setRotationQuaternion(r,i,o)}var a=e._tmpMats[0];if(this._getNegativeRotationToRef(a,o)){var s=e._tmpMats[1];s.copyFrom(t),a.multiplyToRef(t,s),this._rotateWithMatrix(s,i,o)}},e.prototype._rotateWithMatrix=function(t,i,o){void 0===i&&(i=n.Space.LOCAL);var r=this.getLocalMatrix(),a=r.m[12],s=r.m[13],c=r.m[14],h=this.getParent(),l=e._tmpMats[3],u=e._tmpMats[4];h&&i==n.Space.WORLD?(o?(l.copyFrom(o.getWorldMatrix()),h.getAbsoluteTransform().multiplyToRef(l,l)):l.copyFrom(h.getAbsoluteTransform()),u.copyFrom(l),u.invert(),r.multiplyToRef(l,r),r.multiplyToRef(t,r),r.multiplyToRef(u,r)):i==n.Space.WORLD&&o?(l.copyFrom(o.getWorldMatrix()),u.copyFrom(l),u.invert(),r.multiplyToRef(l,r),r.multiplyToRef(t,r),r.multiplyToRef(u,r)):r.multiplyToRef(t,r),r.setTranslationFromFloats(a,s,c),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},e.prototype._getNegativeRotationToRef=function(t,i){var o=e._tmpMats[2];return t.copyFrom(this.getAbsoluteTransform()),i&&(t.multiplyToRef(i.getWorldMatrix(),t),n.Matrix.ScalingToRef(i.scaling.x,i.scaling.y,i.scaling.z,o)),t.invert(),!isNaN(t.m[0])&&(o.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(o,t),!0)},e.prototype.getPosition=function(t,e){void 0===t&&(t=n.Space.LOCAL),void 0===e&&(e=null);var i=n.Vector3.Zero();return this.getPositionToRef(t,e,i),i},e.prototype.getPositionToRef=function(t,i,o){if(void 0===t&&(t=n.Space.LOCAL),t==n.Space.LOCAL){var r=this.getLocalMatrix();o.x=r.m[12],o.y=r.m[13],o.z=r.m[14]}else{var a=null;i&&(a=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=e._tmpMats[0];i&&a?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(a,s)):s=this.getAbsoluteTransform(),o.x=s.m[12],o.y=s.m[13],o.z=s.m[14]}},e.prototype.getAbsolutePosition=function(t){void 0===t&&(t=null);var e=n.Vector3.Zero();return this.getPositionToRef(n.Space.WORLD,t,e),e},e.prototype.getAbsolutePositionToRef=function(t,e){this.getPositionToRef(n.Space.WORLD,t,e)},e.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var t=this._skeleton.getPoseMatrix();t&&this._absoluteTransform.multiplyToRef(t,this._absoluteTransform)}for(var e=this.children,i=e.length,o=0;o<i;o++)e[o].computeAbsoluteTransforms()},e.prototype.getDirection=function(t,e){void 0===e&&(e=null);var i=n.Vector3.Zero();return this.getDirectionToRef(t,e,i),i},e.prototype.getDirectionToRef=function(t,i,o){void 0===i&&(i=null);var r=null;i&&(r=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=e._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),i&&r&&a.multiplyToRef(r,a),n.Vector3.TransformNormalToRef(t,a,o),o.normalize()},e.prototype.getRotation=function(t,e){void 0===t&&(t=n.Space.LOCAL),void 0===e&&(e=null);var i=n.Vector3.Zero();return this.getRotationToRef(t,e,i),i},e.prototype.getRotationToRef=function(t,i,o){void 0===t&&(t=n.Space.LOCAL),void 0===i&&(i=null);var r=e._tmpQuat;this.getRotationQuaternionToRef(t,i,r),r.toEulerAnglesToRef(o)},e.prototype.getRotationQuaternion=function(t,e){void 0===t&&(t=n.Space.LOCAL),void 0===e&&(e=null);var i=n.Quaternion.Identity();return this.getRotationQuaternionToRef(t,e,i),i},e.prototype.getRotationQuaternionToRef=function(t,i,o){if(void 0===t&&(t=n.Space.LOCAL),void 0===i&&(i=null),t==n.Space.LOCAL)this._decompose(),o.copyFrom(this._localRotation);else{var r=e._tmpMats[0],a=this.getAbsoluteTransform();i?a.multiplyToRef(i.getWorldMatrix(),r):r.copyFrom(a),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.decompose(void 0,o,void 0)}},e.prototype.getRotationMatrix=function(t,e){void 0===t&&(t=n.Space.LOCAL);var i=n.Matrix.Identity();return this.getRotationMatrixToRef(t,e,i),i},e.prototype.getRotationMatrixToRef=function(t,i,o){if(void 0===t&&(t=n.Space.LOCAL),t==n.Space.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(o);else{var r=e._tmpMats[0],a=this.getAbsoluteTransform();i?a.multiplyToRef(i.getWorldMatrix(),r):r.copyFrom(a),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.getRotationMatrixToRef(o)}},e.prototype.getAbsolutePositionFromLocal=function(t,e){void 0===e&&(e=null);var i=n.Vector3.Zero();return this.getAbsolutePositionFromLocalToRef(t,e,i),i},e.prototype.getAbsolutePositionFromLocalToRef=function(t,i,o){void 0===i&&(i=null);var r=null;i&&(r=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=e._tmpMats[0];i&&r?(a.copyFrom(this.getAbsoluteTransform()),a.multiplyToRef(r,a)):a=this.getAbsoluteTransform(),n.Vector3.TransformCoordinatesToRef(t,a,o)},e.prototype.getLocalPositionFromAbsolute=function(t,e){void 0===e&&(e=null);var i=n.Vector3.Zero();return this.getLocalPositionFromAbsoluteToRef(t,e,i),i},e.prototype.getLocalPositionFromAbsoluteToRef=function(t,i,o){void 0===i&&(i=null);var r=null;i&&(r=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=e._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),i&&r&&a.multiplyToRef(r,a),a.invert(),n.Vector3.TransformCoordinatesToRef(t,a,o)},e._tmpVecs=r.a.BuildArray(2,n.Vector3.Zero),e._tmpQuat=n.Quaternion.Identity(),e._tmpMats=r.a.BuildArray(5,n.Matrix.Identity),e}(i(25).a)},85:function(t,e,i){"use strict";i.d(e,"b",function(){return o}),i.d(e,"a",function(){return h});var o,n=i(7),r=i(0),a=i(23),s=i(188),c=i(186);!function(t){t[t.ENTERING_XR=0]="ENTERING_XR",t[t.EXITING_XR=1]="EXITING_XR",t[t.IN_XR=2]="IN_XR",t[t.NOT_IN_XR=3]="NOT_IN_XR"}(o||(o={}));var h=function(){function t(t){this.scene=t,this.state=o.NOT_IN_XR,this.onStateChangedObservable=new n.c,this._nonVRCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this.camera=new c.a("",t),this._sessionManager=new s.a(t),this.container=new a.a("",t),this.camera.parent=this.container}return t.prototype._setState=function(t){this.state=t,this.onStateChangedObservable.notifyObservers(this.state)},t.CreateAsync=function(e){var i=new t(e);return i._sessionManager.initializeAsync().then(function(){return i._supported=!0,i}).catch(function(){return i})},t.prototype.exitXRAsync=function(){return this._setState(o.EXITING_XR),this._sessionManager.exitXRAsync()},t.prototype.enterXRAsync=function(t,e){var i=this;if(!this._supported)throw"XR session not supported by this browser";return this._setState(o.ENTERING_XR),this._sessionManager.enterXRAsync(t,e).then(function(){i._originalSceneAutoClear=i.scene.autoClear,i._nonVRCamera=i.scene.activeCamera,i.scene.autoClear=!1,i.scene.activeCamera=i.camera,i._sessionManager.onXRFrameObservable.add(function(){i.camera.updateFromXRSessionManager(i._sessionManager)}),i._sessionManager.onXRSessionEnded.addOnce(function(){i.camera.rigCameras.forEach(function(t){t.outputRenderTarget=null}),i.scene.autoClear=i._originalSceneAutoClear,i.scene.activeCamera=i._nonVRCamera,i._sessionManager.onXRFrameObservable.clear(),i._setState(o.NOT_IN_XR)}),i._setState(o.IN_XR)})},t.prototype.environmentPointHitTestAsync=function(t){return this._sessionManager.environmentPointHitTestAsync(t)},t.prototype.setPositionOfCameraUsingContainer=function(e){this.camera.globalPosition.subtractToRef(e,t._TmpVector),this.container.position.subtractInPlace(t._TmpVector)},t.prototype.rotateCameraByQuaternionUsingContainer=function(t){this.container.rotationQuaternion||(this.container.rotationQuaternion=r.Quaternion.FromEulerVector(this.container.rotation)),this.container.rotationQuaternion.multiplyInPlace(t),this.container.position.rotateByQuaternionAroundPointToRef(t,this.camera.globalPosition,this.container.position)},t.prototype.supportsSessionAsync=function(t){return this._supported?this._sessionManager.supportsSessionAsync(t):Promise.resolve(!1)},t.prototype.dispose=function(){this.camera.dispose(),this.container.dispose(),this.onStateChangedObservable.clear(),this._sessionManager.dispose()},t._TmpVector=new r.Vector3,t}()},88:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var o,n=i(0),r=(o={root:0,found:!1},function(t,e,i,n){o.root=0,o.found=!1;var r=e*e-4*t*i;if(r<0)return o;var a=Math.sqrt(r),s=(-e-a)/(2*t),c=(-e+a)/(2*t);if(s>c){var h=c;c=s,s=h}return s>0&&s<n?(o.root=s,o.found=!0,o):c>0&&c<n?(o.root=c,o.found=!0,o):o}),a=function(){function t(){this._collisionPoint=n.Vector3.Zero(),this._planeIntersectionPoint=n.Vector3.Zero(),this._tempVector=n.Vector3.Zero(),this._tempVector2=n.Vector3.Zero(),this._tempVector3=n.Vector3.Zero(),this._tempVector4=n.Vector3.Zero(),this._edge=n.Vector3.Zero(),this._baseToVertex=n.Vector3.Zero(),this._destinationPoint=n.Vector3.Zero(),this._slidePlaneNormal=n.Vector3.Zero(),this._displacementVector=n.Vector3.Zero(),this._radius=n.Vector3.One(),this._retry=0,this._basePointWorld=n.Vector3.Zero(),this._velocityWorld=n.Vector3.Zero(),this._normalizedVelocity=n.Vector3.Zero(),this._collisionMask=-1}return Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(t){this._collisionMask=isNaN(t)?-1:t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!0,configurable:!0}),t.prototype._initialize=function(t,e,i){this._velocity=e,n.Vector3.NormalizeToRef(e,this._normalizedVelocity),this._basePoint=t,t.multiplyToRef(this._radius,this._basePointWorld),e.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=i,this.collisionFound=!1},t.prototype._checkPointInTriangle=function(t,e,i,o,r){e.subtractToRef(t,this._tempVector),i.subtractToRef(t,this._tempVector2),n.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var a=n.Vector3.Dot(this._tempVector4,r);return!(a<0)&&(o.subtractToRef(t,this._tempVector3),n.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((a=n.Vector3.Dot(this._tempVector4,r))<0)&&(n.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(a=n.Vector3.Dot(this._tempVector4,r))>=0))},t.prototype._canDoCollision=function(t,e,i,o){var r=n.Vector3.Distance(this._basePointWorld,t),a=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(r>this._velocityWorldLength+a+e)&&!!function(t,e,i,o){return!(t.x>i.x+o||i.x-o>e.x||t.y>i.y+o||i.y-o>e.y||t.z>i.z+o||i.z-o>e.z)}(i,o,this._basePointWorld,this._velocityWorldLength+a)},t.prototype._testTriangle=function(t,e,i,o,a,s){var c,h=!1;e||(e=[]),e[t]||(e[t]=new n.Plane(0,0,0,0),e[t].copyFromPoints(i,o,a));var l=e[t];if(s||l.isFrontFacingTo(this._normalizedVelocity,0)){var u=l.signedDistanceTo(this._basePoint),p=n.Vector3.Dot(l.normal,this._velocity);if(0==p){if(Math.abs(u)>=1)return;h=!0,c=0}else{var d=(1-u)/p;if((c=(-1-u)/p)>d){var _=d;d=c,c=_}if(c>1||d<0)return;c<0&&(c=0),c>1&&(c=1)}this._collisionPoint.copyFromFloats(0,0,0);var m=!1,f=1;if(h||(this._basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(c,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,i,o,a,l.normal)&&(m=!0,f=c,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!m){var g=this._velocity.lengthSquared(),y=g;this._basePoint.subtractToRef(i,this._tempVector);var v=2*n.Vector3.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,C=r(y,v,b,f);C.found&&(f=C.root,m=!0,this._collisionPoint.copyFrom(i)),this._basePoint.subtractToRef(o,this._tempVector),v=2*n.Vector3.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,(C=r(y,v,b,f)).found&&(f=C.root,m=!0,this._collisionPoint.copyFrom(o)),this._basePoint.subtractToRef(a,this._tempVector),v=2*n.Vector3.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,(C=r(y,v,b,f)).found&&(f=C.root,m=!0,this._collisionPoint.copyFrom(a)),o.subtractToRef(i,this._edge),i.subtractToRef(this._basePoint,this._baseToVertex);var R=this._edge.lengthSquared(),M=n.Vector3.Dot(this._edge,this._velocity),P=n.Vector3.Dot(this._edge,this._baseToVertex);if(y=R*-g+M*M,v=R*(2*n.Vector3.Dot(this._velocity,this._baseToVertex))-2*M*P,b=R*(1-this._baseToVertex.lengthSquared())+P*P,(C=r(y,v,b,f)).found){var x=(M*C.root-P)/R;x>=0&&x<=1&&(f=C.root,m=!0,this._edge.scaleInPlace(x),i.addToRef(this._edge,this._collisionPoint))}a.subtractToRef(o,this._edge),o.subtractToRef(this._basePoint,this._baseToVertex),R=this._edge.lengthSquared(),M=n.Vector3.Dot(this._edge,this._velocity),P=n.Vector3.Dot(this._edge,this._baseToVertex),y=R*-g+M*M,v=R*(2*n.Vector3.Dot(this._velocity,this._baseToVertex))-2*M*P,b=R*(1-this._baseToVertex.lengthSquared())+P*P,(C=r(y,v,b,f)).found&&(x=(M*C.root-P)/R)>=0&&x<=1&&(f=C.root,m=!0,this._edge.scaleInPlace(x),o.addToRef(this._edge,this._collisionPoint)),i.subtractToRef(a,this._edge),a.subtractToRef(this._basePoint,this._baseToVertex),R=this._edge.lengthSquared(),M=n.Vector3.Dot(this._edge,this._velocity),P=n.Vector3.Dot(this._edge,this._baseToVertex),y=R*-g+M*M,v=R*(2*n.Vector3.Dot(this._velocity,this._baseToVertex))-2*M*P,b=R*(1-this._baseToVertex.lengthSquared())+P*P,(C=r(y,v,b,f)).found&&(x=(M*C.root-P)/R)>=0&&x<=1&&(f=C.root,m=!0,this._edge.scaleInPlace(x),a.addToRef(this._edge,this._collisionPoint))}if(m){var T=f*this._velocity.length();(!this.collisionFound||T<this._nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=T,this.collisionFound=!0)}}},t.prototype._collide=function(t,e,i,o,n,r,a){for(var s=o;s<n;s+=3){var c=e[i[s]-r],h=e[i[s+1]-r],l=e[i[s+2]-r];this._testTriangle(s,t,l,h,c,a)}},t.prototype._getResponse=function(t,e){t.addToRef(e,this._destinationPoint),e.scaleInPlace(this._nearestDistance/e.length()),this._basePoint.addToRef(e,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(n.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,e)},t}()},89:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var o=i(0),n=function(){function t(){this.compensateDistortion=!0}return Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return o.Matrix.Translation(t,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return o.Matrix.Translation(-t,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftPreViewMatrix",{get:function(){return o.Matrix.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightPreViewMatrix",{get:function(){return o.Matrix.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),t.GetDefault=function(){var e=new t;return e.hResolution=1280,e.vResolution=800,e.hScreenSize=.149759993,e.vScreenSize=.0935999975,e.vScreenCenter=.0467999987,e.eyeToScreenDistance=.0410000011,e.lensSeparationDistance=.063500002,e.interpupillaryDistance=.064000003,e.distortionK=[1,.219999999,.239999995,0],e.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],e.postProcessScaleFactor=1.714605507808412,e.lensCenterOffset=.151976421,e},t}()},92:function(t,e,i){"use strict";i.d(e,"a",function(){return p});var o=i(81),n=i(7),r=i(0),a=i(72),s=i(16),c=i(21),h=i(4),l=i(9),u=i(41),p=function(){function t(t,e,i){this.name=t,this.id=e,this.bones=new Array,this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=r.Matrix.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._numBonesWithLinkedTransformNode=0,this.doNotSerialize=!1,this.useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new n.c,this.bones=[],this._scene=i||c.a.LastCreatedScene,this._scene.skeletons.push(this),this._isDirty=!0;var o=this._scene.getEngine().getCaps();this._canUseTextureForBones=o.textureFloat&&o.maxVertexTextureImageUnits>0}return Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones&&!this.needInitialSkinMatrix},enumerable:!0,configurable:!0}),t.prototype.getTransformMatrices=function(t){return this.needInitialSkinMatrix&&t._bonesTransformMatrices?t._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},t.prototype.getTransformMatrixTexture=function(){return this._transformMatrixTexture},t.prototype.getScene=function(){return this._scene},t.prototype.toString=function(t){var e="Name: "+this.name+", nBones: "+this.bones.length;if(e+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";var i=!0;for(var o in this._ranges)i&&(e+=", ",i=!1),e+=o;e+="}"}return e},t.prototype.getBoneIndexByName=function(t){for(var e=0,i=this.bones.length;e<i;e++)if(this.bones[e].name===t)return e;return-1},t.prototype.createAnimationRange=function(t,e,i){if(!this._ranges[t]){this._ranges[t]=new s.d(t,e,i);for(var o=0,n=this.bones.length;o<n;o++)this.bones[o].animations[0]&&this.bones[o].animations[0].createRange(t,e,i)}},t.prototype.deleteAnimationRange=function(t,e){void 0===e&&(e=!0);for(var i=0,o=this.bones.length;i<o;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(t,e);this._ranges[t]=null},t.prototype.getAnimationRange=function(t){return this._ranges[t]},t.prototype.getAnimationRanges=function(){var t,e=[],i=0;for(t in this._ranges)e[i]=this._ranges[t],i++;return e},t.prototype.copyAnimationRange=function(t,e,i){if(void 0===i&&(i=!1),this._ranges[e]||!t.getAnimationRange(e))return!1;var o,n,r=!0,a=this._getHighestAnimationFrame()+1,c={},h=t.bones;for(n=0,o=h.length;n<o;n++)c[h[n].name]=h[n];this.bones.length!==h.length&&(l.a.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+h.length),r=!1);var u=i&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(n=0,o=this.bones.length;n<o;n++){var p=this.bones[n].name,d=c[p];d?r=r&&this.bones[n].copyAnimationRange(d,e,a,i,u):(l.a.Warn("copyAnimationRange: not same rig, missing source bone "+p),r=!1)}var _=t.getAnimationRange(e);return _&&(this._ranges[e]=new s.d(e,_.from+a,_.to+a)),r},t.prototype.returnToRest=function(){for(var t=0;t<this.bones.length;t++)this.bones[t].returnToRest()},t.prototype._getHighestAnimationFrame=function(){for(var t=0,e=0,i=this.bones.length;e<i;e++)if(this.bones[e].animations[0]){var o=this.bones[e].animations[0].getHighestFrame();t<o&&(t=o)}return t},t.prototype.beginAnimation=function(t,e,i,o){var n=this.getAnimationRange(t);return n?this._scene.beginAnimation(this,n.from,n.to,e,i,o):null},t.prototype._markAsDirty=function(){this._isDirty=!0},t.prototype._registerMeshWithPoseMatrix=function(t){this._meshesWithPoseMatrix.push(t)},t.prototype._unregisterMeshWithPoseMatrix=function(t){var e=this._meshesWithPoseMatrix.indexOf(t);e>-1&&this._meshesWithPoseMatrix.splice(e,1)},t.prototype._computeTransformMatrices=function(t,e){this.onBeforeComputeObservable.notifyObservers(this);for(var i=0;i<this.bones.length;i++){var o=this.bones[i],n=o.getParent();if(n?o.getLocalMatrix().multiplyToRef(n.getWorldMatrix(),o.getWorldMatrix()):e?o.getLocalMatrix().multiplyToRef(e,o.getWorldMatrix()):o.getWorldMatrix().copyFrom(o.getLocalMatrix()),-1!==o._index){var r=null===o._index?i:o._index;o.getInvertedAbsoluteTransform().multiplyToArray(o.getWorldMatrix(),t,16*r)}}this._identity.copyToArray(t,16*this.bones.length)},t.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var t=0,e=this.bones;t<e.length;t++){var i=e[t];i._linkedTransformNode&&(i._linkedTransformNode.computeWorldMatrix(),i._matrix=i._linkedTransformNode._localMatrix,i.markAsDirty())}if(this._isDirty){if(this.needInitialSkinMatrix)for(var o=0;o<this._meshesWithPoseMatrix.length;o++){var n=this._meshesWithPoseMatrix[o],s=n.getPoseMatrix();if(n._bonesTransformMatrices&&n._bonesTransformMatrices.length===16*(this.bones.length+1)||(n._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==n){this._synchronizedWithMesh=n;for(var c=0;c<this.bones.length;c++){var l=this.bones[c];if(!l.getParent())l.getBaseMatrix().multiplyToRef(s,r.Tmp.Matrix[1]),l._updateDifferenceMatrix(r.Tmp.Matrix[1])}}this._computeTransformMatrices(n._bonesTransformMatrices,s)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=a.a.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,h.a.TEXTURE_NEAREST_SAMPLINGMODE,h.a.TEXTURETYPE_FLOAT))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},t.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var t=0;t<this.bones.length;t++)this._animatables.push(this.bones[t])}return this._animatables},t.prototype.clone=function(e,i){var n=new t(e,i||e,this._scene);n.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var r=0;r<this.bones.length;r++){var a=this.bones[r],s=null,c=a.getParent();if(c){var h=this.bones.indexOf(c);s=n.bones[h]}var l=new o.a(a.name,n,s,a.getBaseMatrix().clone(),a.getRestPose().clone());u.a.DeepCopy(a.animations,l.animations)}if(this._ranges)for(var p in n._ranges={},this._ranges){var d=this._ranges[p];d&&(n._ranges[p]=d.clone())}return this._isDirty=!0,n},t.prototype.enableBlending=function(t){void 0===t&&(t=.01),this.bones.forEach(function(e){e.animations.forEach(function(e){e.enableBlending=!0,e.blendingSpeed=t})})},t.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},t.prototype.serialize=function(){var t={};t.name=this.name,t.id=this.id,this.dimensionsAtRest&&(t.dimensionsAtRest=this.dimensionsAtRest.asArray()),t.bones=[],t.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var e=0;e<this.bones.length;e++){var i=this.bones[e],o=i.getParent(),n={parentBoneIndex:o?this.bones.indexOf(o):-1,name:i.name,matrix:i.getBaseMatrix().toArray(),rest:i.getRestPose().toArray()};for(var r in t.bones.push(n),i.length&&(n.length=i.length),i.metadata&&(n.metadata=i.metadata),i.animations&&i.animations.length>0&&(n.animation=i.animations[0].serialize()),t.ranges=[],this._ranges){var a=this._ranges[r];if(a){var s={};s.name=r,s.from=a.from,s.to=a.to,t.ranges.push(s)}}}return t},t.Parse=function(e,i){var n,a=new t(e.name,e.id,i);for(e.dimensionsAtRest&&(a.dimensionsAtRest=r.Vector3.FromArray(e.dimensionsAtRest)),a.needInitialSkinMatrix=e.needInitialSkinMatrix,n=0;n<e.bones.length;n++){var c=e.bones[n],h=null;c.parentBoneIndex>-1&&(h=a.bones[c.parentBoneIndex]);var l=c.rest?r.Matrix.FromArray(c.rest):null,u=new o.a(c.name,a,h,r.Matrix.FromArray(c.matrix),l);void 0!==c.id&&null!==c.id&&(u.id=c.id),c.length&&(u.length=c.length),c.metadata&&(u.metadata=c.metadata),c.animation&&u.animations.push(s.a.Parse(c.animation))}if(e.ranges)for(n=0;n<e.ranges.length;n++){var p=e.ranges[n];a.createAnimationRange(p.name,p.from,p.to)}return a},t.prototype.computeAbsoluteTransforms=function(t){void 0===t&&(t=!1);var e=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=e||t)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=e)},t.prototype.getPoseMatrix=function(){var t=null;return this._meshesWithPoseMatrix.length>0&&(t=this._meshesWithPoseMatrix[0].getPoseMatrix()),t},t.prototype.sortBones=function(){for(var t=new Array,e=new Array(this.bones.length),i=0;i<this.bones.length;i++)this._sortBones(i,t,e);this.bones=t},t.prototype._sortBones=function(t,e,i){if(!i[t]){i[t]=!0;var o=this.bones[t];void 0===o._index&&(o._index=t);var n=o.getParent();n&&this._sortBones(this.bones.indexOf(n),e,i),e.push(o)}},t}()}}]);