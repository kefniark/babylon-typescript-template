(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1:function(e,t,r){"use strict";r.d(t,"d",function(){return a}),r.d(t,"a",function(){return o}),r.d(t,"c",function(){return i}),r.d(t,"b",function(){return s}),r.d(t,"e",function(){return l});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function a(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function i(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i}function s(e,t,r,n){return new(r||(r=Promise))(function(a,o){function i(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(i,s)}l((n=n.apply(e,t||[])).next())})}function l(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}},267:function(e,t,r){},317:function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"GLTFBinaryExtension",function(){return ve}),r.d(n,"GLTFLoaderBase",function(){return _e}),r.d(n,"GLTFLoader",function(){return ye}),r.d(n,"GLTFLoaderExtension",function(){return ge}),r.d(n,"EComponentType",function(){return p}),r.d(n,"EShaderType",function(){return m}),r.d(n,"EParameterType",function(){return _}),r.d(n,"ETextureWrapMode",function(){return y}),r.d(n,"ETextureFilterType",function(){return g}),r.d(n,"ETextureFormat",function(){return v}),r.d(n,"ECullingType",function(){return b}),r.d(n,"EBlendingFunction",function(){return A}),r.d(n,"GLTFUtils",function(){return Q}),r.d(n,"GLTFMaterialsCommonExtension",function(){return be});var a={};r.r(a),r.d(a,"ArrayItem",function(){return we}),r.d(a,"GLTFLoader",function(){return Se}),r.d(a,"EXT_lights_image_based",function(){return Fe}),r.d(a,"KHR_draco_mesh_compression",function(){return Ve}),r.d(a,"KHR_lights",function(){return Ge}),r.d(a,"KHR_materials_pbrSpecularGlossiness",function(){return He}),r.d(a,"KHR_materials_unlit",function(){return Ke}),r.d(a,"KHR_texture_transform",function(){return ze}),r.d(a,"MSFT_audio_emitter",function(){return Xe}),r.d(a,"MSFT_lod",function(){return Je}),r.d(a,"MSFT_minecraftMesh",function(){return et}),r.d(a,"MSFT_sRGBFactors",function(){return rt});var o,i,s,l=r(7),u=r(5),c=r(29),f=r(87);!function(e){e[e.AUTO=0]="AUTO",e[e.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(o||(o={})),function(e){e[e.NONE=0]="NONE",e[e.FIRST=1]="FIRST",e[e.ALL=2]="ALL"}(i||(i={})),function(e){e[e.LOADING=0]="LOADING",e[e.READY=1]="READY",e[e.COMPLETE=2]="COMPLETE"}(s||(s={}));var h=function(){function e(){this.onParsedObservable=new l.c,this.coordinateSystemMode=o.AUTO,this.animationStartMode=i.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable=new l.c,this.onTextureLoadedObservable=new l.c,this.onMaterialLoadedObservable=new l.c,this.onCameraLoadedObservable=new l.c,this.onCompleteObservable=new l.c,this.onErrorObservable=new l.c,this.onDisposeObservable=new l.c,this.onExtensionLoadedObservable=new l.c,this.validate=!1,this.onValidatedObservable=new l.c,this._loader=null,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(e.prototype,"onParsed",{set:function(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onMeshLoaded",{set:function(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onTextureLoaded",{set:function(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onMaterialLoaded",{set:function(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onCameraLoaded",{set:function(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{set:function(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onError",{set:function(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onExtensionLoaded",{set:function(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onValidated",{set:function(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null),this._clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},e.prototype._clear=function(){this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear()},e.prototype.importMeshAsync=function(e,t,r,n,a,o){var i=this;return this._parseAsync(t,r,n,o).then(function(r){return i._log("Loading "+(o||"")),i._loader=i._getLoader(r),i._loader.importMeshAsync(e,t,r,n,a,o)})},e.prototype.loadAsync=function(e,t,r,n,a){var o=this;return this._parseAsync(e,t,r,a).then(function(t){return o._log("Loading "+(a||"")),o._loader=o._getLoader(t),o._loader.loadAsync(e,t,r,n,a)})},e.prototype.loadAssetContainerAsync=function(e,t,r,n,a){var o=this;return this._parseAsync(e,t,r,a).then(function(t){return o._log("Loading "+(a||"")),o._loader=o._getLoader(t),o._loader.importMeshAsync(null,e,t,r,n,a).then(function(t){var r=new f.a(e);return Array.prototype.push.apply(r.meshes,t.meshes),Array.prototype.push.apply(r.particleSystems,t.particleSystems),Array.prototype.push.apply(r.skeletons,t.skeletons),Array.prototype.push.apply(r.animationGroups,t.animationGroups),r.removeAllFromScene(),r})})},e.prototype.canDirectLoad=function(e){return-1!==e.indexOf("scene")&&-1!==e.indexOf("node")},e.prototype.createPlugin=function(){return new e},Object.defineProperty(e.prototype,"loaderState",{get:function(){return this._loader?this._loader.state:null},enumerable:!0,configurable:!0}),e.prototype.whenCompleteAsync=function(){var e=this;return new Promise(function(t,r){e.onCompleteObservable.addOnce(function(){t()}),e.onErrorObservable.addOnce(function(e){r(e)})})},e.prototype._parseAsync=function(e,t,r,n){var a=this;return Promise.resolve().then(function(){var o=t instanceof ArrayBuffer?a._unpackBinary(t):{json:t,bin:null};return a._validateAsync(e,o.json,r,n).then(function(){a._startPerformanceCounter("Parse JSON"),a._log("JSON length: "+o.json.length);var e={json:JSON.parse(o.json),bin:o.bin};return a._endPerformanceCounter("Parse JSON"),a.onParsedObservable.notifyObservers(e),a.onParsedObservable.clear(),e})})},e.prototype._validateAsync=function(e,t,r,n){var a=this;if(!this.validate||"undefined"==typeof GLTFValidator)return Promise.resolve();this._startPerformanceCounter("Validate JSON");var o={externalResourceFunction:function(t){return a.preprocessUrlAsync(r+t).then(function(t){return e._loadFileAsync(t,!0,!0)}).then(function(e){return new Uint8Array(e)})}};return n&&"data:"!==n.substr(0,5)&&(o.uri="file:"===r?n:""+r+n),GLTFValidator.validateString(t,o).then(function(e){a._endPerformanceCounter("Validate JSON"),a.onValidatedObservable.notifyObservers(e),a.onValidatedObservable.clear()},function(e){a._endPerformanceCounter("Validate JSON"),u.h.Warn("Failed to validate: "+e),a.onValidatedObservable.clear()})},e.prototype._getLoader=function(t){var r=t.json.asset||{};this._log("Asset version: "+r.version),r.minVersion&&this._log("Asset minimum version: "+r.minVersion),r.generator&&this._log("Asset generator: "+r.generator);var n=e._parseVersion(r.version);if(!n)throw new Error("Invalid version: "+r.version);if(void 0!==r.minVersion){var a=e._parseVersion(r.minVersion);if(!a)throw new Error("Invalid minimum version: "+r.minVersion);if(e._compareVersion(a,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+r.minVersion)}var o={1:e._CreateGLTF1Loader,2:e._CreateGLTF2Loader}[n.major];if(!o)throw new Error("Unsupported version: "+r.version);return o(this)},e.prototype._unpackBinary=function(e){this._startPerformanceCounter("Unpack binary"),this._log("Binary length: "+e.byteLength);var t=new d(e),r=t.readUint32();if(1179937895!==r)throw new Error("Unexpected magic: "+r);var n,a=t.readUint32();switch(this.loggingEnabled&&this._log("Binary version: "+a),a){case 1:n=this._unpackBinaryV1(t);break;case 2:n=this._unpackBinaryV2(t);break;default:throw new Error("Unsupported version: "+a)}return this._endPerformanceCounter("Unpack binary"),n},e.prototype._unpackBinaryV1=function(t){var r=t.readUint32();if(r!=t.getLength())throw new Error("Length in header does not match actual data length: "+r+" != "+t.getLength());var n,a=t.readUint32(),o=t.readUint32();switch(o){case 0:n=e._decodeBufferToText(t.readUint8Array(a));break;default:throw new Error("Unexpected content format: "+o)}var i=t.getLength()-t.getPosition();return{json:n,bin:t.readUint8Array(i)}},e.prototype._unpackBinaryV2=function(t){var r=1313821514,n=5130562,a=t.readUint32();if(a!==t.getLength())throw new Error("Length in header does not match actual data length: "+a+" != "+t.getLength());var o=t.readUint32();if(t.readUint32()!==r)throw new Error("First chunk format is not JSON");for(var i=e._decodeBufferToText(t.readUint8Array(o)),s=null;t.getPosition()<t.getLength();){var l=t.readUint32();switch(t.readUint32()){case r:throw new Error("Unexpected JSON chunk");case n:s=t.readUint8Array(l);break;default:t.skipBytes(l)}}return{json:i,bin:s}},e._parseVersion=function(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};var t=(e+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null},e._compareVersion=function(e,t){return e.major>t.major?1:e.major<t.major?-1:e.minor>t.minor?1:e.minor<t.minor?-1:0},e._decodeBufferToText=function(e){for(var t="",r=e.byteLength,n=0;n<r;n++)t+=String.fromCharCode(e[n]);return t},e.prototype._logOpen=function(e){this._log(e),this._logIndentLevel++},e.prototype._logClose=function(){--this._logIndentLevel},e.prototype._logEnabled=function(t){var r=e._logSpaces.substr(0,2*this._logIndentLevel);u.h.Log(""+r+t)},e.prototype._logDisabled=function(e){},e.prototype._startPerformanceCounterEnabled=function(e){u.h.StartPerformanceCounter(e)},e.prototype._startPerformanceCounterDisabled=function(e){},e.prototype._endPerformanceCounterEnabled=function(e){u.h.EndPerformanceCounter(e)},e.prototype._endPerformanceCounterDisabled=function(e){},e.IncrementalLoading=!0,e.HomogeneousCoordinates=!1,e._logSpaces="                                ",e}(),d=function(){function e(e){this._arrayBuffer=e,this._dataView=new DataView(e),this._byteOffset=0}return e.prototype.getPosition=function(){return this._byteOffset},e.prototype.getLength=function(){return this._arrayBuffer.byteLength},e.prototype.readUint32=function(){var e=this._dataView.getUint32(this._byteOffset,!0);return this._byteOffset+=4,e},e.prototype.readUint8Array=function(e){var t=new Uint8Array(this._arrayBuffer,this._byteOffset,e);return this._byteOffset+=e,t},e.prototype.skipBytes=function(e){this._byteOffset+=e},e}();c.a&&c.a.RegisterPlugin(new h);var p,m,_,y,g,v,b,A,x=r(1);!function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.FLOAT=5126]="FLOAT"}(p||(p={})),function(e){e[e.FRAGMENT=35632]="FRAGMENT",e[e.VERTEX=35633]="VERTEX"}(m||(m={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D"}(_||(_={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.REPEAT=10497]="REPEAT"}(y||(y={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9728]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(g||(g={})),function(e){e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(v||(v={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(b||(b={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(A||(A={}));var T,E=r(0),M=r(22),O=r(48),w=r(16),S=r(81),L=r(92),C=r(8),R=r(14),N=r(84),F=r(31),P=r(78),I=r(6),V=r(24),D=r(3),B=r(32),U=r(56),G=r(23),k=r(10),H=r(71),W=r(107),K=r(108),j=r(109),z=r(11),Q=function(){function e(){}return e.SetMatrix=function(e,t,r,n,a){var o=null;if("MODEL"===r.semantic?o=t.getWorldMatrix():"PROJECTION"===r.semantic?o=e.getProjectionMatrix():"VIEW"===r.semantic?o=e.getViewMatrix():"MODELVIEWINVERSETRANSPOSE"===r.semantic?o=E.Matrix.Transpose(t.getWorldMatrix().multiply(e.getViewMatrix()).invert()):"MODELVIEW"===r.semantic?o=t.getWorldMatrix().multiply(e.getViewMatrix()):"MODELVIEWPROJECTION"===r.semantic?o=t.getWorldMatrix().multiply(e.getTransformMatrix()):"MODELINVERSE"===r.semantic?o=t.getWorldMatrix().invert():"VIEWINVERSE"===r.semantic?o=e.getViewMatrix().invert():"PROJECTIONINVERSE"===r.semantic?o=e.getProjectionMatrix().invert():"MODELVIEWINVERSE"===r.semantic?o=t.getWorldMatrix().multiply(e.getViewMatrix()).invert():"MODELVIEWPROJECTIONINVERSE"===r.semantic?o=t.getWorldMatrix().multiply(e.getTransformMatrix()).invert():"MODELINVERSETRANSPOSE"===r.semantic&&(o=E.Matrix.Transpose(t.getWorldMatrix().invert())),o)switch(r.type){case _.FLOAT_MAT2:a.setMatrix2x2(n,E.Matrix.GetAsMatrix2x2(o));break;case _.FLOAT_MAT3:a.setMatrix3x3(n,E.Matrix.GetAsMatrix3x3(o));break;case _.FLOAT_MAT4:a.setMatrix(n,o)}},e.SetUniform=function(e,t,r,n){switch(n){case _.FLOAT:return e.setFloat(t,r),!0;case _.FLOAT_VEC2:return e.setVector2(t,E.Vector2.FromArray(r)),!0;case _.FLOAT_VEC3:return e.setVector3(t,E.Vector3.FromArray(r)),!0;case _.FLOAT_VEC4:return e.setVector4(t,E.Vector4.FromArray(r)),!0;default:return!1}},e.GetWrapMode=function(e){switch(e){case y.CLAMP_TO_EDGE:return I.a.CLAMP_ADDRESSMODE;case y.MIRRORED_REPEAT:return I.a.MIRROR_ADDRESSMODE;case y.REPEAT:default:return I.a.WRAP_ADDRESSMODE}},e.GetByteStrideFromType=function(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}},e.GetTextureFilterMode=function(e){switch(e){case g.LINEAR:case g.LINEAR_MIPMAP_NEAREST:case g.LINEAR_MIPMAP_LINEAR:return I.a.TRILINEAR_SAMPLINGMODE;case g.NEAREST:case g.NEAREST_MIPMAP_NEAREST:return I.a.NEAREST_SAMPLINGMODE;default:return I.a.BILINEAR_SAMPLINGMODE}},e.GetBufferFromBufferView=function(e,t,r,n,a){r=t.byteOffset+r;var o=e.loadedBufferViews[t.buffer];if(r+n>o.byteLength)throw new Error("Buffer access is out of range");var i=o.buffer;switch(r+=o.byteOffset,a){case p.BYTE:return new Int8Array(i,r,n);case p.UNSIGNED_BYTE:return new Uint8Array(i,r,n);case p.SHORT:return new Int16Array(i,r,n);case p.UNSIGNED_SHORT:return new Uint16Array(i,r,n);default:return new Float32Array(i,r,n)}},e.GetBufferFromAccessor=function(t,r){var n=t.bufferViews[r.bufferView],a=r.count*e.GetByteStrideFromType(r);return e.GetBufferFromBufferView(t,n,r.byteOffset,a,r.componentType)},e.DecodeBufferToText=function(e){for(var t="",r=e.byteLength,n=0;n<r;++n)t+=String.fromCharCode(e[n]);return t},e.GetDefaultMaterial=function(t){if(!e._DefaultMaterial){C.a.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),C.a.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join("\n");var r={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array,needAlphaBlending:!1};e._DefaultMaterial=new P.a("GLTFDefaultMaterial",t,{vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},r),e._DefaultMaterial.setColor4("u_emission",new E.Color4(.5,.5,.5,1))}return e._DefaultMaterial},e._DefaultMaterial=null,e}();!function(e){e[e.IDENTIFIER=1]="IDENTIFIER",e[e.UNKNOWN=2]="UNKNOWN",e[e.END_OF_INPUT=3]="END_OF_INPUT"}(T||(T={}));var q=function(){function e(e){this._pos=0,this.currentToken=T.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=e,this._maxPos=e.length}return e.prototype.getNextToken=function(){if(this.isEnd())return T.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=T.UNKNOWN,"_"===this.currentString||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=T.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||"_"===this.currentString);)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken},e.prototype.peek=function(){return this._toParse[this._pos]},e.prototype.read=function(){return this._toParse[this._pos++]},e.prototype.forward=function(){this._pos++},e.prototype.isEnd=function(){return this._pos>=this._maxPos},e}(),Y=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],X=["world","view","projection","worldView","worldViewProjection","mBones"],Z=["translation","rotation","scale"],J=["position","rotationQuaternion","scaling"],$=function(e,t,r){for(var n in e){var a=e[n];r[t][n]=a}},ee=function(e){if(e)for(var t=0;t<e.length/2;t++)e[2*t+1]=1-e[2*t+1]},te=function(e){if("NORMAL"===e.semantic)return"normal";if("POSITION"===e.semantic)return"position";if("JOINT"===e.semantic)return"matricesIndices";if("WEIGHT"===e.semantic)return"matricesWeights";if("COLOR"===e.semantic)return"color";if(e.semantic&&-1!==e.semantic.indexOf("TEXCOORD_")){var t=Number(e.semantic.split("_")[1]);return"uv"+(0===t?"":t+1)}return null},re=function(e){var t=null;if(e.translation||e.rotation||e.scale){var r=E.Vector3.FromArray(e.scale||[1,1,1]),n=E.Quaternion.FromArray(e.rotation||[0,0,0,1]),a=E.Vector3.FromArray(e.translation||[0,0,0]);t=E.Matrix.Compose(r,n,a)}else t=E.Matrix.FromArray(e.matrix);return t},ne=function(e,t,r,n){for(var a=0;a<n.bones.length;a++)if(n.bones[a].name===r)return n.bones[a];var o=e.nodes;for(var i in o){var s=o[i];if(s.jointName){var l=s.children;for(a=0;a<l.length;a++){var u=e.nodes[l[a]];if(u.jointName&&u.jointName===r){var c=re(s),f=new S.a(s.name||"",n,ne(e,t,s.jointName,n),c);return f.id=i,f}}}}return null},ae=function(e,t){for(var r=0;r<e.length;r++)for(var n=e[r],a=0;a<n.node.children.length;a++){if(n.node.children[a]===t)return n.bone}return null},oe=function(e,t){var r=e.nodes,n=r[t];if(n)return{node:n,id:t};for(var a in r)if((n=r[a]).jointName===t)return{node:n,id:a};return null},ie=function(e,t){for(var r=0;r<e.jointNames.length;r++)if(e.jointNames[r]===t)return!0;return!1},se=function(e,t,r,n,a){if(n||(n=new L.a(t.name||"","",e.scene)),!t.babylonSkeleton)return n;var o=[],i=[];!function(e,t,r,n){for(var a in e.nodes){var o=e.nodes[a],i=a;if(o.jointName&&!ie(r,o.jointName)){var s=re(o),l=new S.a(o.name||"",t,null,s);l.id=i,n.push({bone:l,node:o,id:i})}}for(var u=0;u<n.length;u++)for(var c=n[u],f=c.node.children,h=0;h<f.length;h++){for(var d=null,p=0;p<n.length;p++)if(n[p].id===f[h]){d=n[p];break}d&&(d.bone._parent=c.bone,c.bone.children.push(d.bone))}}(e,n,t,o),n.bones=[];for(var s=0;s<t.jointNames.length;s++){if(b=oe(e,t.jointNames[s])){var l=b.node;if(l){a=b.id;var c=e.scene.getBoneByID(a);if(c)n.bones.push(c);else{for(var f=!1,h=null,d=0;d<s;d++){var p=oe(e,t.jointNames[d]);if(p){var m=p.node;if(m){var _=m.children;if(_){f=!1;for(var y=0;y<_.length;y++)if(_[y]===a){h=ne(e,t,t.jointNames[d],n),f=!0;break}if(f)break}}else u.h.Warn("Joint named "+t.jointNames[d]+" does not exist when looking for parent")}}var g=re(l);!h&&o.length>0&&(h=ae(o,a))&&-1===i.indexOf(h)&&i.push(h),new S.a(l.jointName||"",n,h,g).id=a}}else u.h.Warn("Joint named "+t.jointNames[s]+" does not exist")}}var v=n.bones;n.bones=[];for(s=0;s<t.jointNames.length;s++){var b;if(b=oe(e,t.jointNames[s]))for(d=0;d<v.length;d++)if(v[d].id===b.id){n.bones.push(v[d]);break}}n.prepare();for(s=0;s<i.length;s++)n.bones.push(i[s]);return n},le=function(e,t,r,n,a){if(a||((a=new k.a(t.name||"",e.scene)).id=n),!t.babylonNode)return a;for(var o,i=[],s=null,l=new Array,u=new Array,c=new Array,f=new Array,d=0;d<r.length;d++){var p=r[d];if(L=e.meshes[p])for(var m=0;m<L.primitives.length;m++){var _=new V.a,y=L.primitives[m];y.mode;var g=y.attributes,v=null,b=null;for(var A in g)if(v=e.accessors[g[A]],b=Q.GetBufferFromAccessor(e,v),"NORMAL"===A)_.normals=new Float32Array(b.length),_.normals.set(b);else if("POSITION"===A){if(h.HomogeneousCoordinates){_.positions=new Float32Array(b.length-b.length/4);for(var x=0;x<b.length;x+=4)_.positions[x]=b[x],_.positions[x+1]=b[x+1],_.positions[x+2]=b[x+2]}else _.positions=new Float32Array(b.length),_.positions.set(b);u.push(_.positions.length)}else if(-1!==A.indexOf("TEXCOORD_")){var T=Number(A.split("_")[1]),E=D.b.UVKind+(0===T?"":T+1),M=new Float32Array(b.length);M.set(b),ee(M),_.set(M,E)}else"JOINT"===A?(_.matricesIndices=new Float32Array(b.length),_.matricesIndices.set(b)):"WEIGHT"===A?(_.matricesWeights=new Float32Array(b.length),_.matricesWeights.set(b)):"COLOR"===A&&(_.colors=new Float32Array(b.length),_.colors.set(b));if(v=e.accessors[y.indices])b=Q.GetBufferFromAccessor(e,v),_.indices=new Int32Array(b.length),_.indices.set(b),f.push(_.indices.length);else{var O=[];for(x=0;x<_.positions.length/3;x++)O.push(x);_.indices=new Int32Array(O),f.push(_.indices.length)}s?s.merge(_):s=_;var w=e.scene.getMaterialByID(y.material);i.push(null===w?Q.GetDefaultMaterial(e.scene):w),l.push(0===l.length?0:l[l.length-1]+u[u.length-2]),c.push(0===c.length?0:c[c.length-1]+f[f.length-2])}}i.length>1?(o=new N.a("multimat"+n,e.scene)).subMaterials=i:o=new F.StandardMaterial("multimat"+n,e.scene),1===i.length&&(o=i[0]),a.material||(a.material=o),new B.d(n,e.scene,s,!1,a),a.computeWorldMatrix(!0),a.subMeshes=[];var S=0;for(d=0;d<r.length;d++){var L;p=r[d];if(L=e.meshes[p])for(m=0;m<L.primitives.length;m++)L.primitives[m].mode,U.b.AddToMesh(S,l[S],u[S],c[S],f[S],a,a,!0),S++}return a},ue=function(e,t,r,n){e.position&&(e.position=t),(e.rotationQuaternion||e.rotation)&&(e.rotationQuaternion=r),e.scaling&&(e.scaling=n)},ce=function(e,t,r,n){var a=null;if(e.importOnlyMeshes&&(t.skin||t.meshes)&&e.importMeshesNames&&e.importMeshesNames.length>0&&-1===e.importMeshesNames.indexOf(t.name||""))return null;if(t.skin){if(t.meshes){var o=e.skins[t.skin];(i=le(e,t,t.meshes,r,t.babylonNode)).skeleton=e.scene.getLastSkeletonByID(t.skin),null===i.skeleton&&(i.skeleton=se(e,o,0,o.babylonSkeleton,t.skin),o.babylonSkeleton||(o.babylonSkeleton=i.skeleton)),a=i}}else if(t.meshes){var i;a=i=le(e,t,t.mesh?[t.mesh]:t.meshes,r,t.babylonNode)}else if(!t.light||t.babylonNode||e.importOnlyMeshes){if(t.camera&&!t.babylonNode&&!e.importOnlyMeshes){var s=e.cameras[t.camera];if(s)if("orthographic"===s.type){var l=new O.a(t.camera,E.Vector3.Zero(),e.scene,!1);l.name=t.name||"",l.mode=M.a.ORTHOGRAPHIC_CAMERA,l.attachControl(e.scene.getEngine().getRenderingCanvas()),a=l}else if("perspective"===s.type){var u=s[s.type],c=new O.a(t.camera,E.Vector3.Zero(),e.scene,!1);c.name=t.name||"",c.attachControl(e.scene.getEngine().getRenderingCanvas()),u.aspectRatio||(u.aspectRatio=e.scene.getEngine().getRenderWidth()/e.scene.getEngine().getRenderHeight()),u.znear&&u.zfar&&(c.maxZ=u.zfar,c.minZ=u.znear),a=c}}}else{var f=e.lights[t.light];if(f)if("ambient"===f.type){var h=f[f.type],d=new H.HemisphericLight(t.light,E.Vector3.Zero(),e.scene);d.name=t.name||"",h.color&&(d.diffuse=E.Color3.FromArray(h.color)),a=d}else if("directional"===f.type){var p=f[f.type],m=new W.a(t.light,E.Vector3.Zero(),e.scene);m.name=t.name||"",p.color&&(m.diffuse=E.Color3.FromArray(p.color)),a=m}else if("point"===f.type){var _=f[f.type],y=new K.a(t.light,E.Vector3.Zero(),e.scene);y.name=t.name||"",_.color&&(y.diffuse=E.Color3.FromArray(_.color)),a=y}else if("spot"===f.type){var g=f[f.type],v=new j.a(t.light,E.Vector3.Zero(),E.Vector3.Zero(),0,0,e.scene);v.name=t.name||"",g.color&&(v.diffuse=E.Color3.FromArray(g.color)),g.fallOfAngle&&(v.angle=g.fallOfAngle),g.fallOffExponent&&(v.exponent=g.fallOffExponent),a=v}}if(!t.jointName){if(t.babylonNode)return t.babylonNode;if(null===a){var b=new k.a(t.name||"",e.scene);t.babylonNode=b,a=b}}if(null!==a){if(t.matrix&&a instanceof k.a)!function(e,t,r){if(t.matrix){var n=new E.Vector3(0,0,0),a=new E.Quaternion,o=new E.Vector3(0,0,0);E.Matrix.FromArray(t.matrix).decompose(o,a,n),ue(e,n,a,o)}else t.translation&&t.rotation&&t.scale&&ue(e,E.Vector3.FromArray(t.translation),E.Quaternion.FromArray(t.rotation),E.Vector3.FromArray(t.scale));e.computeWorldMatrix(!0)}(a,t);else{var A=t.translation||[0,0,0],x=t.rotation||[0,0,0,1],T=t.scale||[1,1,1];ue(a,E.Vector3.FromArray(A),E.Quaternion.FromArray(x),E.Vector3.FromArray(T))}a.updateCache(!0),t.babylonNode=a}return a},fe=function(e,t,r,n){void 0===n&&(n=!1);var a=e.nodes[t],o=null;if(n=!(e.importOnlyMeshes&&!n&&e.importMeshesNames)||(-1!==e.importMeshesNames.indexOf(a.name||"")||0===e.importMeshesNames.length),!a.jointName&&n&&null!==(o=ce(e,a,t))&&(o.id=t,o.parent=r),a.children)for(var i=0;i<a.children.length;i++)fe(e,a.children[i],o,n)},he=function(e){var t=e.currentScene;if(t)for(var r=0;r<t.nodes.length;r++)fe(e,t.nodes[r],null);else for(var n in e.scenes){t=e.scenes[n];for(r=0;r<t.nodes.length;r++)fe(e,t.nodes[r],null)}!function(e){for(var t in e.animations){var r=e.animations[t];if(r.channels&&r.samplers)for(var n=null,a=0;a<r.channels.length;a++){var o=r.channels[a],i=r.samplers[o.sampler];if(i){var s=null,l=null;r.parameters?(s=r.parameters[i.input],l=r.parameters[i.output]):(s=i.input,l=i.output);var c=Q.GetBufferFromAccessor(e,e.accessors[s]),f=Q.GetBufferFromAccessor(e,e.accessors[l]),h=o.target.id,d=e.scene.getNodeByID(h);if(null===d&&(d=e.scene.getNodeByName(h)),null!==d){var p=d instanceof S.a,m=o.target.path,_=Z.indexOf(m);-1!==_&&(m=J[_]);var y=w.a.ANIMATIONTYPE_MATRIX;p||("rotationQuaternion"===m?(y=w.a.ANIMATIONTYPE_QUATERNION,d.rotationQuaternion=new E.Quaternion):y=w.a.ANIMATIONTYPE_VECTOR3);var g=null,v=[],b=0,A=!1;p&&n&&n.getKeys().length===c.length&&(g=n,A=!0),A||(g=new w.a(t,p?"_matrix":m,1,y,w.a.ANIMATIONLOOPMODE_CYCLE));for(var x=0;x<c.length;x++){var T=null;if("rotationQuaternion"===m?(T=E.Quaternion.FromArray([f[b],f[b+1],f[b+2],f[b+3]]),b+=4):(T=E.Vector3.FromArray([f[b],f[b+1],f[b+2]]),b+=3),p){var M=d,O=E.Vector3.Zero(),L=new E.Quaternion,C=E.Vector3.Zero(),R=M.getBaseMatrix();A&&n&&(R=n.getKeys()[x].value),R.decompose(C,L,O),"position"===m?O=T:"rotationQuaternion"===m?L=T:C=T,T=E.Matrix.Compose(C,L,O)}A?n&&(n.getKeys()[x].value=T):v.push({frame:c[x],value:T})}!A&&g&&(g.setKeys(v),d.animations.push(g)),n=g,e.scene.stopAnimation(d),e.scene.beginAnimation(d,0,c[c.length-1],!0,1)}else u.h.Warn("Creating animation named "+t+". But cannot find node named "+h+" to attach to")}}}}(e);for(r=0;r<e.scene.skeletons.length;r++){var a=e.scene.skeletons[r];e.scene.beginAnimation(a,0,Number.MAX_VALUE,!0,1)}},de=function(e,t,r,n,a,o){return function(i){!function(e,t,r,n,a){var o=n.values||r.parameters,i=r.uniforms;for(var s in a){var l=a[s],u=l.type,c=o[i[s]];if(void 0===c&&(c=l.value),c){var f=function(e){return function(r){l.value&&e&&(t.setTexture(e,r),delete a[e])}};u===_.SAMPLER_2D?ge.LoadTextureAsync(e,n.values?c:l.value,f(s),function(){return f(null)}):l.value&&Q.SetUniform(t,s,n.values?c:l.value,u)&&delete a[s]}}}(e,t,r,n,a),t.onBind=function(i){!function(e,t,r,n,a,o,i){var s=o.values||a.parameters;for(var l in r){var u=r[l],c=u.type;if(c===_.FLOAT_MAT2||c===_.FLOAT_MAT3||c===_.FLOAT_MAT4)if(!u.semantic||u.source||u.node){if(u.semantic&&(u.source||u.node)){var f=t.scene.getNodeByName(u.source||u.node||"");if(null===f&&(f=t.scene.getNodeByID(u.source||u.node||"")),null===f)continue;Q.SetMatrix(t.scene,f,u,l,n.getEffect())}}else Q.SetMatrix(t.scene,e,u,l,n.getEffect());else{var h=s[a.uniforms[l]];if(!h)continue;if(c===_.SAMPLER_2D){var d=t.textures[o.values?h:u.value].babylonTexture;if(null==d)continue;n.getEffect().setTexture(l,d)}else Q.SetUniform(n.getEffect(),l,h,c)}}i(n)}(i,e,a,t,r,n,o)}}},pe=function(e,t,r){for(var n in t.uniforms){var a=t.uniforms[n],o=t.parameters[a];if(e.currentIdentifier===n&&o.semantic&&!o.source&&!o.node){var i=Y.indexOf(o.semantic);if(-1!==i)return delete r[n],X[i]}}return e.currentIdentifier},me=function(e){for(var t in e.materials)ge.LoadMaterialAsync(e,t,function(e){},function(){})},_e=function(){function e(){}return e.CreateRuntime=function(e,t,r){var n={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:t,rootUrl:r,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[]};return e.extensions&&$(e.extensions,"extensions",n),e.extensionsUsed&&$(e.extensionsUsed,"extensionsUsed",n),e.buffers&&function(e,t){for(var r in e){var n=e[r];t.buffers[r]=n,t.buffersCount++}}(e.buffers,n),e.bufferViews&&$(e.bufferViews,"bufferViews",n),e.accessors&&$(e.accessors,"accessors",n),e.meshes&&$(e.meshes,"meshes",n),e.lights&&$(e.lights,"lights",n),e.cameras&&$(e.cameras,"cameras",n),e.nodes&&$(e.nodes,"nodes",n),e.images&&$(e.images,"images",n),e.textures&&$(e.textures,"textures",n),e.shaders&&function(e,t){for(var r in e){var n=e[r];t.shaders[r]=n,t.shaderscount++}}(e.shaders,n),e.programs&&$(e.programs,"programs",n),e.samplers&&$(e.samplers,"samplers",n),e.techniques&&$(e.techniques,"techniques",n),e.materials&&$(e.materials,"materials",n),e.animations&&$(e.animations,"animations",n),e.skins&&$(e.skins,"skins",n),e.scenes&&(n.scenes=e.scenes),e.scene&&e.scenes&&(n.currentScene=e.scenes[e.scene]),n},e.LoadBufferAsync=function(e,t,r,n,a){var o=e.buffers[t];u.h.IsBase64(o.uri)?setTimeout(function(){return r(new Uint8Array(u.h.DecodeBase64(o.uri)))}):u.h.LoadFile(e.rootUrl+o.uri,function(e){return r(new Uint8Array(e))},a,void 0,!0,function(e){e&&n(e.status+" "+e.statusText)})},e.LoadTextureBufferAsync=function(e,t,r,n){var a=e.textures[t];if(a&&a.source)if(a.babylonTexture)r(null);else{var o=e.images[a.source];u.h.IsBase64(o.uri)?setTimeout(function(){return r(new Uint8Array(u.h.DecodeBase64(o.uri)))}):u.h.LoadFile(e.rootUrl+o.uri,function(e){return r(new Uint8Array(e))},void 0,void 0,!0,function(e){e&&n(e.status+" "+e.statusText)})}else n("")},e.CreateTextureAsync=function(e,t,r,n,a){var o=e.textures[t];if(o.babylonTexture)n(o.babylonTexture);else{var i=e.samplers[o.sampler],s=i.minFilter===g.NEAREST_MIPMAP_NEAREST||i.minFilter===g.NEAREST_MIPMAP_LINEAR||i.minFilter===g.LINEAR_MIPMAP_NEAREST||i.minFilter===g.LINEAR_MIPMAP_LINEAR,l=I.a.BILINEAR_SAMPLINGMODE,u=null==r?new Blob:new Blob([r]),c=URL.createObjectURL(u),f=function(){return URL.revokeObjectURL(c)},h=new I.a(c,e.scene,!s,!0,l,f,f);void 0!==i.wrapS&&(h.wrapU=Q.GetWrapMode(i.wrapS)),void 0!==i.wrapT&&(h.wrapV=Q.GetWrapMode(i.wrapT)),h.name=t,o.babylonTexture=h,n(h)}},e.LoadShaderStringAsync=function(e,t,r,n){var a=e.shaders[t];if(u.h.IsBase64(a.uri)){var o=atob(a.uri.split(",")[1]);r&&r(o)}else u.h.LoadFile(e.rootUrl+a.uri,r,void 0,void 0,!1,function(e){e&&n&&n(e.status+" "+e.statusText)})},e.LoadMaterialAsync=function(e,t,r,n){var a=e.materials[t];if(a.technique){var o=e.techniques[a.technique];if(!o){var i=new F.StandardMaterial(t,e.scene);return i.diffuseColor=new E.Color3(.5,.5,.5),i.sideOrientation=R.a.CounterClockWiseSideOrientation,void r(i)}var s=e.programs[o.program],l=o.states,u=C.a.ShadersStore[s.vertexShader+"VertexShader"],c=C.a.ShadersStore[s.fragmentShader+"PixelShader"],f="",h="",d=new q(u),p=new q(c),m={},y=[],g=[],v=[];for(var x in o.uniforms){var M=o.uniforms[x],O=o.parameters[M];if(m[x]=O,!O.semantic||O.node||O.source)O.type===_.SAMPLER_2D?v.push(x):y.push(x);else{var w=Y.indexOf(O.semantic);-1!==w?(y.push(X[w]),delete m[x]):y.push(x)}}for(var S in o.attributes){var L=o.attributes[S];if((V=o.parameters[L]).semantic){var N=te(V);N&&g.push(N)}}for(;!d.isEnd()&&d.getNextToken();){if(d.currentToken===T.IDENTIFIER){var I=!1;for(var S in o.attributes){L=o.attributes[S];var V=o.parameters[L];if(d.currentIdentifier===S&&V.semantic){f+=te(V),I=!0;break}}I||(f+=pe(d,o,m))}else f+=d.currentString}for(;!p.isEnd()&&p.getNextToken();){p.currentToken===T.IDENTIFIER?h+=pe(p,o,m):h+=p.currentString}var D={vertex:s.vertexShader+t,fragment:s.fragmentShader+t},B={attributes:g,uniforms:y,samplers:v,needAlphaBlending:l&&l.enable&&-1!==l.enable.indexOf(3042)};C.a.ShadersStore[s.vertexShader+t+"VertexShader"]=f,C.a.ShadersStore[s.fragmentShader+t+"PixelShader"]=h;var U=new P.a(t,e.scene,D,B);if(U.onError=function(e,t,r){return function(n,a){t.dispose(!0),r("Cannot compile program named "+e.name+". Error: "+a+". Default material will be applied")}}(s,U,n),U.onCompiled=de(e,U,o,a,m,r),U.sideOrientation=R.a.CounterClockWiseSideOrientation,l&&l.functions){var G=l.functions;G.cullFace&&G.cullFace[0]!==b.BACK&&(U.backFaceCulling=!1);var k=G.blendFuncSeparate;k&&(k[0]===A.SRC_ALPHA&&k[1]===A.ONE_MINUS_SRC_ALPHA&&k[2]===A.ONE&&k[3]===A.ONE?U.alphaMode=z.Engine.ALPHA_COMBINE:k[0]===A.ONE&&k[1]===A.ONE&&k[2]===A.ZERO&&k[3]===A.ONE?U.alphaMode=z.Engine.ALPHA_ONEONE:k[0]===A.SRC_ALPHA&&k[1]===A.ONE&&k[2]===A.ZERO&&k[3]===A.ONE?U.alphaMode=z.Engine.ALPHA_ADD:k[0]===A.ZERO&&k[1]===A.ONE_MINUS_SRC_COLOR&&k[2]===A.ONE&&k[3]===A.ONE?U.alphaMode=z.Engine.ALPHA_SUBTRACT:k[0]===A.DST_COLOR&&k[1]===A.ZERO&&k[2]===A.ONE&&k[3]===A.ONE?U.alphaMode=z.Engine.ALPHA_MULTIPLY:k[0]===A.SRC_ALPHA&&k[1]===A.ONE_MINUS_SRC_COLOR&&k[2]===A.ONE&&k[3]===A.ONE&&(U.alphaMode=z.Engine.ALPHA_MAXIMIZED))}}else n&&n("No technique found.")},e}(),ye=function(){function e(){this.state=null}return e.RegisterExtension=function(t){e.Extensions[t.name]?u.h.Error('Tool with the same name "'+t.name+'" already exists'):e.Extensions[t.name]=t},e.prototype.dispose=function(){},e.prototype._importMeshAsync=function(e,t,r,n,a,o,i){var s=this;return t.useRightHandedSystem=!0,ge.LoadRuntimeAsync(t,r,n,function(t){t.importOnlyMeshes=!0,""===e?t.importMeshesNames=[]:"string"==typeof e?t.importMeshesNames=[e]:!e||e instanceof Array?(t.importMeshesNames=[],u.h.Warn("Argument meshesNames must be of type string or string[]")):t.importMeshesNames=[e],s._createNodes(t);var r=new Array,n=new Array;for(var i in t.nodes){var l=t.nodes[i];l.babylonNode instanceof G.a&&r.push(l.babylonNode)}for(var c in t.skins){var f=t.skins[c];f.babylonSkeleton instanceof L.a&&n.push(f.babylonSkeleton)}s._loadBuffersAsync(t,function(){s._loadShadersAsync(t,function(){me(t),he(t),!h.IncrementalLoading&&a&&a(r,n)})},o),h.IncrementalLoading&&a&&a(r,n)},i),!0},e.prototype.importMeshAsync=function(e,t,r,n,a){var o=this;return new Promise(function(i,s){o._importMeshAsync(e,t,r,n,function(e,t){i({meshes:e,particleSystems:[],skeletons:t,animationGroups:[]})},a,function(e){s(new Error(e))})})},e.prototype._loadAsync=function(e,t,r,n,a,o){var i=this;e.useRightHandedSystem=!0,ge.LoadRuntimeAsync(e,t,r,function(e){ge.LoadRuntimeExtensionsAsync(e,function(){i._createNodes(e),i._loadBuffersAsync(e,function(){i._loadShadersAsync(e,function(){me(e),he(e),h.IncrementalLoading||n()})}),h.IncrementalLoading&&n()},o)},o)},e.prototype.loadAsync=function(e,t,r,n){var a=this;return new Promise(function(o,i){a._loadAsync(e,t,r,function(){o()},n,function(e){i(new Error(e))})})},e.prototype._loadShadersAsync=function(e,t){var r=!1,n=function(r,n){ge.LoadShaderStringAsync(e,r,function(a){a instanceof ArrayBuffer||(e.loadedShaderCount++,a&&(C.a.ShadersStore[r+(n.type===m.VERTEX?"VertexShader":"PixelShader")]=a),e.loadedShaderCount===e.shaderscount&&t())},function(){u.h.Error("Error when loading shader program named "+r+" located at "+n.uri)})};for(var a in e.shaders){r=!0;var o=e.shaders[a];o?n.bind(this,a,o)():u.h.Error("No shader named: "+a)}r||t()},e.prototype._loadBuffersAsync=function(e,t,r){var n=!1,a=function(r,n){ge.LoadBufferAsync(e,r,function(a){e.loadedBufferCount++,a&&(a.byteLength!=e.buffers[r].byteLength&&u.h.Error("Buffer named "+r+" is length "+a.byteLength+". Expected: "+n.byteLength),e.loadedBufferViews[r]=a),e.loadedBufferCount===e.buffersCount&&t()},function(){u.h.Error("Error when loading buffer named "+r+" located at "+n.uri)})};for(var o in e.buffers){n=!0;var i=e.buffers[o];i?a.bind(this,o,i)():u.h.Error("No buffer named: "+o)}n||t()},e.prototype._createNodes=function(e){var t=e.currentScene;if(t)for(var r=0;r<t.nodes.length;r++)fe(e,t.nodes[r],null);else for(var n in e.scenes){t=e.scenes[n];for(r=0;r<t.nodes.length;r++)fe(e,t.nodes[r],null)}},e.Extensions={},e}(),ge=function(){function e(e){this._name=e}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.loadRuntimeAsync=function(e,t,r,n,a){return!1},e.prototype.loadRuntimeExtensionsAsync=function(e,t,r){return!1},e.prototype.loadBufferAsync=function(e,t,r,n,a){return!1},e.prototype.loadTextureBufferAsync=function(e,t,r,n){return!1},e.prototype.createTextureAsync=function(e,t,r,n,a){return!1},e.prototype.loadShaderStringAsync=function(e,t,r,n){return!1},e.prototype.loadMaterialAsync=function(e,t,r,n){return!1},e.LoadRuntimeAsync=function(t,r,n,a,o){e.ApplyExtensions(function(e){return e.loadRuntimeAsync(t,r,n,a,o)},function(){setTimeout(function(){a&&a(_e.CreateRuntime(r.json,t,n))})})},e.LoadRuntimeExtensionsAsync=function(t,r,n){e.ApplyExtensions(function(e){return e.loadRuntimeExtensionsAsync(t,r,n)},function(){setTimeout(function(){r()})})},e.LoadBufferAsync=function(t,r,n,a,o){e.ApplyExtensions(function(e){return e.loadBufferAsync(t,r,n,a,o)},function(){_e.LoadBufferAsync(t,r,n,a,o)})},e.LoadTextureAsync=function(t,r,n,a){e.LoadTextureBufferAsync(t,r,function(o){o&&e.CreateTextureAsync(t,r,o,n,a)},a)},e.LoadShaderStringAsync=function(t,r,n,a){e.ApplyExtensions(function(e){return e.loadShaderStringAsync(t,r,n,a)},function(){_e.LoadShaderStringAsync(t,r,n,a)})},e.LoadMaterialAsync=function(t,r,n,a){e.ApplyExtensions(function(e){return e.loadMaterialAsync(t,r,n,a)},function(){_e.LoadMaterialAsync(t,r,n,a)})},e.LoadTextureBufferAsync=function(t,r,n,a){e.ApplyExtensions(function(e){return e.loadTextureBufferAsync(t,r,n,a)},function(){_e.LoadTextureBufferAsync(t,r,n,a)})},e.CreateTextureAsync=function(t,r,n,a,o){e.ApplyExtensions(function(e){return e.createTextureAsync(t,r,n,a,o)},function(){_e.CreateTextureAsync(t,r,n,a,o)})},e.ApplyExtensions=function(e,t){for(var r in ye.Extensions){if(e(ye.Extensions[r]))return}t()},e}();h._CreateGLTF1Loader=function(){return new ye};var ve=function(e){function t(){return e.call(this,"KHR_binary_glTF")||this}return x.d(t,e),t.prototype.loadRuntimeAsync=function(e,t,r,n,a){var o=t.json.extensionsUsed;return!(!o||-1===o.indexOf(this.name)||!t.bin)&&(this._bin=t.bin,n(_e.CreateRuntime(t.json,e,r)),!0)},t.prototype.loadBufferAsync=function(e,t,r,n){return-1!==e.extensionsUsed.indexOf(this.name)&&("binary_glTF"===t&&(r(this._bin),!0))},t.prototype.loadTextureBufferAsync=function(e,t,r,n){var a=e.textures[t],o=e.images[a.source];if(!(o.extensions&&this.name in o.extensions))return!1;var i=o.extensions[this.name],s=e.bufferViews[i.bufferView];return r(Q.GetBufferFromBufferView(e,s,0,s.byteLength,p.UNSIGNED_BYTE)),!0},t.prototype.loadShaderStringAsync=function(e,t,r,n){var a=e.shaders[t];if(!(a.extensions&&this.name in a.extensions))return!1;var o=a.extensions[this.name],i=e.bufferViews[o.bufferView],s=Q.GetBufferFromBufferView(e,i,0,i.byteLength,p.UNSIGNED_BYTE);return setTimeout(function(){var e=Q.DecodeBufferToText(s);r(e)}),!0},t}(ge);ye.RegisterExtension(new ve);var be=function(e){function t(){return e.call(this,"KHR_materials_common")||this}return x.d(t,e),t.prototype.loadRuntimeExtensionsAsync=function(e,t,r){if(!e.extensions)return!1;var n=e.extensions[this.name];if(!n)return!1;var a=n.lights;if(a)for(var o in a){var i=a[o];switch(i.type){case"ambient":var s=new H.HemisphericLight(i.name,new E.Vector3(0,1,0),e.scene),l=i.ambient;l&&(s.diffuse=E.Color3.FromArray(l.color||[1,1,1]));break;case"point":var c=new K.a(i.name,new E.Vector3(10,10,10),e.scene),f=i.point;f&&(c.diffuse=E.Color3.FromArray(f.color||[1,1,1]));break;case"directional":var h=new W.a(i.name,new E.Vector3(0,-1,0),e.scene),d=i.directional;d&&(h.diffuse=E.Color3.FromArray(d.color||[1,1,1]));break;case"spot":var p=i.spot;if(p)new j.a(i.name,new E.Vector3(0,10,0),new E.Vector3(0,-1,0),p.fallOffAngle||Math.PI,p.fallOffExponent||0,e.scene).diffuse=E.Color3.FromArray(p.color||[1,1,1]);break;default:u.h.Warn('GLTF Material Common extension: light type "'+i.type+"â€ not supported")}}return!1},t.prototype.loadMaterialAsync=function(e,t,r,n){var a=e.materials[t];if(!a||!a.extensions)return!1;var o=a.extensions[this.name];if(!o)return!1;var i=new F.StandardMaterial(t,e.scene);return i.sideOrientation=R.a.CounterClockWiseSideOrientation,"CONSTANT"===o.technique&&(i.disableLighting=!0),i.backFaceCulling=void 0!==o.doubleSided&&!o.doubleSided,i.alpha=void 0===o.values.transparency?1:o.values.transparency,i.specularPower=void 0===o.values.shininess?0:o.values.shininess,"string"==typeof o.values.ambient?this._loadTexture(e,o.values.ambient,i,"ambientTexture",n):i.ambientColor=E.Color3.FromArray(o.values.ambient||[0,0,0]),"string"==typeof o.values.diffuse?this._loadTexture(e,o.values.diffuse,i,"diffuseTexture",n):i.diffuseColor=E.Color3.FromArray(o.values.diffuse||[0,0,0]),"string"==typeof o.values.emission?this._loadTexture(e,o.values.emission,i,"emissiveTexture",n):i.emissiveColor=E.Color3.FromArray(o.values.emission||[0,0,0]),"string"==typeof o.values.specular?this._loadTexture(e,o.values.specular,i,"specularTexture",n):i.specularColor=E.Color3.FromArray(o.values.specular||[0,0,0]),!0},t.prototype._loadTexture=function(e,t,r,n,a){_e.LoadTextureBufferAsync(e,t,function(o){_e.CreateTextureAsync(e,t,o,function(e){return r[n]=e},a)},a)},t}(ge);ye.RegisterExtension(new be);var Ae=r(113),xe=r(126),Te=r(54),Ee=r(49),Me=r(136),Oe=r(118),we=function(){function e(){}return e.Get=function(e,t,r){if(!t||null==r||!t[r])throw new Error(e+": Failed to find index ("+r+")");return t[r]},e.Assign=function(e){if(e)for(var t=0;t<e.length;t++)e[t].index=t},e}(),Se=function(){function e(e){this._completePromises=new Array,this._disposed=!1,this._state=null,this._extensions={},this._defaultBabylonMaterialData={},this._requests=new Array,this._parent=e}return e.RegisterExtension=function(t,r){e.UnregisterExtension(t)&&u.h.Warn("Extension with the name '"+t+"' already exists"),e._ExtensionFactories[t]=r,e._ExtensionNames.push(t)},e.UnregisterExtension=function(t){if(!e._ExtensionFactories[t])return!1;delete e._ExtensionFactories[t];var r=e._ExtensionNames.indexOf(t);return-1!==r&&e._ExtensionNames.splice(r,1),!0},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(!this._disposed){this._disposed=!0;for(var e=0,t=this._requests;e<t.length;e++){t[e].abort()}for(var r in this._requests.length=0,delete this.gltf,delete this.babylonScene,this._completePromises.length=0,this._extensions){this._extensions[r].dispose&&this._extensions[r].dispose()}this._extensions={},delete this._rootBabylonMesh,delete this._progressCallback,this._parent._clear()}},e.prototype.importMeshAsync=function(e,t,r,n,a,o){var i=this;return Promise.resolve().then(function(){i.babylonScene=t,i._rootUrl=n,i._fileName=o||"scene",i._progressCallback=a,i._loadData(r);var s=null;if(e){var l={};if(i.gltf.nodes)for(var u=0,c=i.gltf.nodes;u<c.length;u++){var f=c[u];f.name&&(l[f.name]=f.index)}s=(e instanceof Array?e:[e]).map(function(e){var t=l[e];if(void 0===t)throw new Error("Failed to find node '"+e+"'");return t})}return i._loadAsync(s,function(){return{meshes:i._getMeshes(),particleSystems:[],skeletons:i._getSkeletons(),animationGroups:i._getAnimationGroups()}})})},e.prototype.loadAsync=function(e,t,r,n,a){var o=this;return Promise.resolve().then(function(){return o.babylonScene=e,o._rootUrl=r,o._fileName=a||"scene",o._progressCallback=n,o._loadData(t),o._loadAsync(null,function(){})})},e.prototype._loadAsync=function(e,t){var r=this;return Promise.resolve().then(function(){r._uniqueRootUrl=-1===r._rootUrl.indexOf("file:")&&r._fileName?r._rootUrl:""+r._rootUrl+Date.now()+"/",r._loadExtensions(),r._checkExtensions();var n=s[s.LOADING]+" => "+s[s.READY],a=s[s.LOADING]+" => "+s[s.COMPLETE];r._parent._startPerformanceCounter(n),r._parent._startPerformanceCounter(a),r._setState(s.LOADING),r._extensionsOnLoading();var o=new Array;if(e)o.push(r.loadSceneAsync("/nodes",{nodes:e,index:-1}));else{var i=we.Get("/scene",r.gltf.scenes,r.gltf.scene||0);o.push(r.loadSceneAsync("/scenes/"+i.index,i))}r._parent.compileMaterials&&o.push(r._compileMaterialsAsync()),r._parent.compileShadowGenerators&&o.push(r._compileShadowGeneratorsAsync());var l=Promise.all(o).then(function(){return r._rootBabylonMesh&&r._rootBabylonMesh.setEnabled(!0),r._setState(s.READY),r._extensionsOnReady(),r._startAnimations(),t()});return l.then(function(){r._parent._endPerformanceCounter(n),u.h.SetImmediate(function(){r._disposed||Promise.all(r._completePromises).then(function(){r._parent._endPerformanceCounter(a),r._setState(s.COMPLETE),r._parent.onCompleteObservable.notifyObservers(void 0),r._parent.onCompleteObservable.clear(),r.dispose()},function(e){r._parent.onErrorObservable.notifyObservers(e),r._parent.onErrorObservable.clear(),r.dispose()})})}),l},function(e){throw r._disposed||(r._parent.onErrorObservable.notifyObservers(e),r._parent.onErrorObservable.clear(),r.dispose()),e})},e.prototype._loadData=function(e){if(this.gltf=e.json,this._setupData(),e.bin){var t=this.gltf.buffers;if(t&&t[0]&&!t[0].uri){var r=t[0];(r.byteLength<e.bin.byteLength-3||r.byteLength>e.bin.byteLength)&&u.h.Warn("Binary buffer length ("+r.byteLength+") from JSON does not match chunk length ("+e.bin.byteLength+")"),r._data=Promise.resolve(e.bin)}else u.h.Warn("Unexpected BIN chunk")}},e.prototype._setupData=function(){if(we.Assign(this.gltf.accessors),we.Assign(this.gltf.animations),we.Assign(this.gltf.buffers),we.Assign(this.gltf.bufferViews),we.Assign(this.gltf.cameras),we.Assign(this.gltf.images),we.Assign(this.gltf.materials),we.Assign(this.gltf.meshes),we.Assign(this.gltf.nodes),we.Assign(this.gltf.samplers),we.Assign(this.gltf.scenes),we.Assign(this.gltf.skins),we.Assign(this.gltf.textures),this.gltf.nodes){for(var e={},t=0,r=this.gltf.nodes;t<r.length;t++){if((l=r[t]).children)for(var n=0,a=l.children;n<a.length;n++){e[a[n]]=l.index}}for(var o=this._createRootNode(),i=0,s=this.gltf.nodes;i<s.length;i++){var l,u=e[(l=s[i]).index];l.parent=void 0===u?o:this.gltf.nodes[u]}}},e.prototype._loadExtensions=function(){for(var t=0,r=e._ExtensionNames;t<r.length;t++){var n=r[t],a=e._ExtensionFactories[n](this);this._extensions[n]=a,this._parent.onExtensionLoadedObservable.notifyObservers(a)}this._parent.onExtensionLoadedObservable.clear()},e.prototype._checkExtensions=function(){if(this.gltf.extensionsRequired)for(var e=0,t=this.gltf.extensionsRequired;e<t.length;e++){var r=t[e],n=this._extensions[r];if(!n||!n.enabled)throw new Error("Require extension "+r+" is not available")}},e.prototype._setState=function(e){this._state=e,this.log(s[this._state])},e.prototype._createRootNode=function(){this._rootBabylonMesh=new k.a("__root__",this.babylonScene),this._rootBabylonMesh.setEnabled(!1);var t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case o.AUTO:this.babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],e._LoadTransform(t,this._rootBabylonMesh));break;case o.FORCE_RIGHT_HANDED:this.babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode ("+this._parent.coordinateSystemMode+")")}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),t},e.prototype.loadSceneAsync=function(e,t){var r=this,n=this._extensionsLoadSceneAsync(e,t);if(n)return n;var a=new Array;if(this.logOpen(e+" "+(t.name||"")),t.nodes)for(var o=0,i=t.nodes;o<i.length;o++){var s=i[o],l=we.Get(e+"/nodes/"+s,this.gltf.nodes,s);a.push(this.loadNodeAsync("/nodes/"+l.index,l,function(e){e.parent=r._rootBabylonMesh}))}if(this.gltf.nodes)for(var u=0,c=this.gltf.nodes;u<c.length;u++){if((l=c[u])._babylonTransformNode&&l._babylonBones)for(var f=0,h=l._babylonBones;f<h.length;f++){h[f].linkTransformNode(l._babylonTransformNode)}}return a.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(a).then(function(){})},e.prototype._forEachPrimitive=function(e,t){if(e._primitiveBabylonMeshes)for(var r=0,n=e._primitiveBabylonMeshes;r<n.length;r++){t(n[r])}},e.prototype._getMeshes=function(){var e=new Array;e.push(this._rootBabylonMesh);var t=this.gltf.nodes;if(t)for(var r=0,n=t;r<n.length;r++){var a=n[r];this._forEachPrimitive(a,function(t){e.push(t)})}return e},e.prototype._getSkeletons=function(){var e=new Array,t=this.gltf.skins;if(t)for(var r=0,n=t;r<n.length;r++){var a=n[r];a._data&&e.push(a._data.babylonSkeleton)}return e},e.prototype._getAnimationGroups=function(){var e=new Array,t=this.gltf.animations;if(t)for(var r=0,n=t;r<n.length;r++){var a=n[r];a._babylonAnimationGroup&&e.push(a._babylonAnimationGroup)}return e},e.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case i.NONE:break;case i.FIRST:0!==(e=this._getAnimationGroups()).length&&e[0].start(!0);break;case i.ALL:for(var e,t=0,r=e=this._getAnimationGroups();t<r.length;t++){r[t].start(!0)}break;default:return void u.h.Error("Invalid animation start mode ("+this._parent.animationStartMode+")")}},e.prototype.loadNodeAsync=function(t,r,n){var a=this;void 0===n&&(n=function(){});var o=this._extensionsLoadNodeAsync(t,r,n);if(o)return o;if(r._babylonTransformNode)throw new Error(t+": Invalid recursive node hierarchy");var i=new Array;this.logOpen(t+" "+(r.name||""));var s=function(o){if(e.AddPointerMetadata(o,t),e._LoadTransform(r,o),null!=r.camera){var s=we.Get(t+"/camera",a.gltf.cameras,r.camera);i.push(a.loadCameraAsync("/cameras/"+s.index,s,function(e){e.parent=o}))}if(r.children)for(var l=0,u=r.children;l<u.length;l++){var c=u[l],f=we.Get(t+"/children/"+c,a.gltf.nodes,c);i.push(a.loadNodeAsync("/nodes/"+f.index,f,function(e){e.parent=o}))}n(o)};if(null==r.mesh){var l=r.name||"node"+r.index;r._babylonTransformNode=new Ee.a(l,this.babylonScene),s(r._babylonTransformNode)}else{var u=we.Get(t+"/mesh",this.gltf.meshes,r.mesh);i.push(this._loadMeshAsync("/meshes/"+u.index,r,u,s))}return this.logClose(),Promise.all(i).then(function(){return a._forEachPrimitive(r,function(e){e.refreshBoundingInfo(!0)}),r._babylonTransformNode})},e.prototype._loadMeshAsync=function(e,t,r,n){var a=r.primitives;if(!a||!a.length)throw new Error(e+": Primitives are missing");null==a[0].index&&we.Assign(a);var o=new Array;this.logOpen(e+" "+(r.name||""));var i=t.name||"node"+t.index;if(1===a.length){var s=r.primitives[0];o.push(this._loadMeshPrimitiveAsync(e+"/primitives/"+s.index,i,t,r,s,function(e){t._babylonTransformNode=e,t._primitiveBabylonMeshes=[e]}))}else{t._babylonTransformNode=new Ee.a(i,this.babylonScene),t._primitiveBabylonMeshes=[];for(var l=0,u=a;l<u.length;l++){s=u[l];o.push(this._loadMeshPrimitiveAsync(e+"/primitives/"+s.index,i+"_primitive"+s.index,t,r,s,function(e){e.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(e)}))}}if(null!=t.skin){var c=we.Get(e+"/skin",this.gltf.skins,t.skin);o.push(this._loadSkinAsync("/skins/"+c.index,t,c))}return n(t._babylonTransformNode),this.logClose(),Promise.all(o).then(function(){return t._babylonTransformNode})},e.prototype._loadMeshPrimitiveAsync=function(t,r,n,a,o,i){var s=this;this.logOpen(""+t);var l,u,c=null==n.skin&&!a.primitives[0].targets,f=o._instanceData;if(c&&f)l=f.babylonSourceMesh.createInstance(r),u=f.promise;else{var h=new Array,d=new k.a(r,this.babylonScene);this._createMorphTargets(t,n,a,o,d),h.push(this._loadVertexDataAsync(t,o,d).then(function(e){return s._loadMorphTargetsAsync(t,o,d,e).then(function(){e.applyToMesh(d)})}));var p=e._GetDrawMode(t,o.mode);if(null==o.material){var m=this._defaultBabylonMaterialData[p];m||(m=this._createDefaultMaterial("__GLTFLoader._default",p),this._parent.onMaterialLoadedObservable.notifyObservers(m),this._defaultBabylonMaterialData[p]=m),d.material=m}else{var _=we.Get(t+"/material",this.gltf.materials,o.material);h.push(this._loadMaterialAsync("/materials/"+_.index,_,d,p,function(e){d.material=e}))}u=Promise.all(h),c&&(o._instanceData={babylonSourceMesh:d,promise:u}),l=d}return e.AddPointerMetadata(l,t),this._parent.onMeshLoadedObservable.notifyObservers(l),i(l),this.logClose(),u.then(function(){return l})},e.prototype._loadVertexDataAsync=function(e,t,r){var n=this,a=this._extensionsLoadVertexDataAsync(e,t,r);if(a)return a;var o=t.attributes;if(!o)throw new Error(e+": Attributes are missing");var i=new Array,s=new B.d(r.name,this.babylonScene);if(null==t.indices)r.isUnIndexed=!0;else{var l=we.Get(e+"/indices",this.gltf.accessors,t.indices);i.push(this._loadIndicesAccessorAsync("/accessors/"+l.index,l).then(function(e){s.setIndices(e)}))}var u=function(t,a,l){if(null!=o[t]){r._delayInfo=r._delayInfo||[],-1===r._delayInfo.indexOf(a)&&r._delayInfo.push(a);var u=we.Get(e+"/attributes/"+t,n.gltf.accessors,o[t]);i.push(n._loadVertexAccessorAsync("/accessors/"+u.index,u,a).then(function(e){s.setVerticesBuffer(e,u.count)})),l&&l(u)}};return u("POSITION",D.b.PositionKind),u("NORMAL",D.b.NormalKind),u("TANGENT",D.b.TangentKind),u("TEXCOORD_0",D.b.UVKind),u("TEXCOORD_1",D.b.UV2Kind),u("JOINTS_0",D.b.MatricesIndicesKind),u("WEIGHTS_0",D.b.MatricesWeightsKind),u("COLOR_0",D.b.ColorKind,function(e){"VEC4"===e.type&&(r.hasVertexAlpha=!0)}),Promise.all(i).then(function(){return s})},e.prototype._createMorphTargets=function(e,t,r,n,a){if(n.targets){if(null==t._numMorphTargets)t._numMorphTargets=n.targets.length;else if(n.targets.length!==t._numMorphTargets)throw new Error(e+": Primitives do not have the same number of targets");a.morphTargetManager=new Oe.a;for(var o=0;o<n.targets.length;o++){var i=t.weights?t.weights[o]:r.weights?r.weights[o]:0;a.morphTargetManager.addTarget(new Me.a("morphTarget"+o,i))}}},e.prototype._loadMorphTargetsAsync=function(e,t,r,n){if(!t.targets)return Promise.resolve();for(var a=new Array,o=r.morphTargetManager,i=0;i<o.numTargets;i++){var s=o.getTarget(i);a.push(this._loadMorphTargetVertexDataAsync(e+"/targets/"+i,n,t.targets[i],s))}return Promise.all(a).then(function(){})},e.prototype._loadMorphTargetVertexDataAsync=function(e,t,r,n){var a=this,o=new Array,i=function(n,i,s){if(null!=r[n]){var l=t.getVertexBuffer(i);if(l){var u=we.Get(e+"/"+n,a.gltf.accessors,r[n]);o.push(a._loadFloatAccessorAsync("/accessors/"+u.index,u).then(function(e){s(l,e)}))}}};return i("POSITION",D.b.PositionKind,function(e,t){e.forEach(t.length,function(e,r){t[r]+=e}),n.setPositions(t)}),i("NORMAL",D.b.NormalKind,function(e,t){e.forEach(t.length,function(e,r){t[r]+=e}),n.setNormals(t)}),i("TANGENT",D.b.TangentKind,function(e,t){var r=0;e.forEach(t.length/3*4,function(e,n){(n+1)%4!=0&&(t[r++]+=e)}),n.setTangents(t)}),Promise.all(o).then(function(){})},e._LoadTransform=function(e,t){if(null==e.skin){var r=E.Vector3.Zero(),n=E.Quaternion.Identity(),a=E.Vector3.One();if(e.matrix)E.Matrix.FromArray(e.matrix).decompose(a,n,r);else e.translation&&(r=E.Vector3.FromArray(e.translation)),e.rotation&&(n=E.Quaternion.FromArray(e.rotation)),e.scale&&(a=E.Vector3.FromArray(e.scale));t.position=r,t.rotationQuaternion=n,t.scaling=a}},e.prototype._loadSkinAsync=function(e,t,r){var n=this,a=function(e){n._forEachPrimitive(t,function(t){t.skeleton=e})};if(r._data)return a(r._data.babylonSkeleton),r._data.promise;var o="skeleton"+r.index,i=new L.a(r.name||o,o,this.babylonScene);i.overrideMesh=this._rootBabylonMesh,this._loadBones(e,r,i),a(i);var s=this._loadSkinInverseBindMatricesDataAsync(e,r).then(function(e){n._updateBoneMatrices(i,e)});return r._data={babylonSkeleton:i,promise:s},s},e.prototype._loadBones=function(e,t,r){for(var n={},a=0,o=t.joints;a<o.length;a++){var i=o[a],s=we.Get(e+"/joints/"+i,this.gltf.nodes,i);this._loadBone(s,t,r,n)}},e.prototype._loadBone=function(e,t,r,n){var a=n[e.index];if(a)return a;var o=null;e.parent&&e.parent._babylonTransformNode!==this._rootBabylonMesh&&(o=this._loadBone(e.parent,t,r,n));var i=t.joints.indexOf(e.index);return a=new S.a(e.name||"joint"+e.index,r,o,this._getNodeMatrix(e),null,null,i),n[e.index]=a,e._babylonBones=e._babylonBones||[],e._babylonBones.push(a),a},e.prototype._loadSkinInverseBindMatricesDataAsync=function(e,t){if(null==t.inverseBindMatrices)return Promise.resolve(null);var r=we.Get(e+"/inverseBindMatrices",this.gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/"+r.index,r)},e.prototype._updateBoneMatrices=function(e,t){for(var r=0,n=e.bones;r<n.length;r++){var a=n[r],o=E.Matrix.Identity(),i=a._index;t&&-1!==i&&(E.Matrix.FromArrayToRef(t,16*i,o),o.invertToRef(o));var s=a.getParent();s&&o.multiplyToRef(s.getInvertedAbsoluteTransform(),o),a.updateMatrix(o,!1,!1),a._updateDifferenceMatrix(void 0,!1)}},e.prototype._getNodeMatrix=function(e){return e.matrix?E.Matrix.FromArray(e.matrix):E.Matrix.Compose(e.scale?E.Vector3.FromArray(e.scale):E.Vector3.One(),e.rotation?E.Quaternion.FromArray(e.rotation):E.Quaternion.Identity(),e.translation?E.Vector3.FromArray(e.translation):E.Vector3.Zero())},e.prototype.loadCameraAsync=function(t,r,n){void 0===n&&(n=function(){});var a=this._extensionsLoadCameraAsync(t,r,n);if(a)return a;var o=new Array;this.logOpen(t+" "+(r.name||""));var i=new O.a(r.name||"camera"+r.index,E.Vector3.Zero(),this.babylonScene,!1);switch(i.rotation=new E.Vector3(0,Math.PI,0),r.type){case"perspective":var s=r.perspective;if(!s)throw new Error(t+": Camera perspective properties are missing");i.fov=s.yfov,i.minZ=s.znear,i.maxZ=s.zfar||Number.MAX_VALUE;break;case"orthographic":if(!r.orthographic)throw new Error(t+": Camera orthographic properties are missing");i.mode=M.a.ORTHOGRAPHIC_CAMERA,i.orthoLeft=-r.orthographic.xmag,i.orthoRight=r.orthographic.xmag,i.orthoBottom=-r.orthographic.ymag,i.orthoTop=r.orthographic.ymag,i.minZ=r.orthographic.znear,i.maxZ=r.orthographic.zfar;break;default:throw new Error(t+": Invalid camera type ("+r.type+")")}return e.AddPointerMetadata(i,t),this._parent.onCameraLoadedObservable.notifyObservers(i),n(i),Promise.all(o).then(function(){return i})},e.prototype._loadAnimationsAsync=function(){var e=this.gltf.animations;if(!e)return Promise.resolve();for(var t=new Array,r=0;r<e.length;r++){var n=e[r];t.push(this.loadAnimationAsync("/animations/"+n.index,n))}return Promise.all(t).then(function(){})},e.prototype.loadAnimationAsync=function(e,t){var r=this._extensionsLoadAnimationAsync(e,t);if(r)return r;var n=new xe.a(t.name||"animation"+t.index,this.babylonScene);t._babylonAnimationGroup=n;var a=new Array;we.Assign(t.channels),we.Assign(t.samplers);for(var o=0,i=t.channels;o<i.length;o++){var s=i[o];a.push(this._loadAnimationChannelAsync(e+"/channels/"+s.index,e,t,s,n))}return Promise.all(a).then(function(){return n.normalize(0),n})},e.prototype._loadAnimationChannelAsync=function(e,t,r,n,a){var o=this;if(null==n.target.node)return Promise.resolve();var i=we.Get(e+"/target/node",this.gltf.nodes,n.target.node);if("weights"===n.target.path&&!i._numMorphTargets||"weights"!==n.target.path&&!i._babylonTransformNode)return Promise.resolve();var s=we.Get(e+"/sampler",r.samplers,n.sampler);return this._loadAnimationSamplerAsync(t+"/samplers/"+n.sampler,s).then(function(t){var r,s;switch(n.target.path){case"translation":r="position",s=w.a.ANIMATIONTYPE_VECTOR3;break;case"rotation":r="rotationQuaternion",s=w.a.ANIMATIONTYPE_QUATERNION;break;case"scale":r="scaling",s=w.a.ANIMATIONTYPE_VECTOR3;break;case"weights":r="influence",s=w.a.ANIMATIONTYPE_FLOAT;break;default:throw new Error(e+"/target/path: Invalid value ("+n.target.path+")")}var l,u,c=0;switch(r){case"position":l=function(){var e=E.Vector3.FromArray(t.output,c);return c+=3,e};break;case"rotationQuaternion":l=function(){var e=E.Quaternion.FromArray(t.output,c);return c+=4,e};break;case"scaling":l=function(){var e=E.Vector3.FromArray(t.output,c);return c+=3,e};break;case"influence":l=function(){for(var e=new Array(i._numMorphTargets),r=0;r<i._numMorphTargets;r++)e[r]=t.output[c++];return e}}switch(t.interpolation){case"STEP":u=function(e){return{frame:t.input[e],value:l(),interpolation:w.c.STEP}};break;case"LINEAR":u=function(e){return{frame:t.input[e],value:l()}};break;case"CUBICSPLINE":u=function(e){return{frame:t.input[e],inTangent:l(),value:l(),outTangent:l()}}}for(var f=new Array(t.input.length),h=0;h<t.input.length;h++)f[h]=u(h);if("influence"===r)for(var d=function(e){var t=a.name+"_channel"+a.targetedAnimations.length,n=new w.a(t,r,1,s);n.setKeys(f.map(function(t){return{frame:t.frame,inTangent:t.inTangent?t.inTangent[e]:void 0,value:t.value[e],outTangent:t.outTangent?t.outTangent[e]:void 0}})),o._forEachPrimitive(i,function(t){var r=t.morphTargetManager.getTarget(e),o=n.clone();r.animations.push(o),a.addTargetedAnimation(o,r)})},p=0;p<i._numMorphTargets;p++)d(p);else{var m=a.name+"_channel"+a.targetedAnimations.length,_=new w.a(m,r,1,s);_.setKeys(f),i._babylonTransformNode.animations.push(_),a.addTargetedAnimation(_,i._babylonTransformNode)}})},e.prototype._loadAnimationSamplerAsync=function(e,t){if(t._data)return t._data;var r=t.interpolation||"LINEAR";switch(r){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(e+"/interpolation: Invalid value ("+t.interpolation+")")}var n=we.Get(e+"/input",this.gltf.accessors,t.input),a=we.Get(e+"/output",this.gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync("/accessors/"+n.index,n),this._loadFloatAccessorAsync("/accessors/"+a.index,a)]).then(function(e){var t=e[0],n=e[1];return{input:t,interpolation:r,output:n}}),t._data},e.prototype._loadBufferAsync=function(e,t){if(t._data)return t._data;if(!t.uri)throw new Error(e+"/uri: Value is missing");return t._data=this.loadUriAsync(e+"/uri",t.uri),t._data},e.prototype.loadBufferViewAsync=function(e,t){if(t._data)return t._data;var r=we.Get(e+"/buffer",this.gltf.buffers,t.buffer);return t._data=this._loadBufferAsync("/buffers/"+r.index,r).then(function(r){try{return new Uint8Array(r.buffer,r.byteOffset+(t.byteOffset||0),t.byteLength)}catch(t){throw new Error(e+": "+t.message)}}),t._data},e.prototype._loadIndicesAccessorAsync=function(t,r){if("SCALAR"!==r.type)throw new Error(t+"/type: Invalid value "+r.type);if(5121!==r.componentType&&5123!==r.componentType&&5125!==r.componentType)throw new Error(t+"/componentType: Invalid value "+r.componentType);if(r._data)return r._data;var n=we.Get(t+"/bufferView",this.gltf.bufferViews,r.bufferView);return r._data=this.loadBufferViewAsync("/bufferViews/"+n.index,n).then(function(n){return e._GetTypedArray(t,r.componentType,n,r.byteOffset,r.count)}),r._data},e.prototype._loadFloatAccessorAsync=function(t,r){var n=this;if(5126!==r.componentType)throw new Error("Invalid component type "+r.componentType);if(r._data)return r._data;var a=e._GetNumComponents(t,r.type),o=a*r.count;if(null==r.bufferView)r._data=Promise.resolve(new Float32Array(o));else{var i=we.Get(t+"/bufferView",this.gltf.bufferViews,r.bufferView);r._data=this.loadBufferViewAsync("/bufferViews/"+i.index,i).then(function(n){return e._GetTypedArray(t,r.componentType,n,r.byteOffset,o)})}if(r.sparse){var s=r.sparse;r._data=r._data.then(function(o){var i=o,l=we.Get(t+"/sparse/indices/bufferView",n.gltf.bufferViews,s.indices.bufferView),u=we.Get(t+"/sparse/values/bufferView",n.gltf.bufferViews,s.values.bufferView);return Promise.all([n.loadBufferViewAsync("/bufferViews/"+l.index,l),n.loadBufferViewAsync("/bufferViews/"+u.index,u)]).then(function(n){for(var o=n[0],l=n[1],u=e._GetTypedArray(t+"/sparse/indices",s.indices.componentType,o,s.indices.byteOffset,s.count),c=e._GetTypedArray(t+"/sparse/values",r.componentType,l,s.values.byteOffset,a*s.count),f=0,h=0;h<u.length;h++)for(var d=u[h]*a,p=0;p<a;p++)i[d++]=c[f++];return i})})}return r._data},e.prototype._loadVertexBufferViewAsync=function(e,t){var r=this;return e._babylonBuffer?e._babylonBuffer:(e._babylonBuffer=this.loadBufferViewAsync("/bufferViews/"+e.index,e).then(function(e){return new D.a(r.babylonScene.getEngine(),e,!1)}),e._babylonBuffer)},e.prototype._loadVertexAccessorAsync=function(t,r,n){var a=this;if(r._babylonVertexBuffer)return r._babylonVertexBuffer;if(r.sparse)r._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+r.index,r).then(function(e){return new D.b(a.babylonScene.getEngine(),e,n,!1)});else if(r.byteOffset&&r.byteOffset%D.b.GetTypeByteLength(r.componentType)!=0)u.h.Warn("Accessor byte offset is not a multiple of component type byte length"),r._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+r.index,r).then(function(e){return new D.b(a.babylonScene.getEngine(),e,n,!1)});else{var o=we.Get(t+"/bufferView",this.gltf.bufferViews,r.bufferView);r._babylonVertexBuffer=this._loadVertexBufferViewAsync(o,n).then(function(i){var s=e._GetNumComponents(t,r.type);return new D.b(a.babylonScene.getEngine(),i,n,!1,!1,o.byteStride,!1,r.byteOffset,s,r.componentType,r.normalized,!0)})}return r._babylonVertexBuffer},e.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(e,t,r){if(!(r instanceof Te.a))throw new Error(e+": Material type not supported");var n=new Array;return t&&(t.baseColorFactor?(r.albedoColor=E.Color3.FromArray(t.baseColorFactor),r.alpha=t.baseColorFactor[3]):r.albedoColor=E.Color3.White(),r.metallic=null==t.metallicFactor?1:t.metallicFactor,r.roughness=null==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&n.push(this.loadTextureInfoAsync(e+"/baseColorTexture",t.baseColorTexture,function(e){e.name=r.name+" (Base Color)",r.albedoTexture=e})),t.metallicRoughnessTexture&&(n.push(this.loadTextureInfoAsync(e+"/metallicRoughnessTexture",t.metallicRoughnessTexture,function(e){e.name=r.name+" (Metallic Roughness)",r.metallicTexture=e})),r.useMetallnessFromMetallicTextureBlue=!0,r.useRoughnessFromMetallicTextureGreen=!0,r.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(n).then(function(){})},e.prototype._loadMaterialAsync=function(t,r,n,a,o){void 0===o&&(o=function(){});var i=this._extensionsLoadMaterialAsync(t,r,n,a,o);if(i)return i;r._data=r._data||{};var s=r._data[a];if(!s){this.logOpen(t+" "+(r.name||""));var l=this.createMaterial(t,r,a);s={babylonMaterial:l,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,r,l)},r._data[a]=s,e.AddPointerMetadata(l,t),this._parent.onMaterialLoadedObservable.notifyObservers(l),this.logClose()}return s.babylonMeshes.push(n),n.onDisposeObservable.addOnce(function(){var e=s.babylonMeshes.indexOf(n);-1!==e&&s.babylonMeshes.splice(e,1)}),o(s.babylonMaterial),s.promise.then(function(){return s.babylonMaterial})},e.prototype._createDefaultMaterial=function(e,t){var r=new Te.a(e,this.babylonScene);return r.sideOrientation=this.babylonScene.useRightHandedSystem?R.a.CounterClockWiseSideOrientation:R.a.ClockWiseSideOrientation,r.fillMode=t,r.enableSpecularAntiAliasing=!0,r.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,r.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,r.transparencyMode=Te.a.PBRMATERIAL_OPAQUE,r.metallic=1,r.roughness=1,r},e.prototype.createMaterial=function(e,t,r){var n=this._extensionsCreateMaterial(e,t,r);if(n)return n;var a=t.name||"material"+t.index;return this._createDefaultMaterial(a,r)},e.prototype.loadMaterialPropertiesAsync=function(e,t,r){var n=this._extensionsLoadMaterialPropertiesAsync(e,t,r);if(n)return n;var a=new Array;return a.push(this.loadMaterialBasePropertiesAsync(e,t,r)),t.pbrMetallicRoughness&&a.push(this._loadMaterialMetallicRoughnessPropertiesAsync(e+"/pbrMetallicRoughness",t.pbrMetallicRoughness,r)),this.loadMaterialAlphaProperties(e,t,r),Promise.all(a).then(function(){})},e.prototype.loadMaterialBasePropertiesAsync=function(e,t,r){if(!(r instanceof Te.a))throw new Error(e+": Material type not supported");var n=new Array;return r.emissiveColor=t.emissiveFactor?E.Color3.FromArray(t.emissiveFactor):new E.Color3(0,0,0),t.doubleSided&&(r.backFaceCulling=!1,r.twoSidedLighting=!0),t.normalTexture&&(n.push(this.loadTextureInfoAsync(e+"/normalTexture",t.normalTexture,function(e){e.name=r.name+" (Normal)",r.bumpTexture=e})),r.invertNormalMapX=!this.babylonScene.useRightHandedSystem,r.invertNormalMapY=this.babylonScene.useRightHandedSystem,null!=t.normalTexture.scale&&(r.bumpTexture.level=t.normalTexture.scale),r.forceIrradianceInFragment=!0),t.occlusionTexture&&(n.push(this.loadTextureInfoAsync(e+"/occlusionTexture",t.occlusionTexture,function(e){e.name=r.name+" (Occlusion)",r.ambientTexture=e})),r.useAmbientInGrayScale=!0,null!=t.occlusionTexture.strength&&(r.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&n.push(this.loadTextureInfoAsync(e+"/emissiveTexture",t.emissiveTexture,function(e){e.name=r.name+" (Emissive)",r.emissiveTexture=e})),Promise.all(n).then(function(){})},e.prototype.loadMaterialAlphaProperties=function(e,t,r){if(!(r instanceof Te.a))throw new Error(e+": Material type not supported");switch(t.alphaMode||"OPAQUE"){case"OPAQUE":r.transparencyMode=Te.a.PBRMATERIAL_OPAQUE;break;case"MASK":r.transparencyMode=Te.a.PBRMATERIAL_ALPHATEST,r.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff,r.albedoTexture&&(r.albedoTexture.hasAlpha=!0);break;case"BLEND":r.transparencyMode=Te.a.PBRMATERIAL_ALPHABLEND,r.albedoTexture&&(r.albedoTexture.hasAlpha=!0,r.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(e+"/alphaMode: Invalid value ("+t.alphaMode+")")}},e.prototype.loadTextureInfoAsync=function(t,r,n){var a=this;void 0===n&&(n=function(){});var o=this._extensionsLoadTextureInfoAsync(t,r,n);if(o)return o;this.logOpen(""+t);var i=we.Get(t+"/index",this.gltf.textures,r.index),s=this._loadTextureAsync("/textures/"+r.index,i,function(o){o.coordinatesIndex=r.texCoord||0,e.AddPointerMetadata(o,t),a._parent.onTextureLoadedObservable.notifyObservers(o),n(o)});return this.logClose(),s},e.prototype._loadTextureAsync=function(t,r,n){var a=this;void 0===n&&(n=function(){});var o=new Array;this.logOpen(t+" "+(r.name||""));var i=null==r.sampler?e._DefaultSampler:we.Get(t+"/sampler",this.gltf.samplers,r.sampler),s=this._loadSampler("/samplers/"+i.index,i),l=we.Get(t+"/source",this.gltf.images,r.source),c=null;l.uri&&(u.h.IsBase64(l.uri)?c=l.uri:this.babylonScene.getEngine().textureFormatInUse&&(c=this._rootUrl+l.uri));var f=new Ae.a,h=new I.a(c,this.babylonScene,s.noMipMaps,!1,s.samplingMode,function(){a._disposed||f.resolve()},function(e,r){a._disposed||f.reject(new Error(t+": "+(r&&r.message?r.message:e||"Failed to load texture")))});return o.push(f.promise),c||o.push(this.loadImageAsync("/images/"+l.index,l).then(function(e){var t=l.uri||a._fileName+"#image"+l.index,r="data:"+a._uniqueRootUrl+t;h.updateURL(r,new Blob([e],{type:l.mimeType}))})),h.wrapU=s.wrapU,h.wrapV=s.wrapV,n(h),this.logClose(),Promise.all(o).then(function(){return h})},e.prototype._loadSampler=function(t,r){return r._data||(r._data={noMipMaps:9728===r.minFilter||9729===r.minFilter,samplingMode:e._GetTextureSamplingMode(t,r),wrapU:e._GetTextureWrapMode(t+"/wrapS",r.wrapS),wrapV:e._GetTextureWrapMode(t+"/wrapT",r.wrapT)}),r._data},e.prototype.loadImageAsync=function(e,t){if(!t._data){if(this.logOpen(e+" "+(t.name||"")),t.uri)t._data=this.loadUriAsync(e+"/uri",t.uri);else{var r=we.Get(e+"/bufferView",this.gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync("/bufferViews/"+r.index,r)}this.logClose()}return t._data},e.prototype.loadUriAsync=function(t,r){var n=this,a=this._extensionsLoadUriAsync(t,r);if(a)return a;if(!e._ValidateUri(r))throw new Error(t+": '"+r+"' is invalid");if(u.h.IsBase64(r)){var o=new Uint8Array(u.h.DecodeBase64(r));return this.log("Decoded "+r.substr(0,64)+"... ("+o.length+" bytes)"),Promise.resolve(o)}return this.log("Loading "+r),this._parent.preprocessUrlAsync(this._rootUrl+r).then(function(e){return new Promise(function(a,o){if(!n._disposed){var i=u.h.LoadFile(e,function(e){if(!n._disposed){var t=new Uint8Array(e);n.log("Loaded "+r+" ("+t.length+" bytes)"),a(t)}},function(e){if(!n._disposed&&(i&&(i._lengthComputable=e.lengthComputable,i._loaded=e.loaded,i._total=e.total),n._state===s.LOADING))try{n._onProgress()}catch(e){o(e)}},n.babylonScene.offlineProvider,!0,function(e,a){n._disposed||o(new u.e(t+": Failed to load '"+r+"'"+(e?": "+e.status+" "+e.statusText:""),e))});n._requests.push(i)}})})},e.prototype._onProgress=function(){if(this._progressCallback){for(var e=!0,t=0,r=0,n=0,a=this._requests;n<a.length;n++){var o=a[n];if(void 0===o._lengthComputable||void 0===o._loaded||void 0===o._total)return;e=e&&o._lengthComputable,t+=o._loaded,r+=o._total}this._progressCallback(new c.b(e,t,e?r:0))}},e.AddPointerMetadata=function(e,t){var r=e.metadata=e.metadata||{},n=r.gltf=r.gltf||{};(n.pointers=n.pointers||[]).push(t)},e._GetTextureWrapMode=function(e,t){switch(t=null==t?10497:t){case 33071:return I.a.CLAMP_ADDRESSMODE;case 33648:return I.a.MIRROR_ADDRESSMODE;case 10497:return I.a.WRAP_ADDRESSMODE;default:return u.h.Warn(e+": Invalid value ("+t+")"),I.a.WRAP_ADDRESSMODE}},e._GetTextureSamplingMode=function(e,t){var r=null==t.magFilter?9729:t.magFilter,n=null==t.minFilter?9987:t.minFilter;if(9729===r)switch(n){case 9728:return I.a.LINEAR_NEAREST;case 9729:return I.a.LINEAR_LINEAR;case 9984:return I.a.LINEAR_NEAREST_MIPNEAREST;case 9985:return I.a.LINEAR_LINEAR_MIPNEAREST;case 9986:return I.a.LINEAR_NEAREST_MIPLINEAR;case 9987:return I.a.LINEAR_LINEAR_MIPLINEAR;default:return u.h.Warn(e+"/minFilter: Invalid value ("+n+")"),I.a.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==r&&u.h.Warn(e+"/magFilter: Invalid value ("+r+")"),n){case 9728:return I.a.NEAREST_NEAREST;case 9729:return I.a.NEAREST_LINEAR;case 9984:return I.a.NEAREST_NEAREST_MIPNEAREST;case 9985:return I.a.NEAREST_LINEAR_MIPNEAREST;case 9986:return I.a.NEAREST_NEAREST_MIPLINEAR;case 9987:return I.a.NEAREST_LINEAR_MIPLINEAR;default:return u.h.Warn(e+"/minFilter: Invalid value ("+n+")"),I.a.NEAREST_NEAREST_MIPNEAREST}},e._GetTypedArray=function(e,t,r,n,a){var o=r.buffer;n=r.byteOffset+(n||0);try{switch(t){case 5120:return new Int8Array(o,n,a);case 5121:return new Uint8Array(o,n,a);case 5122:return new Int16Array(o,n,a);case 5123:return new Uint16Array(o,n,a);case 5125:return new Uint32Array(o,n,a);case 5126:return new Float32Array(o,n,a);default:throw new Error("Invalid component type "+t)}}catch(t){throw new Error(e+": "+t)}},e._GetNumComponents=function(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(e+": Invalid type ("+t+")")},e._ValidateUri=function(e){return u.h.IsBase64(e)||-1===e.indexOf("..")},e._GetDrawMode=function(e,t){switch(null==t&&(t=4),t){case 0:return R.a.PointListDrawMode;case 1:return R.a.LineListDrawMode;case 2:return R.a.LineLoopDrawMode;case 3:return R.a.LineStripDrawMode;case 4:return R.a.TriangleFillMode;case 5:return R.a.TriangleStripDrawMode;case 6:return R.a.TriangleFanDrawMode}throw new Error(e+": Invalid mesh primitive mode ("+t+")")},e.prototype._compileMaterialsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile materials");var t=new Array;if(this.gltf.materials)for(var r=0,n=this.gltf.materials;r<n.length;r++){var a=n[r];if(a._data)for(var o in a._data)for(var i=a._data[o],s=0,l=i.babylonMeshes;s<l.length;s++){var u=l[s];u.computeWorldMatrix(!0);var c=i.babylonMaterial;t.push(c.forceCompilationAsync(u)),this._parent.useClipPlane&&t.push(c.forceCompilationAsync(u,{clipPlane:!0}))}}return Promise.all(t).then(function(){e._parent._endPerformanceCounter("Compile materials")})},e.prototype._compileShadowGeneratorsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var t=new Array,r=0,n=this.babylonScene.lights;r<n.length;r++){var a=n[r].getShadowGenerator();a&&t.push(a.forceCompilationAsync())}return Promise.all(t).then(function(){e._parent._endPerformanceCounter("Compile shadow generators")})},e.prototype._forEachExtensions=function(t){for(var r=0,n=e._ExtensionNames;r<n.length;r++){var a=n[r],o=this._extensions[a];o.enabled&&t(o)}},e.prototype._applyExtensions=function(t,r){for(var n=0,a=e._ExtensionNames;n<a.length;n++){var o=a[n],i=this._extensions[o];if(i.enabled){var s=t;s._activeLoaderExtensions=s._activeLoaderExtensions||{};var l=s._activeLoaderExtensions;if(!l[o]){l[o]=!0;try{var u=r(i);if(u)return u}finally{delete l[o]}}}}return null},e.prototype._extensionsOnLoading=function(){this._forEachExtensions(function(e){return e.onLoading&&e.onLoading()})},e.prototype._extensionsOnReady=function(){this._forEachExtensions(function(e){return e.onReady&&e.onReady()})},e.prototype._extensionsLoadSceneAsync=function(e,t){return this._applyExtensions(t,function(r){return r.loadSceneAsync&&r.loadSceneAsync(e,t)})},e.prototype._extensionsLoadNodeAsync=function(e,t,r){return this._applyExtensions(t,function(n){return n.loadNodeAsync&&n.loadNodeAsync(e,t,r)})},e.prototype._extensionsLoadCameraAsync=function(e,t,r){return this._applyExtensions(t,function(n){return n.loadCameraAsync&&n.loadCameraAsync(e,t,r)})},e.prototype._extensionsLoadVertexDataAsync=function(e,t,r){return this._applyExtensions(t,function(n){return n._loadVertexDataAsync&&n._loadVertexDataAsync(e,t,r)})},e.prototype._extensionsLoadMaterialAsync=function(e,t,r,n,a){return this._applyExtensions(t,function(o){return o._loadMaterialAsync&&o._loadMaterialAsync(e,t,r,n,a)})},e.prototype._extensionsCreateMaterial=function(e,t,r){return this._applyExtensions({},function(n){return n.createMaterial&&n.createMaterial(e,t,r)})},e.prototype._extensionsLoadMaterialPropertiesAsync=function(e,t,r){return this._applyExtensions(t,function(n){return n.loadMaterialPropertiesAsync&&n.loadMaterialPropertiesAsync(e,t,r)})},e.prototype._extensionsLoadTextureInfoAsync=function(e,t,r){return this._applyExtensions(t,function(n){return n.loadTextureInfoAsync&&n.loadTextureInfoAsync(e,t,r)})},e.prototype._extensionsLoadAnimationAsync=function(e,t){return this._applyExtensions(t,function(r){return r.loadAnimationAsync&&r.loadAnimationAsync(e,t)})},e.prototype._extensionsLoadUriAsync=function(e,t){return this._applyExtensions({},function(r){return r._loadUriAsync&&r._loadUriAsync(e,t)})},e.LoadExtensionAsync=function(e,t,r,n){if(!t.extensions)return null;var a=t.extensions[r];return a?n(e+"/extensions/"+r,a):null},e.LoadExtraAsync=function(e,t,r,n){if(!t.extras)return null;var a=t.extras[r];return a?n(e+"/extras/"+r,a):null},e.prototype.logOpen=function(e){this._parent._logOpen(e)},e.prototype.logClose=function(){this._parent._logClose()},e.prototype.log=function(e){this._parent._log(e)},e.prototype.startPerformanceCounter=function(e){this._parent._startPerformanceCounter(e)},e.prototype.endPerformanceCounter=function(e){this._parent._endPerformanceCounter(e)},e._DefaultSampler={index:-1},e._ExtensionNames=new Array,e._ExtensionFactories={},e}();h._CreateGLTF2Loader=function(e){return new Se(e)};var Le=r(12),Ce=r(68),Re=r(205),Ne="EXT_lights_image_based",Fe=function(){function e(e){this.name=Ne,this.enabled=!0,this._loader=e}return e.prototype.dispose=function(){delete this._loader,delete this._lights},e.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights}},e.prototype.loadSceneAsync=function(e,t){var r=this;return Se.LoadExtensionAsync(e,t,this.name,function(n,a){var o=new Array;o.push(r._loader.loadSceneAsync(e,t)),r._loader.logOpen(""+n);var i=we.Get(n+"/light",r._lights,a.light);return o.push(r._loadLightAsync("#/extensions/"+r.name+"/lights/"+a.light,i).then(function(e){r._loader.babylonScene.environmentTexture=e})),r._loader.logClose(),Promise.all(o).then(function(){})})},e.prototype._loadLightAsync=function(e,t){var r=this;if(!t._loaded){var n=new Array;this._loader.logOpen(""+e);for(var a=new Array(t.specularImages.length),o=function(r){var o=t.specularImages[r];a[r]=new Array(o.length);for(var s=function(t){var s=e+"/specularImages/"+r+"/"+t;i._loader.logOpen(""+s);var l=o[t],u=we.Get(s,i._loader.gltf.images,l);n.push(i._loader.loadImageAsync("#/images/"+l,u).then(function(e){a[r][t]=e})),i._loader.logClose()},l=0;l<o.length;l++)s(l)},i=this,s=0;s<t.specularImages.length;s++)o(s);this._loader.logClose(),t._loaded=Promise.all(n).then(function(){var e=new Re.a(r._loader.babylonScene,null,t.specularImageSize);if(t._babylonTexture=e,null!=t.intensity&&(e.level=t.intensity),t.rotation){var n=E.Quaternion.FromArray(t.rotation);r._loader.babylonScene.useRightHandedSystem||(n=E.Quaternion.Inverse(n)),E.Matrix.FromQuaternionToRef(n,e.getReflectionTextureMatrix())}var o=Ce.a.FromArray(t.irradianceCoefficients);o.scale(t.intensity),o.convertIrradianceToLambertianRadiance();var i=Ce.b.FromHarmonics(o),s=(a.length-1)/Le.a.Log2(t.specularImageSize);return e.updateRGBDAsync(a,i,s)})}return t._loaded.then(function(){return t._babylonTexture})},e}();Se.RegisterExtension(Ne,function(e){return new Fe(e)});var Pe=r(150),Ie="KHR_draco_mesh_compression",Ve=function(){function e(e){this.name=Ie,this.enabled=Pe.a.DecoderAvailable,this._loader=e}return e.prototype.dispose=function(){this._dracoCompression&&(this._dracoCompression.dispose(),delete this._dracoCompression),delete this._loader},e.prototype._loadVertexDataAsync=function(e,t,r){var n=this;return Se.LoadExtensionAsync(e,t,this.name,function(a,o){if(null!=t.mode){if(5!==t.mode&&4!==t.mode)throw new Error(e+": Unsupported mode "+t.mode);if(5===t.mode)throw new Error(e+": Mode "+t.mode+" is not currently supported")}var i={},s=function(e,t){var n=o.attributes[e];null!=n&&(r._delayInfo=r._delayInfo||[],-1===r._delayInfo.indexOf(t)&&r._delayInfo.push(t),i[t]=n)};s("POSITION",D.b.PositionKind),s("NORMAL",D.b.NormalKind),s("TANGENT",D.b.TangentKind),s("TEXCOORD_0",D.b.UVKind),s("TEXCOORD_1",D.b.UV2Kind),s("JOINTS_0",D.b.MatricesIndicesKind),s("WEIGHTS_0",D.b.MatricesWeightsKind),s("COLOR_0",D.b.ColorKind);var l=we.Get(a,n._loader.gltf.bufferViews,o.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=n._loader.loadBufferViewAsync("#/bufferViews/"+l.index,l).then(function(t){return n._dracoCompression||(n._dracoCompression=new Pe.a),n._dracoCompression.decodeMeshAsync(t,i).then(function(e){var t=new B.d(r.name,n._loader.babylonScene);return e.applyToGeometry(t),t}).catch(function(t){throw new Error(e+": "+t.message)})})),l._dracoBabylonGeometry})},e}();Se.RegisterExtension(Ie,function(e){return new Ve(e)});var De,Be=r(44),Ue="KHR_lights_punctual";!function(e){e.DIRECTIONAL="directional",e.POINT="point",e.SPOT="spot"}(De||(De={}));var Ge=function(){function e(e){this.name=Ue,this.enabled=!0,this._loader=e}return e.prototype.dispose=function(){delete this._loader,delete this._lights},e.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights}},e.prototype.loadNodeAsync=function(e,t,r){var n=this;return Se.LoadExtensionAsync(e,t,this.name,function(a,o){return n._loader.loadNodeAsync(e,t,function(e){var t,i=we.Get(a,n._lights,o.light),s=i.name||e.name;switch(i.type){case De.DIRECTIONAL:t=new W.a(s,E.Vector3.Backward(),n._loader.babylonScene);break;case De.POINT:t=new K.a(s,E.Vector3.Zero(),n._loader.babylonScene);break;case De.SPOT:var l=new j.a(s,E.Vector3.Zero(),E.Vector3.Backward(),0,1,n._loader.babylonScene);l.angle=2*(i.spot&&i.spot.outerConeAngle||Math.PI/4),l.innerAngle=2*(i.spot&&i.spot.innerConeAngle||0),t=l;break;default:throw new Error(a+": Invalid light type ("+i.type+")")}t.falloffType=Be.a.FALLOFF_GLTF,t.diffuse=i.color?E.Color3.FromArray(i.color):E.Color3.White(),t.intensity=null==i.intensity?1:i.intensity,t.range=null==i.range?Number.MAX_VALUE:i.range,t.parent=e,Se.AddPointerMetadata(t,a),r(e)})})},e}();Se.RegisterExtension(Ue,function(e){return new Ge(e)});var ke="KHR_materials_pbrSpecularGlossiness",He=function(){function e(e){this.name=ke,this.enabled=!0,this._loader=e}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadMaterialPropertiesAsync=function(e,t,r){var n=this;return Se.LoadExtensionAsync(e,t,this.name,function(a,o){var i=new Array;return i.push(n._loader.loadMaterialBasePropertiesAsync(e,t,r)),i.push(n._loadSpecularGlossinessPropertiesAsync(a,t,o,r)),n._loader.loadMaterialAlphaProperties(e,t,r),Promise.all(i).then(function(){})})},e.prototype._loadSpecularGlossinessPropertiesAsync=function(e,t,r,n){if(!(n instanceof Te.a))throw new Error(e+": Material type not supported");var a=new Array;return n.metallic=null,n.roughness=null,r.diffuseFactor?(n.albedoColor=E.Color3.FromArray(r.diffuseFactor),n.alpha=r.diffuseFactor[3]):n.albedoColor=E.Color3.White(),n.reflectivityColor=r.specularFactor?E.Color3.FromArray(r.specularFactor):E.Color3.White(),n.microSurface=null==r.glossinessFactor?1:r.glossinessFactor,r.diffuseTexture&&a.push(this._loader.loadTextureInfoAsync(e+"/diffuseTexture",r.diffuseTexture,function(e){e.name=n.name+" (Diffuse)",n.albedoTexture=e})),r.specularGlossinessTexture&&(a.push(this._loader.loadTextureInfoAsync(e+"/specularGlossinessTexture",r.specularGlossinessTexture,function(e){e.name=n.name+" (Specular Glossiness)",n.reflectivityTexture=e})),n.reflectivityTexture.hasAlpha=!0,n.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(a).then(function(){})},e}();Se.RegisterExtension(ke,function(e){return new He(e)});var We="KHR_materials_unlit",Ke=function(){function e(e){this.name=We,this.enabled=!0,this._loader=e}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadMaterialPropertiesAsync=function(e,t,r){var n=this;return Se.LoadExtensionAsync(e,t,this.name,function(){return n._loadUnlitPropertiesAsync(e,t,r)})},e.prototype._loadUnlitPropertiesAsync=function(e,t,r){if(!(r instanceof Te.a))throw new Error(e+": Material type not supported");var n=new Array;r.unlit=!0;var a=t.pbrMetallicRoughness;return a&&(a.baseColorFactor?(r.albedoColor=E.Color3.FromArray(a.baseColorFactor),r.alpha=a.baseColorFactor[3]):r.albedoColor=E.Color3.White(),a.baseColorTexture&&n.push(this._loader.loadTextureInfoAsync(e+"/baseColorTexture",a.baseColorTexture,function(e){e.name=r.name+" (Base Color)",r.albedoTexture=e}))),t.doubleSided&&(r.backFaceCulling=!1,r.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,t,r),Promise.all(n).then(function(){})},e}();Se.RegisterExtension(We,function(e){return new Ke(e)});var je="KHR_texture_transform",ze=function(){function e(e){this.name=je,this.enabled=!0,this._loader=e}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadTextureInfoAsync=function(e,t,r){var n=this;return Se.LoadExtensionAsync(e,t,this.name,function(a,o){return n._loader.loadTextureInfoAsync(e,t,function(e){if(!(e instanceof I.a))throw new Error(a+": Texture type not supported");o.offset&&(e.uOffset=o.offset[0],e.vOffset=o.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,o.rotation&&(e.wAng=-o.rotation),o.scale&&(e.uScale=o.scale[0],e.vScale=o.scale[1]),null!=o.texCoord&&(e.coordinatesIndex=o.texCoord),r(e)})})},e}();Se.RegisterExtension(je,function(e){return new ze(e)});var Qe=r(103),qe=r(167),Ye="MSFT_audio_emitter",Xe=function(){function e(e){this.name=Ye,this.enabled=!0,this._loader=e}return e.prototype.dispose=function(){delete this._loader,delete this._clips,delete this._emitters},e.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._clips=t.clips,this._emitters=t.emitters,we.Assign(this._clips),we.Assign(this._emitters)}},e.prototype.loadSceneAsync=function(e,t){var r=this;return Se.LoadExtensionAsync(e,t,this.name,function(n,a){var o=new Array;o.push(r._loader.loadSceneAsync(e,t));for(var i=0,s=a.emitters;i<s.length;i++){var l=s[i],u=we.Get(n+"/emitters",r._emitters,l);if(null!=u.refDistance||null!=u.maxDistance||null!=u.rolloffFactor||null!=u.distanceModel||null!=u.innerAngle||null!=u.outerAngle)throw new Error(n+": Direction or Distance properties are not allowed on emitters attached to a scene");o.push(r._loadEmitterAsync(n+"/emitters/"+u.index,u))}return Promise.all(o).then(function(){})})},e.prototype.loadNodeAsync=function(e,t,r){var n=this;return Se.LoadExtensionAsync(e,t,this.name,function(e,a){var o=new Array;return n._loader.loadNodeAsync(e,t,function(t){for(var i=function(r){var a=we.Get(e+"/emitters",n._emitters,r);o.push(n._loadEmitterAsync(e+"/emitters/"+a.index,a).then(function(){for(var e=0,r=a._babylonSounds;e<r.length;e++){var n=r[e];n.attachToMesh(t),null==a.innerAngle&&null==a.outerAngle||(n.setLocalDirectionToMesh(E.Vector3.Forward()),n.setDirectionalCone(2*u.h.ToDegrees(null==a.innerAngle?Math.PI:a.innerAngle),2*u.h.ToDegrees(null==a.outerAngle?Math.PI:a.outerAngle),0))}}))},s=0,l=a.emitters;s<l.length;s++){i(l[s])}r(t)}).then(function(e){return Promise.all(o).then(function(){return e})})})},e.prototype.loadAnimationAsync=function(e,t){var r=this;return Se.LoadExtensionAsync(e,t,this.name,function(n,a){return r._loader.loadAnimationAsync(e,t).then(function(o){var i=new Array;we.Assign(a.events);for(var s=0,l=a.events;s<l.length;s++){var u=l[s];i.push(r._loadAnimationEventAsync(n+"/events/"+u.index,e,t,u,o))}return Promise.all(i).then(function(){return o})})})},e.prototype._loadClipAsync=function(e,t){if(t._objectURL)return t._objectURL;var r;if(t.uri)r=this._loader.loadUriAsync(e,t.uri);else{var n=we.Get(e+"/bufferView",this._loader.gltf.bufferViews,t.bufferView);r=this._loader.loadBufferViewAsync("#/bufferViews/"+n.index,n)}return t._objectURL=r.then(function(e){return URL.createObjectURL(new Blob([e],{type:t.mimeType}))}),t._objectURL},e.prototype._loadEmitterAsync=function(e,t){var r=this;if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){for(var n=new Array,a=t.name||"emitter"+t.index,o={loop:!1,autoplay:!1,volume:null==t.volume?1:t.volume},i=function(e){var i="#/extensions/"+s.name+"/clips",l=we.Get(i,s._clips,t.clips[e].clip);n.push(s._loadClipAsync(i+"/"+t.clips[e].clip,l).then(function(n){var i=t._babylonSounds[e]=new Qe.a(a,n,r._loader.babylonScene,null,o);i.refDistance=t.refDistance||1,i.maxDistance=t.maxDistance||256,i.rolloffFactor=t.rolloffFactor||1,i.distanceModel=t.distanceModel||"exponential",i._positionInEmitterSpace=!0}))},s=this,l=0;l<t.clips.length;l++)i(l);var c=Promise.all(n).then(function(){var e=t.clips.map(function(e){return e.weight||1}),r=new qe.a(t.loop||!1,t._babylonSounds,e);t.innerAngle&&(r.directionalConeInnerAngle=2*u.h.ToDegrees(t.innerAngle)),t.outerAngle&&(r.directionalConeOuterAngle=2*u.h.ToDegrees(t.outerAngle)),t.volume&&(r.volume=t.volume),t._babylonData.sound=r});t._babylonData={loaded:c}}return t._babylonData.loaded},e.prototype._getEventAction=function(e,t,r,n,a){switch(r){case"play":return function(e){var r=(a||0)+(e-n);t.play(r)};case"stop":return function(e){t.stop()};case"pause":return function(e){t.pause()};default:throw new Error(e+": Unsupported action "+r)}},e.prototype._loadAnimationEventAsync=function(e,t,r,n,a){var o=this;if(0==a.targetedAnimations.length)return Promise.resolve();var i=a.targetedAnimations[0],s=n.emitter,l=we.Get("#/extensions/"+this.name+"/emitters",this._emitters,s);return this._loadEmitterAsync(e,l).then(function(){var t=l._babylonData.sound;if(t){var r=new w.b(n.time,o._getEventAction(e,t,n.action,n.time,n.startOffset));i.animation.addEvent(r),a.onAnimationGroupEndObservable.add(function(){t.stop()}),a.onAnimationGroupPauseObservable.add(function(){t.pause()})}})},e}();Se.RegisterExtension(Ye,function(e){return new Xe(e)});var Ze="MSFT_lod",Je=function(){function e(e){this.name=Ze,this.enabled=!0,this.maxLODsToLoad=Number.MAX_VALUE,this.onNodeLODsLoadedObservable=new l.c,this.onMaterialLODsLoadedObservable=new l.c,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._loader=e}return e.prototype.dispose=function(){delete this._loader,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},e.prototype.onReady=function(){for(var e=this,t=function(t){var n=Promise.all(r._nodePromiseLODs[t]).then(function(){0!==t&&e._loader.endPerformanceCounter("Node LOD "+t),e._loader.log("Loaded node LOD "+t),e.onNodeLODsLoadedObservable.notifyObservers(t),t!==e._nodePromiseLODs.length-1&&(e._loader.startPerformanceCounter("Node LOD "+(t+1)),e._nodeSignalLODs[t]&&e._nodeSignalLODs[t].resolve())});r._loader._completePromises.push(n)},r=this,n=0;n<this._nodePromiseLODs.length;n++)t(n);var a=function(t){var r=Promise.all(o._materialPromiseLODs[t]).then(function(){0!==t&&e._loader.endPerformanceCounter("Material LOD "+t),e._loader.log("Loaded material LOD "+t),e.onMaterialLODsLoadedObservable.notifyObservers(t),t!==e._materialPromiseLODs.length-1&&(e._loader.startPerformanceCounter("Material LOD "+(t+1)),e._materialSignalLODs[t]&&e._materialSignalLODs[t].resolve())});o._loader._completePromises.push(r)},o=this;for(n=0;n<this._materialPromiseLODs.length;n++)a(n)},e.prototype.loadNodeAsync=function(e,t,r){var n=this;return Se.LoadExtensionAsync(e,t,this.name,function(e,r){var a,o=n._getLODs(e,t,n._loader.gltf.nodes,r.ids);n._loader.logOpen(""+e);for(var i=function(e){var t=o[e];0!==e&&(n._nodeIndexLOD=e,n._nodeSignalLODs[e]=n._nodeSignalLODs[e]||new Ae.a);var r=n._loader.loadNodeAsync("#/nodes/"+t.index,t,function(e){e.setEnabled(!1)}).then(function(t){if(0!==e){var r=o[e-1];r._babylonTransformNode&&(r._babylonTransformNode.dispose(),delete r._babylonTransformNode,n._disposeUnusedMaterials())}return t.setEnabled(!0),t});0===e?a=r:n._nodeIndexLOD=null,n._nodePromiseLODs[e]=n._nodePromiseLODs[e]||[],n._nodePromiseLODs[e].push(r)},s=0;s<o.length;s++)i(s);return n._loader.logClose(),a})},e.prototype._loadMaterialAsync=function(e,t,r,n,a){var o=this;return this._nodeIndexLOD?null:Se.LoadExtensionAsync(e,t,this.name,function(e,i){var s,l=o._getLODs(e,t,o._loader.gltf.materials,i.ids);o._loader.logOpen(""+e);for(var u=function(e){var t=l[e];0!==e&&(o._materialIndexLOD=e);var i=o._loader._loadMaterialAsync("#/materials/"+t.index,t,r,n,function(t){0===e&&a(t)}).then(function(t){if(0!==e){a(t);var r=l[e-1]._data;r[n]&&(r[n].babylonMaterial.dispose(),delete r[n])}return t});0===e?s=i:o._materialIndexLOD=null,o._materialPromiseLODs[e]=o._materialPromiseLODs[e]||[],o._materialPromiseLODs[e].push(i)},c=0;c<l.length;c++)u(c);return o._loader.logClose(),s})},e.prototype._loadUriAsync=function(e,t){var r=this;if(null!==this._materialIndexLOD){this._loader.log("deferred");var n=this._materialIndexLOD-1;return this._materialSignalLODs[n]=this._materialSignalLODs[n]||new Ae.a,this._materialSignalLODs[n].promise.then(function(){return r._loader.loadUriAsync(e,t)})}if(null!==this._nodeIndexLOD){this._loader.log("deferred");n=this._nodeIndexLOD-1;return this._nodeSignalLODs[n]=this._nodeSignalLODs[n]||new Ae.a,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return r._loader.loadUriAsync(e,t)})}return null},e.prototype._getLODs=function(e,t,r,n){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var a=new Array,o=n.length-1;o>=0;o--)if(a.push(we.Get(e+"/ids/"+n[o],r,n[o])),a.length===this.maxLODsToLoad)return a;return a.push(t),a},e.prototype._disposeUnusedMaterials=function(){var e=this._loader.gltf.materials;if(e)for(var t=0,r=e;t<r.length;t++){var n=r[t];if(n._data)for(var a in n._data){var o=n._data[a];0===o.babylonMeshes.length&&(o.babylonMaterial.dispose(!1,!0),delete n._data[a])}}},e}();Se.RegisterExtension(Ze,function(e){return new Je(e)});var $e="MSFT_minecraftMesh",et=function(){function e(e){this.name=$e,this.enabled=!0,this._loader=e}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadMaterialPropertiesAsync=function(e,t,r){var n=this;return Se.LoadExtraAsync(e,t,this.name,function(a,o){if(o){if(!(r instanceof Te.a))throw new Error(a+": Material type not supported");var i=n._loader.loadMaterialPropertiesAsync(e,t,r);return r.needAlphaBlending()&&(r.forceDepthWrite=!0,r.separateCullingPass=!0),r.backFaceCulling=r.forceDepthWrite,r.twoSidedLighting=!0,i}return null})},e}();Se.RegisterExtension($e,function(e){return new et(e)});var tt="MSFT_sRGBFactors",rt=function(){function e(e){this.name=tt,this.enabled=!0,this._loader=e}return e.prototype.dispose=function(){delete this._loader},e.prototype.loadMaterialPropertiesAsync=function(e,t,r){var n=this;return Se.LoadExtraAsync(e,t,this.name,function(a,o){if(o){if(!(r instanceof Te.a))throw new Error(a+": Material type not supported");var i=n._loader.loadMaterialPropertiesAsync(e,t,r);return r.albedoTexture||r.albedoColor.toLinearSpaceToRef(r.albedoColor),r.reflectivityTexture||r.reflectivityColor.toLinearSpaceToRef(r.reflectivityColor),i}return null})},e}();Se.RegisterExtension(tt,function(e){return new rt(e)});var nt=function(){function e(){this.materials=[]}return e.prototype.parseMTL=function(t,r,n){if(!(r instanceof ArrayBuffer)){for(var a,o=r.split("\n"),i=/\s+/,s=null,l=0;l<o.length;l++){var u=o[l].trim();if(0!==u.length&&"#"!==u.charAt(0)){var c=u.indexOf(" "),f=c>=0?u.substring(0,c):u;f=f.toLowerCase();var h=c>=0?u.substring(c+1).trim():"";"newmtl"===f?(s&&this.materials.push(s),s=new F.StandardMaterial(h,t)):"kd"===f&&s?(a=h.split(i,3).map(parseFloat),s.diffuseColor=E.Color3.FromArray(a)):"ka"===f&&s?(a=h.split(i,3).map(parseFloat),s.ambientColor=E.Color3.FromArray(a)):"ks"===f&&s?(a=h.split(i,3).map(parseFloat),s.specularColor=E.Color3.FromArray(a)):"ke"===f&&s?(a=h.split(i,3).map(parseFloat),s.emissiveColor=E.Color3.FromArray(a)):"ns"===f&&s?s.specularPower=parseFloat(h):"d"===f&&s?s.alpha=parseFloat(h):"map_ka"===f&&s?s.ambientTexture=e._getTexture(n,h,t):"map_kd"===f&&s?s.diffuseTexture=e._getTexture(n,h,t):"map_ks"===f&&s?s.specularTexture=e._getTexture(n,h,t):"map_ns"===f||("map_bump"===f&&s?s.bumpTexture=e._getTexture(n,h,t):"map_d"===f&&s&&(s.opacityTexture=e._getTexture(n,h,t)))}}s&&this.materials.push(s)}},e._getTexture=function(e,t,r){if(!t)return null;var n=e;if("file:"===e){var a=t.lastIndexOf("\\");-1===a&&(a=t.lastIndexOf("/")),n+=a>-1?t.substr(a+1):t}else n+=t;return new I.a(n,r)},e}(),at=function(){function e(){this.name="obj",this.extensions=".obj",this.obj=/^o/,this.group=/^g/,this.mtllib=/^mtllib /,this.usemtl=/^usemtl /,this.smooth=/^s /,this.vertexPattern=/v( +[\d|\.|\+|\-|e|E]+){3,7}/,this.normalPattern=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.uvPattern=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.facePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,this.facePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,this.facePattern5=/f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/}return e.prototype._loadMTL=function(e,t,r){var n=u.h.BaseUrl+t+e;u.h.LoadFile(n,r,void 0,void 0,!1,function(){console.warn("Error - Unable to load "+n)})},e.prototype.importMeshAsync=function(e,t,r,n,a,o){return this._parseSolid(e,t,r,n).then(function(e){return{meshes:e,particleSystems:[],skeletons:[],animationGroups:[]}})},e.prototype.loadAsync=function(e,t,r,n,a){return this.importMeshAsync(null,e,t,r,n).then(function(){})},e.prototype.loadAssetContainerAsync=function(e,t,r,n,a){return this.importMeshAsync(null,e,t,r).then(function(t){var r=new f.a(e);return t.meshes.forEach(function(e){return r.meshes.push(e)}),r.removeAllFromScene(),r})},e.prototype._parseSolid=function(t,r,n,a){for(var o,i=this,s=[],l=[],u=[],c=[],f=[],h=[],d=[],p=[],m=[],_=[],y=[],g=0,v=!1,b=[],A=[],x=[],T=[],M=[],O="",w="",S=new nt,L=1,C=!0,R=new E.Color4(.5,.5,.5,1),N=function(t,r,n,a,o,i,s){var l;-1==(l=e.OPTIMIZE_WITH_UV?function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});var r=e[t[0]].normals.indexOf(t[1]);return 1!=r&&t[2]==e[t[0]].uv[r]?e[t[0]].idx[r]:-1}(y,[t,n,r]):function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});var r=e[t[0]].normals.indexOf(t[1]);return-1===r?-1:e[t[0]].idx[r]}(y,[t,n]))?(h.push(d.length),d.push(a),p.push(o),_.push(i),void 0!==s&&m.push(s),y[t].normals.push(n),y[t].idx.push(g++),e.OPTIMIZE_WITH_UV&&y[t].uv.push(r)):h.push(l)},F=function(){for(var t=0;t<d.length;t++)b.push(d[t].x,d[t].y,d[t].z),x.push(_[t].x,_[t].y,_[t].z),T.push(p[t].x,p[t].y);!0===e.IMPORT_VERTEX_COLORS&&A.push(m[t].r,m[t].g,m[t].b,m[t].a),d=[],_=[],p=[],m=[],y=[],g=0},P=function(e,t){t+1<e.length&&(M.push(e[0],e[t],e[t+1]),P(e,t+=1))},I=function(t,r){P(t,r);for(var n=0;n<M.length;n++){var a=parseInt(M[n])-1;N(a,0,0,s[a],E.Vector2.Zero(),E.Vector3.Up(),!0===e.IMPORT_VERTEX_COLORS?c[a]:void 0)}M=[]},D=function(t,r){P(t,r);for(var n=0;n<M.length;n++){var a=M[n].split("/"),o=parseInt(a[0])-1,i=parseInt(a[1])-1;N(o,i,0,s[o],u[i],E.Vector3.Up(),!0===e.IMPORT_VERTEX_COLORS?c[o]:void 0)}M=[]},U=function(e,t){P(e,t);for(var r=0;r<M.length;r++){var n=M[r].split("/"),a=parseInt(n[0])-1,o=parseInt(n[1])-1,i=parseInt(n[2])-1;N(a,o,i,s[a],u[o],l[i])}M=[]},G=function(t,r){P(t,r);for(var n=0;n<M.length;n++){var a=M[n].split("//"),o=parseInt(a[0])-1,i=parseInt(a[1])-1;N(o,1,i,s[o],E.Vector2.Zero(),l[i],!0===e.IMPORT_VERTEX_COLORS?c[o]:void 0)}M=[]},H=function(t,r){P(t,r);for(var n=0;n<M.length;n++){var a=M[n].split("/"),o=s.length+parseInt(a[0]),i=u.length+parseInt(a[1]),f=l.length+parseInt(a[2]);N(o,i,f,s[o],u[i],l[f],!0===e.IMPORT_VERTEX_COLORS?c[o]:void 0)}M=[]},W=function(){f.length>0&&(o=f[f.length-1],F(),h.reverse(),o.indices=h.slice(),o.positions=b.slice(),o.normals=x.slice(),o.uvs=T.slice(),!0===e.IMPORT_VERTEX_COLORS&&(o.colors=A.slice()),h=[],b=[],A=[],x=[],T=[])},K=n.split("\n"),j=0;j<K.length;j++){var z,Q=K[j].trim();if(0!==Q.length&&"#"!==Q.charAt(0))if(this.vertexPattern.test(Q))z=Q.split(" "),s.push(new E.Vector3(parseFloat(z[1]),parseFloat(z[2]),parseFloat(z[3]))),!0===e.IMPORT_VERTEX_COLORS&&(z.length>=7?c.push(new E.Color4(parseFloat(z[4]),parseFloat(z[5]),parseFloat(z[6]),7===z.length||void 0===z[7]?1:parseFloat(z[7]))):c.push(R));else if(null!==(z=this.normalPattern.exec(Q)))l.push(new E.Vector3(parseFloat(z[1]),parseFloat(z[2]),parseFloat(z[3])));else if(null!==(z=this.uvPattern.exec(Q)))u.push(new E.Vector2(parseFloat(z[1]),parseFloat(z[2])));else if(null!==(z=this.facePattern3.exec(Q)))U(z[1].trim().split(" "),1);else if(null!==(z=this.facePattern4.exec(Q)))G(z[1].trim().split(" "),1);else if(null!==(z=this.facePattern5.exec(Q)))H(z[1].trim().split(" "),1);else if(null!==(z=this.facePattern2.exec(Q)))D(z[1].trim().split(" "),1);else if(null!==(z=this.facePattern1.exec(Q)))I(z[1].trim().split(" "),1);else if(this.group.test(Q)||this.obj.test(Q)){var q={name:Q.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:""};W(),f.push(q),v=!0,C=!0,L=1}else if(this.usemtl.test(Q)){if(O=Q.substring(7).trim(),!C){W();q={name:"_mm"+L.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:O};L++,f.push(q)}v&&C&&(f[f.length-1].materialName=O,C=!1)}else this.mtllib.test(Q)?w=Q.substring(7).trim():this.smooth.test(Q)||console.log("Unhandled expression at line : "+Q)}v&&(o=f[f.length-1],h.reverse(),F(),o.indices=h,o.positions=b,o.normals=x,o.uvs=T,!0===e.IMPORT_VERTEX_COLORS&&(o.colors=A)),v||(h.reverse(),F(),f.push({name:B.d.RandomId(),indices:h,positions:b,colors:A,normals:x,uvs:T,materialName:O}));for(var Y=[],X=new Array,Z=0;Z<f.length;Z++){if(t&&f[Z].name)if(t instanceof Array){if(-1==t.indexOf(f[Z].name))continue}else if(f[Z].name!==t)continue;o=f[Z];var J=new k.a(f[Z].name,r);X.push(f[Z].materialName);var $=new V.a;if($.uvs=o.uvs,$.indices=o.indices,$.positions=o.positions,!0===e.COMPUTE_NORMALS){var ee=new Array;V.a.ComputeNormals(o.positions,o.indices,ee),$.normals=ee}else $.normals=o.normals;!0===e.IMPORT_VERTEX_COLORS&&($.colors=o.colors),$.applyToMesh(J),e.INVERT_Y&&(J.scaling.y*=-1),Y.push(J)}var te=[];return""!==w&&te.push(new Promise(function(e,t){i._loadMTL(w,a,function(n){try{S.parseMTL(r,n,a);for(var o=0;o<S.materials.length;o++){for(var i,s=0,l=[];(i=X.indexOf(S.materials[o].name,s))>-1;)l.push(i),s=i+1;if(-1==i&&0==l.length)S.materials[o].dispose();else for(var u=0;u<l.length;u++)Y[l[u]].material=S.materials[o]}e()}catch(e){t(e)}})})),Promise.all(te).then(function(){return Y})},e.OPTIMIZE_WITH_UV=!1,e.INVERT_Y=!1,e.IMPORT_VERTEX_COLORS=!1,e.COMPUTE_NORMALS=!1,e}();c.a&&c.a.RegisterPlugin(new at);var ot=function(){function e(){this.solidPattern=/solid (\S*)([\S\s]*)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.name="stl",this.extensions={".stl":{isBinary:!0}}}return e.prototype.importMesh=function(e,t,r,n,a,o,i){var s;if("string"!=typeof r){if(this._isBinary(r)){var l=new k.a("stlmesh",t);return this._parseBinary(l,r),a&&a.push(l),!0}for(var c=new Uint8Array(r),f="",h=0;h<r.byteLength;h++)f+=String.fromCharCode(c[h]);r=f}for(;s=this.solidPattern.exec(r);){var d=s[1];if(d!=s[3])return u.h.Error("Error in STL, solid name != endsolid name"),!1;if(e&&d)if(e instanceof Array){if(!e.indexOf(d))continue}else if(d!==e)continue;d=d||"stlmesh";l=new k.a(d,t);this._parseASCII(l,s[2]),a&&a.push(l)}return!0},e.prototype.load=function(e,t,r){var n=this.importMesh(null,e,t,r,null,null,null);return n&&(e.createDefaultLight(),e.createDefaultCameraOrLight()),n},e.prototype.loadAssetContainer=function(e,t,r,n){var a=new f.a(e);return this.importMesh(null,e,t,r,a.meshes,null,null),a.removeAllFromScene(),a},e.prototype._isBinary=function(e){var t;if(50,84+50*(t=new DataView(e)).getUint32(80,!0)===t.byteLength)return!0;for(var r=t.byteLength,n=0;n<r;n++)if(t.getUint8(n)>127)return!0;return!1},e.prototype._parseBinary=function(e,t){for(var r=new DataView(t),n=r.getUint32(80,!0),a=0,o=new Float32Array(3*n*3),i=new Float32Array(3*n*3),s=new Uint32Array(3*n),l=0,u=0;u<n;u++){for(var c=84+50*u,f=r.getFloat32(c,!0),h=r.getFloat32(c+4,!0),d=r.getFloat32(c+8,!0),p=1;p<=3;p++){var m=c+12*p;o[a]=r.getFloat32(m,!0),o[a+2]=r.getFloat32(m+4,!0),o[a+1]=r.getFloat32(m+8,!0),i[a]=f,i[a+2]=h,i[a+1]=d,a+=3}s[l]=l++,s[l]=l++,s[l]=l++}e.setVerticesData(D.b.PositionKind,o),e.setVerticesData(D.b.NormalKind,i),e.setIndices(s),e.computeWorldMatrix(!0)},e.prototype._parseASCII=function(e,t){for(var r,n=[],a=[],o=[],i=0;r=this.facetsPattern.exec(t);){var s=r[1],l=this.normalPattern.exec(s);if(this.normalPattern.lastIndex=0,l){for(var u,c=[Number(l[1]),Number(l[5]),Number(l[3])];u=this.vertexPattern.exec(s);)n.push(Number(u[1]),Number(u[5]),Number(u[3])),a.push(c[0],c[1],c[2]);o.push(i++,i++,i++),this.vertexPattern.lastIndex=0}}this.facetsPattern.lastIndex=0,e.setVerticesData(D.b.PositionKind,n),e.setVerticesData(D.b.NormalKind,a),e.setIndices(o),e.computeWorldMatrix(!0)},e}();c.a&&c.a.RegisterPlugin(new ot),r.d(t,"GLTF1",function(){return n}),r.d(t,"GLTF2",function(){return a}),r.d(t,"GLTFLoaderCoordinateSystemMode",function(){return o}),r.d(t,"GLTFLoaderAnimationStartMode",function(){return i}),r.d(t,"GLTFLoaderState",function(){return s}),r.d(t,"GLTFFileLoader",function(){return h}),r.d(t,"MTLFileLoader",function(){return nt}),r.d(t,"OBJFileLoader",function(){return at}),r.d(t,"STLFileLoader",function(){return ot})},319:function(e,t,r){"use strict";r.r(t);var n,a=r(0),o=r(5),i=function(){function e(){}return e.OBJ=function(e,t,r,n){var i=[],s=1;t&&(r||(r="mat"),i.push("mtllib "+r+".mtl"));for(var l=0;l<e.length;l++){i.push("g object"+l),i.push("o object_"+l);var u=null;if(n){var c=a.Matrix.Translation(e[l].position.x,e[l].position.y,e[l].position.z);u=a.Matrix.Translation(-e[l].position.x,-e[l].position.y,-e[l].position.z),e[l].bakeTransformIntoVertices(c)}if(t){var f=e[l].material;f&&i.push("usemtl "+f.id)}var h=e[l].geometry;if(h){var d=h.getVerticesData("position"),p=h.getVerticesData("normal"),m=h.getVerticesData("uv"),_=h.getIndices(),y=0;if(d&&_){for(var g=0;g<d.length;g+=3)i.push("v "+d[g]+" "+d[g+1]+" "+d[g+2]),y++;if(null!=p)for(g=0;g<p.length;g+=3)i.push("vn "+p[g]+" "+p[g+1]+" "+p[g+2]);if(null!=m)for(g=0;g<m.length;g+=2)i.push("vt "+m[g]+" "+m[g+1]);for(g=0;g<_.length;g+=3){var v=[String(_[g+2]+s),String(_[g+1]+s),String(_[g]+s)],b=["","",""],A=v,x=null!=m?v:b,T=null!=p?v:b;i.push("f "+A[0]+"/"+x[0]+"/"+T[0]+" "+A[1]+"/"+x[1]+"/"+T[1]+" "+A[2]+"/"+x[2]+"/"+T[2])}n&&u&&e[l].bakeTransformIntoVertices(u),s+=y}else o.h.Warn("There are no position vertices or indices on the mesh!")}else o.h.Warn("No geometry is present on the mesh")}return i.join("\n")},e.MTL=function(e){var t=[],r=e.material;t.push("newmtl mat1"),t.push("  Ns "+r.specularPower.toFixed(4)),t.push("  Ni 1.5000"),t.push("  d "+r.alpha.toFixed(4)),t.push("  Tr 0.0000"),t.push("  Tf 1.0000 1.0000 1.0000"),t.push("  illum 2"),t.push("  Ka "+r.ambientColor.r.toFixed(4)+" "+r.ambientColor.g.toFixed(4)+" "+r.ambientColor.b.toFixed(4)),t.push("  Kd "+r.diffuseColor.r.toFixed(4)+" "+r.diffuseColor.g.toFixed(4)+" "+r.diffuseColor.b.toFixed(4)),t.push("  Ks "+r.specularColor.r.toFixed(4)+" "+r.specularColor.g.toFixed(4)+" "+r.specularColor.b.toFixed(4)),t.push("  Ke "+r.emissiveColor.r.toFixed(4)+" "+r.emissiveColor.g.toFixed(4)+" "+r.emissiveColor.b.toFixed(4));return r.ambientTexture&&t.push("  map_Ka "+r.ambientTexture.name),r.diffuseTexture&&t.push("  map_Kd "+r.diffuseTexture.name),r.specularTexture&&t.push("  map_Ks "+r.specularTexture.name),r.bumpTexture&&t.push("  map_bump -imfchan z "+r.bumpTexture.name),r.opacityTexture&&t.push("  map_d "+r.opacityTexture.name),t.join("\n")},e}(),s=r(16),l=r(10),u=function(){function e(){}return e._CreateBufferView=function(e,t,r,n,a){var o={buffer:e,byteLength:r};return t&&(o.byteOffset=t),a&&(o.name=a),n&&(o.byteStride=n),o},e._CreateAccessor=function(e,t,r,n,a,o,i,s){var l={name:t,bufferView:e,componentType:n,count:a,type:r};return null!=i&&(l.min=i),null!=s&&(l.max=s),null!=o&&(l.byteOffset=o),l},e._CalculateMinMaxPositions=function(t,r,n,o){var i,s,l,u=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];if(n)for(var f=r,h=r+n;f<h;++f){i=3*f,s=a.Vector3.FromArray(t,i),o&&e._GetRightHandedPositionVector3FromRef(s),l=s.asArray();for(var d=0;d<3;++d){var p=l[d];p<u[d]&&(u[d]=p),p>c[d]&&(c[d]=p),++i}}return{min:u,max:c}},e._GetRightHandedPositionVector3=function(e){return new a.Vector3(e.x,e.y,-e.z)},e._GetRightHandedPositionVector3FromRef=function(e){e.z*=-1},e._GetRightHandedPositionArray3FromRef=function(e){e[2]*=-1},e._GetRightHandedNormalVector3=function(e){return new a.Vector3(e.x,e.y,-e.z)},e._GetRightHandedNormalVector3FromRef=function(e){e.z*=-1},e._GetRightHandedNormalArray3FromRef=function(e){e[2]*=-1},e._GetRightHandedVector4FromRef=function(e){e.z*=-1,e.w*=-1},e._GetRightHandedArray4FromRef=function(e){e[2]*=-1,e[3]*=-1},e._GetRightHandedQuaternionFromRef=function(e){e.x*=-1,e.y*=-1},e._GetRightHandedQuaternionArrayFromRef=function(e){e[0]*=-1,e[1]*=-1},e._NormalizeTangentFromRef=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);t>0&&(e.x/=t,e.y/=t,e.z/=t)},e}();!function(e){e[e.INTANGENT=0]="INTANGENT",e[e.OUTTANGENT=1]="OUTTANGENT"}(n||(n={}));var c=function(){function e(){}return e._CreateNodeAnimation=function(t,r,n,a,i,s){var l=[],u=[],c=r.getKeys(),f=e.calculateMinMaxKeyFrames(c),h=e._DeduceInterpolation(c,n,i),d=f.max-f.min,p=h.interpolationType,m=h.shouldBakeAnimation;return m?e._CreateBakedAnimation(t,r,n,f.min,f.max,r.framePerSecond,s,l,u,f,a,i):"LINEAR"===p||"STEP"===p?e._CreateLinearOrStepAnimation(t,r,n,d,l,u,a,i):"CUBICSPLINE"===p?e._CreateCubicSplineAnimation(t,r,n,d,l,u,a,i):e._CreateBakedAnimation(t,r,n,f.min,f.max,r.framePerSecond,s,l,u,f,a,i),l.length&&u.length?{inputs:l,outputs:u,samplerInterpolation:p,inputsMin:m?f.min:o.h.FloatRound(f.min/r.framePerSecond),inputsMax:m?f.max:o.h.FloatRound(f.max/r.framePerSecond)}:null},e._DeduceAnimationInfo=function(e){var t=null,r="VEC3",n=!1,a=e.targetProperty.split(".");switch(a[0]){case"scaling":t="scale";break;case"position":t="translation";break;case"rotation":r="VEC4",t="rotation";break;case"rotationQuaternion":r="VEC4",n=!0,t="rotation";break;default:o.h.Error("Unsupported animatable property "+a[0])}return t?{animationChannelTargetPath:t,dataAccessorType:r,useQuaternion:n}:(o.h.Error("animation channel target path and data accessor type could be deduced"),null)},e._CreateNodeAnimationFromTransformNodeAnimations=function(t,r,n,a,o,i,s,l,u,c){var f;if(t.animations)for(var h=0,d=t.animations;h<d.length;h++){var p=d[h],m=e._DeduceAnimationInfo(p);m&&(f={name:p.name,samplers:[],channels:[]},e.AddAnimation(""+p.name,p.hasRunningRuntimeAnimations?r:f,t,p,m.dataAccessorType,m.animationChannelTargetPath,a,i,s,l,u,m.useQuaternion,c),f.samplers.length&&f.channels.length&&n.push(f))}},e._CreateNodeAnimationFromAnimationGroups=function(t,r,n,a,o,i,s,u,c){var f;if(t.animationGroups)for(var h=0,d=t.animationGroups;h<d.length;h++){var p=d[h];f={name:p.name,channels:[],samplers:[]};for(var m=0,_=p.targetedAnimations;m<_.length;m++){var y=_[m],g=y.target,v=y.animation;if(g instanceof l.a||1===g.length&&g[0]instanceof l.a){var b=e._DeduceAnimationInfo(y.animation);if(b){var A=g instanceof l.a?g:g[0];e.AddAnimation(""+v.name,f,A,v,b.dataAccessorType,b.animationChannelTargetPath,n,o,i,s,u,b.useQuaternion,c)}}}f.channels.length&&f.samplers.length&&r.push(f)}},e.AddAnimation=function(t,r,n,a,o,i,s,l,c,f,h,d,p){var m,_,y,g,v,b,A,x=e._CreateNodeAnimation(n,a,i,h,d,p);if(x){var T=s[n.uniqueId],E=4*x.inputs.length;m=u._CreateBufferView(0,l.getByteOffset(),E,void 0,t+"  keyframe data view"),c.push(m),x.inputs.forEach(function(e){l.setFloat32(e)}),_=u._CreateAccessor(c.length-1,t+"  keyframes","SCALAR",5126,x.inputs.length,null,[x.inputsMin],[x.inputsMax]),f.push(_),y=f.length-1,v=x.outputs.length,E="VEC3"===o?12*x.outputs.length:16*x.outputs.length,m=u._CreateBufferView(0,l.getByteOffset(),E,void 0,t+"  data view"),c.push(m),x.outputs.forEach(function(e){e.forEach(function(e){l.setFloat32(e)})}),_=u._CreateAccessor(c.length-1,t+"  data",o,5126,v,null,null,null),f.push(_),g=f.length-1,b={interpolation:x.samplerInterpolation,input:y,output:g},r.samplers.push(b),A={sampler:r.samplers.length-1,target:{node:T,path:i}},r.channels.push(A)}},e._CreateBakedAnimation=function(t,r,n,i,s,l,u,c,f,h,d,p){var m,_,y=a.Quaternion.Identity(),g=null,v=null,b=null,A=null,x=null,T=null;h.min=o.h.FloatRound(i/l);for(var E=r.getKeys(),M=0,O=E.length;M<O;++M){if(T=null,b=E[M],M+1<O)if(A=E[M+1],b.value.equals(A.value)){if(0!==M)continue;T=b.frame}else T=A.frame;else{if(x=E[M-1],b.value.equals(x.value))continue;T=s}if(T)for(var w=b.frame;w<=T;w+=u)(_=o.h.FloatRound(w/l))!==g&&(g=_,v=_,m=r._interpolate(w,0,void 0,r.loopMode),e._SetInterpolatedValue(t,m,_,r,n,y,c,f,d,p))}v&&(h.max=v)},e._ConvertFactorToVector3OrQuaternion=function(t,r,n,i,l,u,c){var f,h,d=null,p=e._GetBasePositionRotationOrScale(r,l,u,c);if(i===s.a.ANIMATIONTYPE_FLOAT)switch(h=(f=n.targetProperty.split("."))?f[1]:"",d=c?a.Quaternion.FromArray(p).normalize():a.Vector3.FromArray(p),h){case"x":case"y":d[h]=u&&c&&"scale"!==l?-t:t;break;case"z":d[h]=u&&!c&&"scale"!==l?-t:t;break;case"w":d.w=t;break;default:o.h.Error('glTFAnimation: Unsupported component type "'+h+'" for scale animation!')}return d},e._SetInterpolatedValue=function(e,t,r,n,o,i,s,l,c,f){var h,d=n.dataType;s.push(r),"number"==typeof t&&(t=this._ConvertFactorToVector3OrQuaternion(t,e,n,d,o,c,f)),t&&("rotation"===o?(f?i=t:(h=t,a.Quaternion.RotationYawPitchRollToRef(h.y,h.x,h.z,i)),c&&(u._GetRightHandedQuaternionFromRef(i),e.parent||(i=a.Quaternion.FromArray([0,1,0,0]).multiply(i))),l.push(i.asArray())):(h=t,c&&"scale"!==o&&(u._GetRightHandedPositionVector3FromRef(h),e.parent||(h.x*=-1,h.z*=-1)),l.push(h.asArray())))},e._CreateLinearOrStepAnimation=function(t,r,n,a,o,i,s,l){for(var u=0,c=r.getKeys();u<c.length;u++){var f=c[u];o.push(f.frame/r.framePerSecond),e._AddKeyframeValue(f,r,i,n,t,s,l)}},e._CreateCubicSplineAnimation=function(t,r,a,o,i,s,l,u){r.getKeys().forEach(function(c){i.push(c.frame/r.framePerSecond),e.AddSplineTangent(t,n.INTANGENT,s,a,"CUBICSPLINE",c,o,u,l),e._AddKeyframeValue(c,r,s,a,t,l,u),e.AddSplineTangent(t,n.OUTTANGENT,s,a,"CUBICSPLINE",c,o,u,l)})},e._GetBasePositionRotationOrScale=function(e,t,r,n){var o;return"rotation"===t?n?e.rotationQuaternion?(o=e.rotationQuaternion.asArray(),r&&(u._GetRightHandedQuaternionArrayFromRef(o),e.parent||(o=a.Quaternion.FromArray([0,1,0,0]).multiply(a.Quaternion.FromArray(o)).asArray()))):o=a.Quaternion.Identity().asArray():(o=e.rotation.asArray(),u._GetRightHandedNormalArray3FromRef(o)):"translation"===t?(o=e.position.asArray(),r&&u._GetRightHandedPositionArray3FromRef(o)):o=e.scaling.asArray(),o},e._AddKeyframeValue=function(e,t,r,n,i,l,c){var f,h,d=t.dataType;if(d===s.a.ANIMATIONTYPE_VECTOR3){if(f=e.value.asArray(),"rotation"===n){var p=a.Vector3.FromArray(f),m=a.Quaternion.RotationYawPitchRoll(p.y,p.x,p.z);l&&(u._GetRightHandedQuaternionFromRef(m),i.parent||(m=a.Quaternion.FromArray([0,1,0,0]).multiply(m))),f=m.asArray()}else"translation"===n&&l&&(u._GetRightHandedNormalArray3FromRef(f),i.parent||(f[0]*=-1,f[2]*=-1));r.push(f)}else if(d===s.a.ANIMATIONTYPE_FLOAT){if(h=this._ConvertFactorToVector3OrQuaternion(e.value,i,t,d,n,l,c)){if("rotation"===n){var _=c?h:a.Quaternion.RotationYawPitchRoll(h.y,h.x,h.z).normalize();l&&(u._GetRightHandedQuaternionFromRef(_),i.parent||(_=a.Quaternion.FromArray([0,1,0,0]).multiply(_))),r.push(_.asArray())}else"translation"===n&&l&&(u._GetRightHandedNormalVector3FromRef(h),i.parent||(h.x*=-1,h.z*=-1));r.push(h.asArray())}}else d===s.a.ANIMATIONTYPE_QUATERNION?(f=e.value.normalize().asArray(),l&&(u._GetRightHandedQuaternionArrayFromRef(f),i.parent||(f=a.Quaternion.FromArray([0,1,0,0]).multiply(a.Quaternion.FromArray(f)).asArray())),r.push(f)):o.h.Error("glTFAnimation: Unsupported key frame values for animation!")},e._DeduceInterpolation=function(e,t,r){var n,a,o=!1;if("rotation"===t&&!r)return{interpolationType:"LINEAR",shouldBakeAnimation:!0};for(var i=0,l=e.length;i<l;++i)if((a=e[i]).inTangent||a.outTangent)if(n){if("CUBICSPLINE"!==n){n="LINEAR",o=!0;break}}else n="CUBICSPLINE";else if(n){if("CUBICSPLINE"===n||a.interpolation&&a.interpolation===s.c.STEP&&"STEP"!==n){n="LINEAR",o=!0;break}}else n=a.interpolation&&a.interpolation===s.c.STEP?"STEP":"LINEAR";return n||(n="LINEAR"),{interpolationType:n,shouldBakeAnimation:o}},e.AddSplineTangent=function(e,t,r,o,i,s,l,c,f){var h,d=t===n.INTANGENT?s.inTangent:s.outTangent;if("CUBICSPLINE"===i){if("rotation"===o)if(d){if(c)h=d.scale(l).asArray();else{var p=d.scale(l);h=a.Quaternion.RotationYawPitchRoll(p.y,p.x,p.z).asArray()}f&&(u._GetRightHandedQuaternionArrayFromRef(h),e.parent||(h=a.Quaternion.FromArray([0,1,0,0]).multiply(a.Quaternion.FromArray(h)).asArray()))}else h=[0,0,0,0];else d?(h=d.scale(l).asArray(),f&&"translation"===o&&(u._GetRightHandedPositionArray3FromRef(h),e.parent||(h[0]*=-1,h[2]*=-1))):h=[0,0,0];r.push(h)}},e.calculateMinMaxKeyFrames=function(e){var t=1/0,r=-1/0;return e.forEach(function(e){t=Math.min(t,e.frame),r=Math.max(r,e.frame)}),{min:t,max:r}},e}(),f=function(){function e(){this.glTFFiles={}}return e.prototype.downloadFiles=function(){function e(e,t){return-1!==e.indexOf(t,e.length-t.length)}for(var t in this.glTFFiles){var r=document.createElement("a");document.body.appendChild(r),r.setAttribute("type","hidden"),r.download=t;var n=this.glTFFiles[t],a=void 0;e(t,".glb")?a={type:"model/gltf-binary"}:e(t,".bin")?a={type:"application/octet-stream"}:e(t,".gltf")?a={type:"model/gltf+json"}:e(t,".jpeg")?a={type:"image/jpeg"}:e(t,".png")&&(a={type:"image/png"}),r.href=window.URL.createObjectURL(new Blob([n],a)),r.click()}},e}(),h=r(3),d=r(49),p=r(82),m=r(117),_=r(14),y=r(84),g=r(11),v=r(12),b=r(101),A=r(6),x=r(72),T=r(31),E=r(54),M=r(202),O=r(18),w=r(19),S=function(){function e(e){this._textureMap={},this._textureMap={},this._exporter=e}return e.FuzzyEquals=function(e,t,r){return v.a.WithinEpsilon(e.r,t.r,r)&&v.a.WithinEpsilon(e.g,t.g,r)&&v.a.WithinEpsilon(e.b,t.b,r)},e.prototype._convertMaterialsToGLTFAsync=function(e,t,r){for(var n=[],a=0,i=e;a<i.length;a++){var s=i[a];s instanceof T.StandardMaterial?n.push(this._convertStandardMaterialAsync(s,t,r)):s instanceof M.a?n.push(this._convertPBRMetallicRoughnessMaterialAsync(s,t,r)):s instanceof E.a?n.push(this._convertPBRMaterialAsync(s,t,r)):o.h.Warn("Unsupported material type: "+s.name)}return Promise.all(n).then(function(){})},e.prototype._stripTexturesFromMaterial=function(e){var t={};if(e){t.name=e.name,t.doubleSided=e.doubleSided,t.alphaMode=e.alphaMode,t.alphaCutoff=e.alphaCutoff,t.emissiveFactor=e.emissiveFactor;var r=e.pbrMetallicRoughness;r&&(t.pbrMetallicRoughness={},t.pbrMetallicRoughness.baseColorFactor=r.baseColorFactor,t.pbrMetallicRoughness.metallicFactor=r.metallicFactor,t.pbrMetallicRoughness.roughnessFactor=r.roughnessFactor)}return t},e.prototype._hasTexturesPresent=function(e){if(e.emissiveTexture||e.normalTexture||e.occlusionTexture)return!0;var t=e.pbrMetallicRoughness;return!(!t||!t.baseColorTexture&&!t.metallicRoughnessTexture)},e.prototype._convertToGLTFPBRMetallicRoughness=function(t){var r=new a.Vector2(0,1),n=new a.Vector2(0,.1),o=new a.Vector2(0,.1),i=new a.Vector2(1300,.1);var s=t.diffuseColor.toLinearSpace().scale(.5),l=t.alpha,u=function(e){return function(e,t,r,n,a){return(1-e)*(1-e)*(1-e)*t+3*(1-e)*(1-e)*e*r+3*(1-e)*e*e*n+e*e*e*a}(Math.pow(e/i.x,.333333),r.y,n.y,o.y,i.y)}(v.a.Clamp(t.specularPower,0,e._MaxSpecularPower));return{baseColorFactor:[s.r,s.g,s.b,l],metallicFactor:0,roughnessFactor:u}},e._SolveMetallic=function(e,t,r){if(t<this._DielectricSpecular.r)return this._DielectricSpecular,0;var n=this._DielectricSpecular.r,a=e*r/(1-this._DielectricSpecular.r)+t-2*this._DielectricSpecular.r,o=a*a-4*n*(this._DielectricSpecular.r-t);return v.a.Clamp((-a+Math.sqrt(o))/(2*n),0,1)},e.prototype._getAlphaMode=function(e){return e.needAlphaBlending()?"BLEND":e.needAlphaTesting()?"MASK":"OPAQUE"},e.prototype._convertStandardMaterialAsync=function(t,r,n){var i=this._exporter._materialMap,s=this._exporter._materials,l=this._getAlphaMode(t),u=[],c=this._convertToGLTFPBRMetallicRoughness(t),f={name:t.name};if(null==t.backFaceCulling||t.backFaceCulling||(t.twoSidedLighting||o.h.Warn(t.name+": Back-face culling enabled and two-sided lighting disabled is not supported in glTF."),f.doubleSided=!0),n&&(t.diffuseTexture&&u.push(this._exportTextureAsync(t.diffuseTexture,r).then(function(e){e&&(c.baseColorTexture=e)})),t.bumpTexture&&u.push(this._exportTextureAsync(t.bumpTexture,r).then(function(e){e&&(f.normalTexture=e,null!=t.bumpTexture&&1!==t.bumpTexture.level&&(f.normalTexture.scale=t.bumpTexture.level))})),t.emissiveTexture&&(f.emissiveFactor=[1,1,1],u.push(this._exportTextureAsync(t.emissiveTexture,r).then(function(e){e&&(f.emissiveTexture=e)}))),t.ambientTexture&&u.push(this._exportTextureAsync(t.ambientTexture,r).then(function(e){if(e){var t={index:e.index};f.occlusionTexture=t,t.strength=1}}))),(t.alpha<1||t.opacityTexture)&&(t.alphaMode===g.Engine.ALPHA_COMBINE?f.alphaMode="BLEND":o.h.Warn(t.name+": glTF 2.0 does not support alpha mode: "+t.alphaMode.toString())),t.emissiveColor&&!e.FuzzyEquals(t.emissiveColor,a.Color3.Black(),e._Epsilon)&&(f.emissiveFactor=t.emissiveColor.asArray()),f.pbrMetallicRoughness=c,"OPAQUE"!==l)switch(l){case"BLEND":f.alphaMode="BLEND";break;case"MASK":f.alphaMode="MASK",f.alphaCutoff=t.alphaCutOff;break;default:o.h.Warn("Unsupported alpha mode "+l)}return s.push(f),i[t.uniqueId]=s.length-1,Promise.all(u).then(function(){})},e.prototype._convertPBRMetallicRoughnessMaterialAsync=function(t,r,n){var o=this._exporter._materialMap,i=this._exporter._materials,s=[],l={};t.baseColor&&(l.baseColorFactor=[t.baseColor.r,t.baseColor.g,t.baseColor.b,t.alpha]),null!=t.metallic&&1!==t.metallic&&(l.metallicFactor=t.metallic),null!=t.roughness&&1!==t.roughness&&(l.roughnessFactor=t.roughness);var u={name:t.name};t.doubleSided&&(u.doubleSided=t.doubleSided);var c=null;return null!=t.transparencyMode&&(c=this._getAlphaMode(t))&&"OPAQUE"!==c&&(u.alphaMode=c,"MASK"===c&&(u.alphaCutoff=t.alphaCutOff)),n&&(null!=t.baseTexture&&s.push(this._exportTextureAsync(t.baseTexture,r).then(function(e){e&&(l.baseColorTexture=e)})),t.normalTexture&&s.push(this._exportTextureAsync(t.normalTexture,r).then(function(e){e&&(u.normalTexture=e,1!==t.normalTexture.level&&(u.normalTexture.scale=t.normalTexture.level))})),t.occlusionTexture&&s.push(this._exportTextureAsync(t.occlusionTexture,r).then(function(e){e&&(u.occlusionTexture=e,null!=t.occlusionStrength&&(u.occlusionTexture.strength=t.occlusionStrength))})),t.emissiveTexture&&s.push(this._exportTextureAsync(t.emissiveTexture,r).then(function(e){e&&(u.emissiveTexture=e)}))),e.FuzzyEquals(t.emissiveColor,a.Color3.Black(),e._Epsilon)&&(u.emissiveFactor=t.emissiveColor.asArray()),u.pbrMetallicRoughness=l,i.push(u),o[t.uniqueId]=i.length-1,Promise.all(s).then(function(){})},e.prototype._createBase64FromCanvasAsync=function(e,t,r,n){var a=this;return new Promise(function(n,i){var s,l=g.Engine.TEXTURETYPE_UNSIGNED_INT,u=a._exporter._getLocalEngine();s=new w.Scene(u);var c=u.createRawTexture(e,t,r,g.Engine.TEXTUREFORMAT_RGBA,!1,!0,A.a.NEAREST_SAMPLINGMODE,null,l),f=new O.a("pass","pass",null,null,1,null,A.a.NEAREST_SAMPLINGMODE,u,!1,void 0,g.Engine.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);f.getEffect().executeWhenCompiled(function(){f.onApply=function(e){e._bindTexture("textureSampler",c)},u.setSize(t,r),s.postProcessManager.directRender([f],null),f.dispose(),c.dispose();var e=u.getRenderingCanvas();if(e)if(e.toBlob)o.h.ToBlob(e,function(e){if(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;s.dispose(),n(t)},t.readAsDataURL(e)}else i("gltfMaterialExporter: Failed to get blob from image canvas!")});else{var a=e.toDataURL();n(a)}else i("Engine is missing a canvas!")})})},e.prototype._createWhiteTexture=function(e,t,r){for(var n=new Uint8Array(e*t*4),a=0;a<n.length;a+=4)n[a]=n[a+1]=n[a+2]=n[a+3]=255;return x.a.CreateRGBATexture(n,e,t,r)},e.prototype._resizeTexturesToSameDimensions=function(e,t,r){var n,a,o=e?e.getSize():{width:0,height:0},i=t?t.getSize():{width:0,height:0};return o.width<i.width?(n=e&&e instanceof A.a?b.a.CreateResizedCopy(e,i.width,i.height,!0):this._createWhiteTexture(i.width,i.height,r),a=t):o.width>i.width?(a=t&&t instanceof A.a?b.a.CreateResizedCopy(t,o.width,o.height,!0):this._createWhiteTexture(o.width,o.height,r),n=e):(n=e,a=t),{texture1:n,texture2:a}},e.prototype._convertPixelArrayToFloat32=function(e){if(e instanceof Uint8Array){for(var t=e.length,r=new Float32Array(e.length),n=0;n<t;++n)r[n]=e[n]/255;return r}if(e instanceof Float32Array)return e;throw new Error("Unsupported pixel format!")},e.prototype._convertSpecularGlossinessTexturesToMetallicRoughnessAsync=function(t,r,n,o){var i=[];if(!t&&!r)return Promise.reject("_ConvertSpecularGlosinessTexturesToMetallicRoughness: diffuse and specular glossiness textures are not defined!");var s=t?t.getScene():r?r.getScene():null;if(s){var l=this._resizeTexturesToSameDimensions(t,r,s),u=l.texture1.getSize(),c=void 0,f=void 0,h=u.width,d=u.height,p=l.texture1.readPixels(),m=l.texture2.readPixels();if(!p)return Promise.reject("Failed to retrieve pixels from diffuse texture!");if(c=this._convertPixelArrayToFloat32(p),!m)return Promise.reject("Failed to retrieve pixels from specular glossiness texture!");for(var _=(f=this._convertPixelArrayToFloat32(m)).byteLength,y=new Uint8Array(_),g=new Uint8Array(_),v=a.Color3.Black(),b=0,A=0,x=0;x<d;++x)for(var T=0;T<h;++T){var E=4*(h*x+T),M={diffuseColor:new a.Color3(c[E],c[E+1],c[E+2]).toLinearSpace().multiply(n.diffuseColor),specularColor:new a.Color3(f[E],f[E+1],f[E+2]).toLinearSpace().multiply(n.specularColor),glossiness:f[E+3]*n.glossiness},O=this._convertSpecularGlossinessToMetallicRoughness(M);v.r=Math.max(v.r,O.baseColor.r),v.g=Math.max(v.g,O.baseColor.g),v.b=Math.max(v.b,O.baseColor.b),b=Math.max(b,O.metallic),A=Math.max(A,O.roughness),g[E]=255*O.baseColor.r,g[E+1]=255*O.baseColor.g,g[E+2]=255*O.baseColor.b,g[E+3]=l.texture1.hasAlpha?255*c[E+3]:255,y[E]=0,y[E+1]=255*O.roughness,y[E+2]=255*O.metallic,y[E+3]=255}var w={baseColor:v,metallic:b,roughness:A},S=!1,L=!1;for(x=0;x<d;++x)for(T=0;T<h;++T){var C=4*(h*x+T);g[C]/=w.baseColor.r>e._Epsilon?w.baseColor.r:1,g[C+1]/=w.baseColor.g>e._Epsilon?w.baseColor.g:1,g[C+2]/=w.baseColor.b>e._Epsilon?w.baseColor.b:1;var R=a.Color3.FromInts(g[C],g[C+1],g[C+2]).toGammaSpace();g[C]=255*R.r,g[C+1]=255*R.g,g[C+2]=255*R.b,e.FuzzyEquals(R,a.Color3.White(),e._Epsilon)||(L=!0),y[C+1]/=w.roughness>e._Epsilon?w.roughness:1,y[C+2]/=w.metallic>e._Epsilon?w.metallic:1;var N=a.Color3.FromInts(255,y[C+1],y[C+2]);e.FuzzyEquals(N,a.Color3.White(),e._Epsilon)||(S=!0)}if(S){var F=this._createBase64FromCanvasAsync(y,h,d,o).then(function(e){w.metallicRoughnessTextureBase64=e});i.push(F)}if(L){F=this._createBase64FromCanvasAsync(g,h,d,o).then(function(e){w.baseColorTextureBase64=e});i.push(F)}return Promise.all(i).then(function(){return w})}return Promise.reject("_ConvertSpecularGlossinessTexturesToMetallicRoughness: Scene from textures is missing!")},e.prototype._convertSpecularGlossinessToMetallicRoughness=function(t){var r=this._getPerceivedBrightness(t.diffuseColor),n=this._getPerceivedBrightness(t.specularColor),o=1-this._getMaxComponent(t.specularColor),i=e._SolveMetallic(r,n,o),s=t.diffuseColor.scale(o/(1-e._DielectricSpecular.r)/Math.max(1-i,e._Epsilon)),l=t.specularColor.subtract(e._DielectricSpecular.scale(1-i)).scale(1/Math.max(i,e._Epsilon)),u=a.Color3.Lerp(s,l,i*i);return{baseColor:u=u.clampToRef(0,1,u),metallic:i,roughness:1-t.glossiness}},e.prototype._getPerceivedBrightness=function(e){return e?Math.sqrt(.299*e.r*e.r+.587*e.g*e.g+.114*e.b*e.b):0},e.prototype._getMaxComponent=function(e){return e?Math.max(e.r,Math.max(e.g,e.b)):0},e.prototype._convertMetalRoughFactorsToMetallicRoughnessAsync=function(e,t,r,n){var a=[],o={baseColor:e.albedoColor,metallic:e.metallic,roughness:e.roughness};return n&&(e.albedoTexture&&a.push(this._exportTextureAsync(e.albedoTexture,t).then(function(e){e&&(r.baseColorTexture=e)})),e.metallicTexture&&a.push(this._exportTextureAsync(e.metallicTexture,t).then(function(e){e&&(r.metallicRoughnessTexture=e)}))),Promise.all(a).then(function(){return o})},e.prototype._getGLTFTextureSampler=function(e){var t=this._getGLTFTextureWrapModesSampler(e),r=e instanceof A.a?e.samplingMode:null;if(null!=r)switch(r){case A.a.LINEAR_LINEAR:t.magFilter=9729,t.minFilter=9729;break;case A.a.LINEAR_NEAREST:t.magFilter=9729,t.minFilter=9728;break;case A.a.NEAREST_LINEAR:t.magFilter=9728,t.minFilter=9729;break;case A.a.NEAREST_LINEAR_MIPLINEAR:t.magFilter=9728,t.minFilter=9987;break;case A.a.NEAREST_NEAREST:t.magFilter=9728,t.minFilter=9728;break;case A.a.NEAREST_LINEAR_MIPNEAREST:t.magFilter=9728,t.minFilter=9985;break;case A.a.LINEAR_NEAREST_MIPNEAREST:t.magFilter=9729,t.minFilter=9984;break;case A.a.LINEAR_NEAREST_MIPLINEAR:t.magFilter=9729,t.minFilter=9986;break;case A.a.NEAREST_NEAREST_MIPLINEAR:t.magFilter=9728,t.minFilter=9986;break;case A.a.LINEAR_LINEAR_MIPLINEAR:t.magFilter=9729,t.minFilter=9987;break;case A.a.LINEAR_LINEAR_MIPNEAREST:t.magFilter=9729,t.minFilter=9985;break;case A.a.NEAREST_NEAREST_MIPNEAREST:t.magFilter=9728,t.minFilter=9984}return t},e.prototype._getGLTFTextureWrapMode=function(e){switch(e){case A.a.WRAP_ADDRESSMODE:return 10497;case A.a.CLAMP_ADDRESSMODE:return 33071;case A.a.MIRROR_ADDRESSMODE:return 33648;default:return o.h.Error("Unsupported Texture Wrap Mode "+e+"!"),10497}},e.prototype._getGLTFTextureWrapModesSampler=function(e){var t=this._getGLTFTextureWrapMode(e instanceof A.a?e.wrapU:A.a.WRAP_ADDRESSMODE),r=this._getGLTFTextureWrapMode(e instanceof A.a?e.wrapV:A.a.WRAP_ADDRESSMODE);return 10497===t&&10497===r?{}:{wrapS:t,wrapT:r}},e.prototype._convertSpecGlossFactorsToMetallicRoughnessAsync=function(e,t,r,n){var o=this;return Promise.resolve().then(function(){var i=o._exporter._samplers,s=o._exporter._textures,l={diffuseColor:e.albedoColor||a.Color3.White(),specularColor:e.reflectivityColor||a.Color3.White(),glossiness:e.microSurface||1},u=null,c=o._getGLTFTextureSampler(e.albedoTexture);return null!=c.magFilter&&null!=c.minFilter&&null!=c.wrapS&&null!=c.wrapT&&(i.push(c),u=i.length-1),e.reflectivityTexture&&!e.useMicroSurfaceFromReflectivityMapAlpha?Promise.reject("_ConvertPBRMaterial: Glossiness values not included in the reflectivity texture are currently not supported"):(e.albedoTexture||e.reflectivityTexture)&&n?o._convertSpecularGlossinessTexturesToMetallicRoughnessAsync(e.albedoTexture,e.reflectivityTexture,l,t).then(function(n){if(n.baseColorTextureBase64){var a=o._getTextureInfoFromBase64(n.baseColorTextureBase64,"bjsBaseColorTexture_"+s.length+".png",t,e.albedoTexture?e.albedoTexture.coordinatesIndex:null,u);a&&(r.baseColorTexture=a)}if(n.metallicRoughnessTextureBase64){var i=o._getTextureInfoFromBase64(n.metallicRoughnessTextureBase64,"bjsMetallicRoughnessTexture_"+s.length+".png",t,e.reflectivityTexture?e.reflectivityTexture.coordinatesIndex:null,u);i&&(r.metallicRoughnessTexture=i)}return n}):o._convertSpecularGlossinessToMetallicRoughness(l)})},e.prototype._convertPBRMaterialAsync=function(e,t,r){var n=this,a={},o={name:e.name};return e.isMetallicWorkflow()?(e.albedoColor&&(a.baseColorFactor=[e.albedoColor.r,e.albedoColor.g,e.albedoColor.b,e.alpha]),this._convertMetalRoughFactorsToMetallicRoughnessAsync(e,t,a,r).then(function(i){return n.setMetallicRoughnessPbrMaterial(i,e,o,a,t,r)})):this._convertSpecGlossFactorsToMetallicRoughnessAsync(e,t,a,r).then(function(i){return n.setMetallicRoughnessPbrMaterial(i,e,o,a,t,r)})},e.prototype.setMetallicRoughnessPbrMaterial=function(t,r,n,i,s,l){var u=this._exporter._materialMap,c=this._exporter._materials,f=[];if(t){var h=null;if(null!=r.transparencyMode&&(h=this._getAlphaMode(r))&&"OPAQUE"!==h&&(n.alphaMode=h,"MASK"===h&&(n.alphaCutoff=r.alphaCutOff)),e.FuzzyEquals(t.baseColor,a.Color3.White(),e._Epsilon)&&r.alpha>=e._Epsilon||(i.baseColorFactor=[t.baseColor.r,t.baseColor.g,t.baseColor.b,r.alpha]),null!=t.metallic&&1!==t.metallic&&(i.metallicFactor=t.metallic),null!=t.roughness&&1!==t.roughness&&(i.roughnessFactor=t.roughness),null==r.backFaceCulling||r.backFaceCulling||(r.twoSidedLighting||o.h.Warn(r.name+": Back-face culling enabled and two-sided lighting disabled is not supported in glTF."),n.doubleSided=!0),l){if(r.bumpTexture){var d=this._exportTextureAsync(r.bumpTexture,s).then(function(e){e&&(n.normalTexture=e,1!==r.bumpTexture.level&&(n.normalTexture.scale=r.bumpTexture.level))});f.push(d)}if(r.ambientTexture){d=this._exportTextureAsync(r.ambientTexture,s).then(function(e){if(e){var t={index:e.index};n.occlusionTexture=t,r.ambientTextureStrength&&(t.strength=r.ambientTextureStrength)}});f.push(d)}if(r.emissiveTexture){d=this._exportTextureAsync(r.emissiveTexture,s).then(function(e){e&&(n.emissiveTexture=e)});f.push(d)}}e.FuzzyEquals(r.emissiveColor,a.Color3.Black(),e._Epsilon)||(n.emissiveFactor=r.emissiveColor.asArray()),n.pbrMetallicRoughness=i,c.push(n),u[r.uniqueId]=c.length-1}return Promise.all(f).then(function(e){})},e.prototype.getPixelsFromTexture=function(e){return e.textureType,g.Engine.TEXTURETYPE_UNSIGNED_INT,e.readPixels()},e.prototype._exportTextureAsync=function(e,t){var r=this,n=this._exporter._extensionsPreExportTextureAsync("exporter",e,t);return n?n.then(function(n){return n?r._exportTextureInfoAsync(n,t):r._exportTextureInfoAsync(e,t)}):this._exportTextureInfoAsync(e,t)},e.prototype._exportTextureInfoAsync=function(e,t){var r=this;return Promise.resolve().then(function(){var n=e.uid;if(n in r._textureMap)return r._textureMap[n];for(var a=r._exporter._samplers,o=r._getGLTFTextureSampler(e),i=null,s=null,l=0;l<a.length;++l){var u=a[l];if(u.minFilter===o.minFilter&&u.magFilter===o.magFilter&&u.wrapS===o.wrapS&&u.wrapT===o.wrapT){s=l;break}}null==s?(a.push(o),i=a.length-1):i=s;var c=r.getPixelsFromTexture(e),f=e.getSize();return r._createBase64FromCanvasAsync(c,f.width,f.height,t).then(function(a){var o=r._getTextureInfoFromBase64(a,e.name.replace(/\.\/|\/|\.\\|\\/g,"_"),t,e.coordinatesIndex,i);return o&&(r._textureMap[n]=o),o})})},e.prototype._getTextureInfoFromBase64=function(e,t,r,n,a){var i=this._exporter._textures,s=this._exporter._images,l=this._exporter._imageData,u=null,c={source:s.length,name:t};null!=a&&(c.sampler=a);for(var f=atob(e.split(",")[1]),h=new ArrayBuffer(f.length),d=new Uint8Array(h),p=0,m=f.length;p<m;++p)d[p]=f.charCodeAt(p);var _={data:d,mimeType:r},y="image/jpeg"===r?".jpeg":".png",g=t+y;if(g in l&&(g=t+"_"+o.h.RandomId()+y),l[g]=_,"image/jpeg"===r||"image/png"===r){var v={name:t,uri:g},b=null;for(p=0;p<s.length;++p)if(s[p].uri===g){b=p;break}null==b?(s.push(v),c.source=s.length-1):c.source=b,i.push(c),u={index:i.length-1},null!=n&&(u.texCoord=n)}else o.h.Error("Unsupported texture mime type "+r);return u},e._DielectricSpecular=new a.Color3(.04,.04,.04),e._MaxSpecularPower=1024,e._Epsilon=1e-6,e}(),L=function(){function e(e,t){this._extensions={},this._asset={generator:"BabylonJS",version:"2.0"},this._extensionsUsed=[],this._extensionsRequired=[],this._babylonScene=e,this._bufferViews=[],this._accessors=[],this._meshes=[],this._scenes=[],this._nodes=[],this._images=[],this._materials=[],this._materialMap=[],this._textures=[],this._samplers=[],this._animations=[],this._imageData={},this._convertToRightHandedSystem=!this._babylonScene.useRightHandedSystem;var r=t||{};this._shouldExportTransformNode=r.shouldExportTransformNode?r.shouldExportTransformNode:function(e){return!0},this._animationSampleRate=r.animationSampleRate?r.animationSampleRate:1/60,this._glTFMaterialExporter=new S(this),this._loadExtensions()}return e.prototype._applyExtensions=function(t,r){for(var n=0,a=e._ExtensionNames;n<a.length;n++){var o=a[n],i=this._extensions[o];if(i.enabled){var s=t;s._activeLoaderExtensions=s._activeLoaderExtensions||{};var l=s._activeLoaderExtensions;if(!l[o]){l[o]=!0;try{var u=r(i);if(u)return u}finally{delete l[o],delete s._activeLoaderExtensions}}}}return null},e.prototype._extensionsPreExportTextureAsync=function(e,t,r){return this._applyExtensions(t,function(n){return n.preExportTextureAsync&&n.preExportTextureAsync(e,t,r)})},e.prototype._extensionsPostExportMeshPrimitiveAsync=function(e,t,r,n){return this._applyExtensions(t,function(a){return a.postExportMeshPrimitiveAsync&&a.postExportMeshPrimitiveAsync(e,t,r,n)})},e.prototype._loadExtensions=function(){for(var t=0,r=e._ExtensionNames;t<r.length;t++){var n=r[t],a=e._ExtensionFactories[n](this);this._extensions[n]=a}},e.RegisterExtension=function(t,r){e.UnregisterExtension(t)&&o.h.Warn("Extension with the name "+t+" already exists"),e._ExtensionFactories[t]=r,e._ExtensionNames.push(t)},e.UnregisterExtension=function(t){if(!e._ExtensionFactories[t])return!1;delete e._ExtensionFactories[t];var r=e._ExtensionNames.indexOf(t);return-1!==r&&e._ExtensionNames.splice(r,1),!0},e.prototype._getLocalEngine=function(){if(!this._localEngine){var e=document.createElement("canvas");e.id="WriteCanvas",e.width=2048,e.height=2048,this._localEngine=new g.Engine(e,!0,{premultipliedAlpha:!1,preserveDrawingBuffer:!0}),this._localEngine.setViewport(new a.Viewport(0,0,1,1))}return this._localEngine},e.prototype.reorderIndicesBasedOnPrimitiveMode=function(e,t,r,n,a){switch(t){case _.a.TriangleFillMode:n||(n=0);for(var o=e.indexStart,i=e.indexStart+e.indexCount;o<i;o+=3){var s=n+4*o,l=a.getUInt32(s+4),u=a.getUInt32(s+8);a.setUInt32(u,s+4),a.setUInt32(l,s+8)}break;case _.a.TriangleFanDrawMode:o=e.indexStart+e.indexCount-1;for(var c=e.indexStart;o>=c;--o)a.setUInt32(r[o],n),n+=4;break;case _.a.TriangleStripDrawMode:e.indexCount>=3&&(a.setUInt32(r[e.indexStart+2],n+4),a.setUInt32(r[e.indexStart+1],n+8))}},e.prototype.reorderVertexAttributeDataBasedOnPrimitiveMode=function(e,t,r,n,a,o,i){if(this._convertToRightHandedSystem&&r===_.a.ClockWiseSideOrientation)switch(t){case _.a.TriangleFillMode:this.reorderTriangleFillMode(e,t,r,n,a,o,i);break;case _.a.TriangleStripDrawMode:this.reorderTriangleStripDrawMode(e,t,r,n,a,o,i);break;case _.a.TriangleFanDrawMode:this.reorderTriangleFanMode(e,t,r,n,a,o,i)}},e.prototype.reorderTriangleFillMode=function(e,t,r,n,i,s,l){var u=this.getVertexBufferFromMesh(n,e.getMesh());if(u){var c=u.byteStride/h.b.GetTypeByteLength(u.type);if(e.verticesCount%3!=0)o.h.Error("The submesh vertices for the triangle fill mode is not divisible by 3!");else{var f=[],d=0;switch(n){case h.b.PositionKind:case h.b.NormalKind:for(var p=e.verticesStart;p<e.verticesStart+e.verticesCount;p+=3)d=p*c,f.push(a.Vector3.FromArray(i,d)),f.push(a.Vector3.FromArray(i,d+2*c)),f.push(a.Vector3.FromArray(i,d+c));break;case h.b.TangentKind:for(p=e.verticesStart;p<e.verticesStart+e.verticesCount;p+=3)d=p*c,f.push(a.Vector4.FromArray(i,d)),f.push(a.Vector4.FromArray(i,d+2*c)),f.push(a.Vector4.FromArray(i,d+c));break;case h.b.ColorKind:var m=u.getSize();for(p=e.verticesStart;p<e.verticesStart+e.verticesCount;p+=m)d=p*c,4===m?(f.push(a.Vector4.FromArray(i,d)),f.push(a.Vector4.FromArray(i,d+2*c)),f.push(a.Vector4.FromArray(i,d+c))):(f.push(a.Vector3.FromArray(i,d)),f.push(a.Vector3.FromArray(i,d+2*c)),f.push(a.Vector3.FromArray(i,d+c)));break;case h.b.UVKind:case h.b.UV2Kind:for(p=e.verticesStart;p<e.verticesStart+e.verticesCount;p+=3)d=p*c,f.push(a.Vector2.FromArray(i,d)),f.push(a.Vector2.FromArray(i,d+2*c)),f.push(a.Vector2.FromArray(i,d+c));break;default:o.h.Error("Unsupported Vertex Buffer type: "+n)}this.writeVertexAttributeData(f,s,n,i,l)}}else o.h.Warn("reorderTriangleFillMode: Vertex Buffer Kind "+n+" not present!")},e.prototype.reorderTriangleStripDrawMode=function(e,t,r,n,i,s,l){var u=this.getVertexBufferFromMesh(n,e.getMesh());if(u){var c=u.byteStride/h.b.GetTypeByteLength(u.type),f=[],d=0;switch(n){case h.b.PositionKind:case h.b.NormalKind:d=e.verticesStart,f.push(a.Vector3.FromArray(i,d+2*c)),f.push(a.Vector3.FromArray(i,d+c));break;case h.b.TangentKind:for(var p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)d=p*c,f.push(a.Vector4.FromArray(i,d));break;case h.b.ColorKind:for(p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)d=p*c,4===u.getSize()?f.push(a.Vector4.FromArray(i,d)):f.push(a.Vector3.FromArray(i,d));break;case h.b.UVKind:case h.b.UV2Kind:for(p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)d=p*c,f.push(a.Vector2.FromArray(i,d));break;default:o.h.Error("Unsupported Vertex Buffer type: "+n)}this.writeVertexAttributeData(f,s+12,n,i,l)}else o.h.Warn("reorderTriangleStripDrawMode: Vertex buffer kind "+n+" not present!")},e.prototype.reorderTriangleFanMode=function(e,t,r,n,i,s,l){var u=this.getVertexBufferFromMesh(n,e.getMesh());if(u){var c=u.byteStride/h.b.GetTypeByteLength(u.type),f=[],d=0;switch(n){case h.b.PositionKind:case h.b.NormalKind:for(var p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)d=p*c,f.push(a.Vector3.FromArray(i,d));break;case h.b.TangentKind:for(p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)d=p*c,f.push(a.Vector4.FromArray(i,d));break;case h.b.ColorKind:for(p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)d=p*c,f.push(a.Vector4.FromArray(i,d)),4===u.getSize()?f.push(a.Vector4.FromArray(i,d)):f.push(a.Vector3.FromArray(i,d));break;case h.b.UVKind:case h.b.UV2Kind:for(p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)d=p*c,f.push(a.Vector2.FromArray(i,d));break;default:o.h.Error("Unsupported Vertex Buffer type: "+n)}this.writeVertexAttributeData(f,s,n,i,l)}else o.h.Warn("reorderTriangleFanMode: Vertex buffer kind "+n+" not present!")},e.prototype.writeVertexAttributeData=function(e,t,r,n,i){for(var s=0,l=e;s<l.length;s++){var c=l[s];!this._convertToRightHandedSystem||r===h.b.ColorKind||c instanceof a.Vector2||(c instanceof a.Vector3?r===h.b.NormalKind?u._GetRightHandedNormalVector3FromRef(c):r===h.b.PositionKind?u._GetRightHandedPositionVector3FromRef(c):o.h.Error("Unsupported vertex attribute kind!"):u._GetRightHandedVector4FromRef(c)),r===h.b.NormalKind?c.normalize():r===h.b.TangentKind&&c instanceof a.Vector4&&u._NormalizeTangentFromRef(c);for(var f=0,d=c.asArray();f<d.length;f++){var p=d[f];i.setFloat32(p,t),t+=4}}},e.prototype.writeAttributeData=function(e,t,r,n){var i,s=r/4,l=[];switch(e){case h.b.PositionKind:for(var c=0,f=t.length/s;c<f;++c){i=c*s;var d=a.Vector3.FromArray(t,i);this._convertToRightHandedSystem&&u._GetRightHandedPositionVector3FromRef(d),l.push(d.asArray())}break;case h.b.NormalKind:c=0;for(var p=t.length/s;c<p;++c){i=c*s;d=a.Vector3.FromArray(t,i);this._convertToRightHandedSystem&&u._GetRightHandedNormalVector3FromRef(d),d.normalize(),l.push(d.asArray())}break;case h.b.TangentKind:c=0;for(var m=t.length/s;c<m;++c){i=c*s;d=a.Vector4.FromArray(t,i);this._convertToRightHandedSystem&&u._GetRightHandedVector4FromRef(d),u._NormalizeTangentFromRef(d),l.push(d.asArray())}break;case h.b.ColorKind:c=0;for(var _=t.length/s;c<_;++c){i=c*s;d=3===s?a.Vector3.FromArray(t,i):a.Vector4.FromArray(t,i);l.push(d.asArray())}break;case h.b.UVKind:case h.b.UV2Kind:c=0;for(var y=t.length/s;c<y;++c)i=c*s,l.push((this._convertToRightHandedSystem,[t[i],t[i+1]]));break;default:o.h.Warn("Unsupported Vertex Buffer Type: "+e),l=[]}for(var g=0,v=l;g<v.length;g++)for(var b=0,A=v[g];b<A.length;b++){var x=A[b];n.setFloat32(x)}},e.prototype.generateJSON=function(e,t,r){var n,a,o,i=this,s={byteLength:this._totalByteLength},l=this._totalByteLength,c={asset:this._asset};return this._extensionsUsed&&this._extensionsUsed.length&&(c.extensionsUsed=this._extensionsUsed),this._extensionsRequired&&this._extensionsRequired.length&&(c.extensionsRequired=this._extensionsRequired),s.byteLength&&(c.buffers=[s]),this._nodes&&this._nodes.length&&(c.nodes=this._nodes),this._meshes&&this._meshes.length&&(c.meshes=this._meshes),this._scenes&&this._scenes.length&&(c.scenes=this._scenes,c.scene=0),this._bufferViews&&this._bufferViews.length&&(c.bufferViews=this._bufferViews),this._accessors&&this._accessors.length&&(c.accessors=this._accessors),this._animations&&this._animations.length&&(c.animations=this._animations),this._materials&&this._materials.length&&(c.materials=this._materials),this._textures&&this._textures.length&&(c.textures=this._textures),this._samplers&&this._samplers.length&&(c.samplers=this._samplers),this._images&&this._images.length&&(e?(c.images=[],this._images.forEach(function(e){e.uri&&(a=i._imageData[e.uri],n=e.uri.split(".")[0]+" image",o=u._CreateBufferView(0,l,a.data.length,void 0,n),l+=a.data.buffer.byteLength,i._bufferViews.push(o),e.bufferView=i._bufferViews.length-1,e.name=n,e.mimeType=a.mimeType,e.uri=void 0,c.images||(c.images=[]),c.images.push(e))}),s.byteLength=l):c.images=this._images),e||(s.uri=t+".bin"),r?JSON.stringify(c,null,2):JSON.stringify(c)},e.prototype._generateGLTFAsync=function(e){var t=this;return this._generateBinaryAsync().then(function(r){var n=t.generateJSON(!1,e,!0),a=new Blob([r],{type:"application/octet-stream"}),o=e+".gltf",i=e+".bin",s=new f;if(s.glTFFiles[o]=n,s.glTFFiles[i]=a,t._imageData)for(var l in t._imageData)s.glTFFiles[l]=new Blob([t._imageData[l].data],{type:t._imageData[l].mimeType});return s})},e.prototype._generateBinaryAsync=function(){var e=this,t=new C(4);return this.createSceneAsync(this._babylonScene,t).then(function(){return e._localEngine&&e._localEngine.dispose(),t.getArrayBuffer()})},e.prototype._getPadding=function(e){var t=e%4;return 0===t?t:4-t},e.prototype._generateGLBAsync=function(e){var t=this;return this._generateBinaryAsync().then(function(r){var n=t.generateJSON(!0),a=e+".glb",o=n.length,i=0;for(var s in t._imageData)i+=t._imageData[s].data.byteLength;var l=t._getPadding(o),u=t._getPadding(r.byteLength),c=t._getPadding(i),h=28+o+l+r.byteLength+u+i+c,d=new ArrayBuffer(12),p=new DataView(d);p.setUint32(0,1179937895,!0),p.setUint32(4,2,!0),p.setUint32(8,h,!0);var m=new ArrayBuffer(8+o+l),_=new DataView(m);_.setUint32(0,o+l,!0),_.setUint32(4,1313821514,!0);for(var y=new Uint8Array(m,8),g=0;g<o;++g)y[g]=n.charCodeAt(g);var v=new Uint8Array(m,8+o);for(g=0;g<l;++g)v[g]=32;var b=new ArrayBuffer(8),A=new DataView(b);A.setUint32(0,r.byteLength+i+c,!0),A.setUint32(4,5130562,!0);var x=new ArrayBuffer(u),T=new Uint8Array(x);for(g=0;g<u;++g)T[g]=0;var E=new ArrayBuffer(c),M=new Uint8Array(E);for(g=0;g<c;++g)M[g]=0;var O=[d,m,b,r];for(var s in t._imageData)O.push(t._imageData[s].data.buffer);O.push(x),O.push(E);var w=new Blob(O,{type:"application/octet-stream"}),S=new f;return S.glTFFiles[a]=w,null!=t._localEngine&&t._localEngine.dispose(),S})},e.prototype.setNodeTransformation=function(e,t){t.getPivotPoint().equalsToFloats(0,0,0)||o.h.Warn("Pivot points are not supported in the glTF serializer"),t.position.equalsToFloats(0,0,0)||(e.translation=this._convertToRightHandedSystem?u._GetRightHandedPositionVector3(t.position).asArray():t.position.asArray()),t.scaling.equalsToFloats(1,1,1)||(e.scale=t.scaling.asArray());var r=a.Quaternion.RotationYawPitchRoll(t.rotation.y,t.rotation.x,t.rotation.z);t.rotationQuaternion&&r.multiplyInPlace(t.rotationQuaternion),0===r.x&&0===r.y&&0===r.z&&1===r.w||(this._convertToRightHandedSystem&&u._GetRightHandedQuaternionFromRef(r),e.rotation=r.normalize().asArray())},e.prototype.getVertexBufferFromMesh=function(e,t){if(t.isVerticesDataPresent(e)){var r=t.getVertexBuffer(e);if(r)return r}return null},e.prototype.createBufferViewKind=function(e,t,r,n){var a=t instanceof l.a?t:t instanceof m.a?t.sourceMesh:null;if(a){var o=a.getVerticesData(e);if(o){var i=4*o.length,s=u._CreateBufferView(0,r.getByteOffset(),i,n,e+" - "+a.name);this._bufferViews.push(s),this.writeAttributeData(e,o,n,r)}}},e.prototype.getMeshPrimitiveMode=function(e){return e instanceof p.b?_.a.LineListDrawMode:e.material?e.material.fillMode:_.a.TriangleFillMode},e.prototype.setPrimitiveMode=function(e,t){switch(t){case _.a.TriangleFillMode:break;case _.a.TriangleStripDrawMode:e.mode=5;break;case _.a.TriangleFanDrawMode:e.mode=6;break;case _.a.PointListDrawMode:e.mode=0;case _.a.PointFillMode:e.mode=0;break;case _.a.LineLoopDrawMode:e.mode=2;break;case _.a.LineListDrawMode:e.mode=1;break;case _.a.LineStripDrawMode:e.mode=3}},e.prototype.setAttributeKind=function(e,t){switch(t){case h.b.PositionKind:e.attributes.POSITION=this._accessors.length-1;break;case h.b.NormalKind:e.attributes.NORMAL=this._accessors.length-1;break;case h.b.ColorKind:e.attributes.COLOR_0=this._accessors.length-1;break;case h.b.TangentKind:e.attributes.TANGENT=this._accessors.length-1;break;case h.b.UVKind:e.attributes.TEXCOORD_0=this._accessors.length-1;break;case h.b.UV2Kind:e.attributes.TEXCOORD_1=this._accessors.length-1;break;default:o.h.Warn("Unsupported Vertex Buffer Type: "+t)}},e.prototype.setPrimitiveAttributesAsync=function(e,t,r){var n,o,i,s=[],c=null;t instanceof l.a?c=t:t instanceof m.a&&(c=t.sourceMesh);var f=[{kind:h.b.PositionKind,accessorType:"VEC3",byteStride:12},{kind:h.b.NormalKind,accessorType:"VEC3",byteStride:12},{kind:h.b.ColorKind,accessorType:"VEC4",byteStride:16},{kind:h.b.TangentKind,accessorType:"VEC4",byteStride:16},{kind:h.b.UVKind,accessorType:"VEC2",byteStride:8},{kind:h.b.UV2Kind,accessorType:"VEC2",byteStride:8}];if(c){for(var d=null,g=this.getMeshPrimitiveMode(c),v={},b=0,A=f;b<A.length;b++){var x=(q=A[b]).kind;if(c.isVerticesDataPresent(x)){var T=this.getVertexBufferFromMesh(x,c);q.byteStride=T?4*T.getSize():4*h.b.DeduceStride(x),12===q.byteStride&&(q.accessorType="VEC3"),this.createBufferViewKind(x,t,r,q.byteStride),q.bufferViewIndex=this._bufferViews.length-1,v[x]=q.bufferViewIndex}}if(c.getTotalIndices()){var E=c.getIndices();if(E){var M=4*E.length;n=u._CreateBufferView(0,r.getByteOffset(),M,void 0,"Indices - "+c.name),this._bufferViews.push(n),d=this._bufferViews.length-1;for(var O=0,w=E.length;O<w;++O)r.setUInt32(E[O])}}if(c.subMeshes)for(var S=0,L=c.subMeshes;S<L.length;S++){var C=L[S];o=!1;var R=C.getMaterial()||c.getScene().defaultMaterial,N=null;if(R)if(c instanceof p.b){var F={name:c.name+" material"};(!c.color.equals(a.Color3.White())||c.alpha<1)&&(F.pbrMetallicRoughness={baseColorFactor:c.color.asArray().concat([c.alpha])}),this._materials.push(F),N=this._materials.length-1}else if(R instanceof y.a){var P=R.subMaterials[C.materialIndex];P&&(R=P,N=this._materialMap[R.uniqueId])}else N=this._materialMap[R.uniqueId];var I=null!=N?this._materials[N]:null,V={attributes:{}};this.setPrimitiveMode(V,g);for(var D=0,B=f;D<B.length;D++){if((x=(q=B[D]).kind)!==h.b.UVKind&&x!==h.b.UV2Kind||!I||this._glTFMaterialExporter._hasTexturesPresent(I))if(Q=c.getVerticesData(x))if(T=this.getVertexBufferFromMesh(x,c)){var U=T.getSize(),G=q.bufferViewIndex;if(null!=G){i={min:null,max:null},x==h.b.PositionKind&&(i=u._CalculateMinMaxPositions(Q,0,Q.length/U,this._convertToRightHandedSystem));var k=u._CreateAccessor(G,x+" - "+t.name,q.accessorType,5126,Q.length/U,0,i.min,i.max);this._accessors.push(k),this.setAttributeKind(V,x),null==V.attributes.TEXCOORD_0&&null==V.attributes.TEXCOORD_1||(o=!0)}}}if(d){k=u._CreateAccessor(d,"indices - "+t.name,"SCALAR",5125,C.indexCount,4*C.indexStart,null,null);this._accessors.push(k),V.indices=this._accessors.length-1}if(null!=N&&Object.keys(V.attributes).length>0){var H=R.sideOrientation;if(this._convertToRightHandedSystem&&H===_.a.ClockWiseSideOrientation){var W=null!=d?this._bufferViews[d].byteOffset:null;null==W&&(W=0);var K=null;if(null!=d&&(K=c.getIndices()),K)this.reorderIndicesBasedOnPrimitiveMode(C,g,K,W,r);else for(var j=0,z=f;j<z.length;j++){var Q,q=z[j];if(Q=c.getVerticesData(q.kind)){var Y=this._bufferViews[v[q.kind]].byteOffset;Y||(Y=0),this.reorderVertexAttributeDataBasedOnPrimitiveMode(C,g,H,q.kind,Q,Y,r)}}}if(!o&&this._glTFMaterialExporter._hasTexturesPresent(this._materials[N])){var X=this._glTFMaterialExporter._stripTexturesFromMaterial(this._materials[N]);this._materials.push(X),N=this._materials.length-1}V.material=N}e.primitives.push(V),this._extensionsPostExportMeshPrimitiveAsync("postExport",V,C,r)&&s.push()}}return Promise.all(s).then(function(){})},e.prototype.createSceneAsync=function(e,t){var r,n,i,s=this,l={nodes:[]},u=e.transformNodes.concat(e.meshes);return this._glTFMaterialExporter._convertMaterialsToGLTFAsync(e.materials,"image/png",!0).then(function(){return s.createNodeMapAndAnimationsAsync(e,u,s._shouldExportTransformNode,t).then(function(e){if(s._nodeMap=e,s._totalByteLength=t.getByteOffset(),null==s._totalByteLength)throw new Error("undefined byte length!");for(var c=0,f=u;c<f.length;c++){var h=f[c];if(null!=(r=s._nodeMap[h.uniqueId])&&(n=s._nodes[r],h.parent||(s._shouldExportTransformNode(h)?(s._convertToRightHandedSystem&&(n.translation&&(n.translation[2]*=-1,n.translation[0]*=-1),n.rotation=n.rotation?a.Quaternion.FromArray([0,1,0,0]).multiply(a.Quaternion.FromArray(n.rotation)).asArray():a.Quaternion.FromArray([0,1,0,0]).asArray()),l.nodes.push(r)):o.h.Log("Omitting "+h.name+" from scene.")),i=h.getDescendants(!0),!n.children&&i&&i.length)){for(var d=[],p=0,m=i;p<m.length;p++){var _=m[p];null!=s._nodeMap[_.uniqueId]&&d.push(s._nodeMap[_.uniqueId])}d.length&&(n.children=d)}}l.nodes.length&&s._scenes.push(l)})})},e.prototype.createNodeMapAndAnimationsAsync=function(e,t,r,n){for(var a,o=this,i=Promise.resolve(),s={},l={name:"runtime animations",channels:[],samplers:[]},u=[],f=function(t){r(t)?i=i.then(function(){return o.createNodeAsync(t,n).then(function(r){(t.getDescendants(!0,function(e){return e instanceof d.a}).length||null!=r.mesh)&&(o._nodes.push(r),a=o._nodes.length-1,s[t.uniqueId]=a),!e.animationGroups.length&&t.animations.length&&c._CreateNodeAnimationFromTransformNodeAnimations(t,l,u,s,o._nodes,n,o._bufferViews,o._accessors,o._convertToRightHandedSystem,o._animationSampleRate)})}):t.name},h=0,p=t;h<p.length;h++){f(p[h])}return i.then(function(){return l.channels.length&&l.samplers.length&&o._animations.push(l),u.forEach(function(e){e.channels.length&&e.samplers.length&&o._animations.push(e)}),e.animationGroups.length&&c._CreateNodeAnimationFromAnimationGroups(e,o._animations,s,o._nodes,n,o._bufferViews,o._accessors,o._convertToRightHandedSystem,o._animationSampleRate),s})},e.prototype.createNodeAsync=function(e,t){var r=this;return Promise.resolve().then(function(){var n={},a={primitives:[]};return e.name&&(n.name=e.name),r.setNodeTransformation(n,e),r.setPrimitiveAttributesAsync(a,e,t).then(function(){return a.primitives.length&&(r._meshes.push(a),n.mesh=r._meshes.length-1),n})})},e._ExtensionNames=new Array,e._ExtensionFactories={},e}(),C=function(){function e(e){this._arrayBuffer=new ArrayBuffer(e),this._dataView=new DataView(this._arrayBuffer),this._byteOffset=0}return e.prototype.resizeBuffer=function(e){for(var t=new ArrayBuffer(e),r=new Uint8Array(this._arrayBuffer),n=new Uint8Array(t),a=0,o=n.byteLength;a<o;++a)n[a]=r[a];return this._arrayBuffer=t,this._dataView=new DataView(this._arrayBuffer),t},e.prototype.getArrayBuffer=function(){return this.resizeBuffer(this.getByteOffset())},e.prototype.getByteOffset=function(){if(null==this._byteOffset)throw new Error("Byte offset is undefined!");return this._byteOffset},e.prototype.setUInt8=function(e,t){null!=t?t<this._byteOffset?this._dataView.setUint8(t,e):o.h.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+1>this._arrayBuffer.byteLength&&this.resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setUint8(this._byteOffset++,e))},e.prototype.getUInt32=function(e){if(e<this._byteOffset)return this._dataView.getUint32(e,!0);throw o.h.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"),new Error("BinaryWriter: byteoffset is greater than the current binary buffer length!")},e.prototype.getVector3Float32FromRef=function(e,t){t+8>this._byteOffset?o.h.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(e.x=this._dataView.getFloat32(t,!0),e.y=this._dataView.getFloat32(t+4,!0),e.z=this._dataView.getFloat32(t+8,!0))},e.prototype.setVector3Float32FromRef=function(e,t){t+8>this._byteOffset?o.h.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._dataView.setFloat32(t,e.x,!0),this._dataView.setFloat32(t+4,e.y,!0),this._dataView.setFloat32(t+8,e.z,!0))},e.prototype.getVector4Float32FromRef=function(e,t){t+12>this._byteOffset?o.h.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(e.x=this._dataView.getFloat32(t,!0),e.y=this._dataView.getFloat32(t+4,!0),e.z=this._dataView.getFloat32(t+8,!0),e.w=this._dataView.getFloat32(t+12,!0))},e.prototype.setVector4Float32FromRef=function(e,t){t+12>this._byteOffset?o.h.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._dataView.setFloat32(t,e.x,!0),this._dataView.setFloat32(t+4,e.y,!0),this._dataView.setFloat32(t+8,e.z,!0),this._dataView.setFloat32(t+12,e.w,!0))},e.prototype.setFloat32=function(e,t){isNaN(e)&&o.h.Error("Invalid data being written!"),null!=t&&(t<this._byteOffset?this._dataView.setFloat32(t,e,!0):o.h.Error("BinaryWriter: byteoffset is greater than the current binary length!")),this._byteOffset+4>this._arrayBuffer.byteLength&&this.resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setFloat32(this._byteOffset,e,!0),this._byteOffset+=4},e.prototype.setUInt32=function(e,t){null!=t?t<this._byteOffset?this._dataView.setUint32(t,e,!0):o.h.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+4>this._arrayBuffer.byteLength&&this.resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setUint32(this._byteOffset,e,!0),this._byteOffset+=4)},e}(),R=function(){function e(){}return e.GLTFAsync=function(e,t,r){return e.whenReadyAsync().then(function(){var n=t.replace(/\.[^\/.]+$/,"");return new L(e,r)._generateGLTFAsync(n)})},e._PreExportAsync=function(e,t){return Promise.resolve().then(function(){return t&&t.exportWithoutWaitingForScene?Promise.resolve():e.whenReadyAsync()})},e._PostExportAsync=function(e,t,r){return Promise.resolve().then(function(){return r&&r.exportWithoutWaitingForScene,t})},e.GLBAsync=function(e,t,r){var n=this;return this._PreExportAsync(e,r).then(function(){var a=t.replace(/\.[^\/.]+$/,"");return new L(e,r)._generateGLBAsync(a).then(function(t){return n._PostExportAsync(e,t,r)})})},e}(),N=r(91),F="precision highp float;\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 textureTransformMat;\nvoid main(void) {\nvec2 uvTransformed=(textureTransformMat*vec4(vUV.xy,1,1)).xy;\ngl_FragColor=texture2D(textureSampler,uvTransformed);\n}";r(8).a.ShadersStore.textureTransformPixelShader=F;var P="KHR_texture_transform",I=function(){function e(e){this.name=P,this.enabled=!0,this.required=!1,this._exporter=e}return e.prototype.dispose=function(){delete this._exporter},e.prototype.preExportTextureAsync=function(e,t,r){var n=this;return new Promise(function(r,o){var i={};0===t.uOffset&&0===t.vOffset||(i.offset=[t.uOffset,t.vOffset]),1===t.uScale&&1===t.vScale||(i.scale=[t.uScale,t.vScale]),0!==t.wAng&&(i.rotation=t.wAng),Object.keys(i).length||r(t);var s=i.scale?new a.Vector2(i.scale[0],i.scale[1]):a.Vector2.One(),l=null!=i.rotation?i.rotation:0,u=i.offset?new a.Vector2(i.offset[0],i.offset[1]):a.Vector2.Zero(),c=t.getScene();c?n.textureTransformTextureAsync(t,u,l,s,c).then(function(e){r(e)}):o(e+': "scene" is not defined for Babylon texture '+t.name+"!")})},e.prototype.textureTransformTextureAsync=function(e,t,r,n,a){return new Promise(function(t,r){var n=new N.a(""+e.name,e.getSize(),"textureTransform",a);n||(o.h.Log("Cannot create procedural texture for "+e.name+"!"),t(e)),n.setTexture("textureSampler",e),n.setMatrix("textureTransformMat",e.getTextureMatrix()),n.isReady()?(n.render(),t(n)):n.getEffect().executeWhenCompiled(function(){n.render(),t(n)})})},e}();L.RegisterExtension(P,function(e){return new I(e)}),r.d(t,"OBJExport",function(){return i}),r.d(t,"__IGLTFExporterExtension",function(){return 0}),r.d(t,"_GLTFAnimation",function(){return c}),r.d(t,"GLTFData",function(){return f}),r.d(t,"_Exporter",function(){return L}),r.d(t,"_BinaryWriter",function(){return C}),r.d(t,"__IGLTFExporterExtensionV2",function(){return 0}),r.d(t,"_GLTFMaterialExporter",function(){return S}),r.d(t,"GLTF2Export",function(){return R}),r.d(t,"_GLTFUtilities",function(){return u}),r.d(t,"KHR_texture_transform",function(){return I})},330:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(267),r(268);const n=r(11),a=r(19),o=r(0),i=r(71),s=r(70),l=r(28),u=r(31),c=document.createElement("canvas");c.id="renderCanvas",c.width=1280,c.height=720,document.getElementsByTagName("body")[0].appendChild(c);const f=new n.Engine(c,!0);const h=function(){const e=new a.Scene(f);return new s.ArcRotateCamera("Camera",Math.PI/2,Math.PI/2,2,o.Vector3.Zero(),e).attachControl(c,!0),new i.HemisphericLight("light1",new o.Vector3(1,1,0),e),l.MeshBuilder.CreateSphere("sphere",{diameter:1},e).material=new u.StandardMaterial("mat",e),e}();f.runRenderLoop(()=>{h.render()}),h.debugLayer.show({overlay:!0,embedMode:!0})}}]);